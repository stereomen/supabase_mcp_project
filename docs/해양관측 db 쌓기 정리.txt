  1. 메인 역지오코딩 함수

  파일: add_address_to_xml.py

  1. 출력 XML 파일: locations_with_addresses.xml (141번 줄)
    - locations.xml 파일을 읽어서 주소 정보를 추가한 새 XML 파일로 저장
  2. 로그 파일: output/address_enrichment.log (20번 줄)
    - 처리 과정, 성공/실패 기록 등이 저장됨



 analyze_abs_data.py 파일이 기상청 해양 관측 정보를 받아와서 유효한 데이터만 정리해서 CSV 파일로 뽑는 함수입니다.

  1. abs_region_data_summary.csv (170줄)
    - analyze_abs_data.py로 생성
    - 모든 해양 관측소의 데이터 분석 결과
  2. abs_region_data_a.csv (84줄)
    - "해수면온도+유의파고" 조합 가능한 관측소만 필터링 ('a' 표시)
    - 컬럼: 지역명(한글), STN ID, 위도(LAT), 경도(LON), 관측종류, 제공 정보, 해수면온도+유의파고
  3. abs_region_data_b.csv (82줄)
    - "기온+풍향+풍속" 조합 가능한 관측소만 필터링 ('b' 표시)
    - 컬럼: 지역명(한글), STN ID, 위도(LAT), 경도(LON), 관측종류, 제공 정보, 해수면온도+유의파고, 기온+풍향+풍속
  4. abs_region_data_summary_final.csv (141줄)
    - 최종 정리된 버전 (용도 불명)

======================================


● tidedata-station_info_rows.csv에 새로운 조위 관측소를 추가한 후, 기존과 동일하게 진행하려면 다음 순서로 실행하면 됩니다.

  실행 순서

  1단계: 새 관측소 추가

  파일: tide_abs_info/tidedata-station_info_rows.csv

  Code,Name,Latitude,Longitude
  DT_0095,새관측소,37.123456,126.789012

  2단계: 가장 가까운 해양 관측소 매칭

  실행 함수: tide_abs_info/find_closest_station.py

  cd /home/coder/project/ts140/code-server_mount/supabase_mcp_project/tide_abs_info
  python3 find_closest_station.py

  입력:
  - tidedata-station_info_rows.csv (새 관측소 추가됨)
  - ../abs_region_data_a.csv (해수면온도+유의파고 관측소)
  - ../abs_region_data_b.csv (기온+풍향+풍속 관측소)

  출력:
  - tide-abs_info_ab.csv (새 관측소 포함, a/b 매칭 완료)

  수행 작업:
  - 새 관측소 위치에서 가장 가까운 'a' 타입 관측소 찾기
  - 새 관측소 위치에서 가장 가까운 'b' 타입 관측소 찾기
  - 거리 기반 자동 매칭

  3단계: Supabase 테이블 업데이트

  수동 작업: tide_abs_region 테이블에 데이터 업로드

  방법 1 - Supabase Dashboard 사용:
  1. Supabase Dashboard → Table Editor → tide_abs_region
  2. 기존 데이터 삭제 (또는 새 행만 추가)
  3. tide-abs_info_ab.csv 파일 import

  방법 2 - SQL 직접 실행:
  -- 기존 데이터 삭제
  DELETE FROM tide_abs_region;

  -- CSV 데이터 import (Supabase Dashboard에서)
  -- 또는 새 행만 INSERT
  INSERT INTO tide_abs_region (code, name, latitude, longitude, a_stn_name, a_stn_id, ...)
  VALUES ('DT_0095', '새관측소', 37.123456, 126.789012, ...);

  4단계: locations 테이블 업데이트 (필요시)

  테이블: locations

  새 관측소를 API에서 조회 가능하게 하려면:

  INSERT INTO locations (location_code, location_name, latitude, longitude, ...)
  VALUES ('DT_0095', '새관측소', 37.123456, 126.789012, ...);

  ---
  전체 프로세스 요약

  [1] tidedata-station_info_rows.csv 편집
      ↓ (새 관측소 추가: DT_0095)

  [2] python3 find_closest_station.py 실행
      ↓ (거리 기반 a/b 매칭)

  [3] tide-abs_info_ab.csv 생성
      ↓ (새 관측소 매칭 정보 포함)

  [4] Supabase tide_abs_region 테이블 업데이트
      ↓ (CSV import 또는 INSERT)

  [5] Supabase locations 테이블 업데이트 (선택)
      ↓ (API 조회 활성화)

  [완료] get-weather-tide-data API에서 새 관측소 조회 가능

  ---
  주의사항

  1. 좌표 정확성: 위도/경도가 정확해야 올바른 해양 관측소와 매칭됩니다
  2. Code 형식: DT_XXXX (조위 관측소) 또는 SO_XXXX (해양 관측소) 형식 유지
  3. 중복 확인: 기존 Code와 중복되지 않도록 확인
  4. 백업: 기존 CSV 파일들을 백업 후 작업하는 것을 권장

  자동화 스크립트 (선택)

  필요하다면 다음과 같은 자동화 스크립트를 작성할 수 있습니다:

  #!/bin/bash
  # add_new_station.sh

  cd /home/coder/project/ts140/code-server_mount/supabase_mcp_project/tide_abs_info

  # 백업
  cp tide-abs_info_ab.csv tide-abs_info_ab.backup.csv

  # 매칭 실행
  python3 find_closest_station.py

  # 결과 확인
  echo "✓ 매칭 완료. tide-abs_info_ab.csv를 확인하세요."
  echo "✓ Supabase tide_abs_region 테이블에 업로드하세요."

  실행 방법:
  chmod +x add_new_station.sh
  ./add_new_station.sh
