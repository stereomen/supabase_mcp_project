# get-medm-weather-data API 명세서

## 개요
통합 기상예보 데이터를 제공하는 RESTful API입니다. 단기예보(3일) + 중기예보(7일)로 총 10일간의 연속적인 기상정보를 한 번에 조회할 수 있습니다.

## Base URL
```
https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1
```

---

## API 상세

### 통합 기상예보 데이터 조회
**`GET /get-medm-weather-data`**

10일간의 연속 기상예보 데이터를 조회합니다.

#### 요청 파라미터
| 파라미터 | 타입 | 필수 | 설명 | 예시 |
|---------|------|------|------|------|
| code | string | ✅ | 위치 코드 | DT_0001 |
| date | string | ✅ | 기준 날짜 (YYYY-MM-DD) | 2025-09-03 |

#### 데이터 기간
- **short_forecasts**: 요청일부터 3일 (D+0 ~ D+2)
- **marine**: 4일째부터 10일째 (D+3 ~ D+9)  
- **temper**: 4일째부터 10일째 (D+3 ~ D+9)

#### 예시 요청
```bash
curl "https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1/get-medm-weather-data?code=DT_0001&date=2025-09-03"
```

---

## 응답 데이터 구조

### 성공 응답 (HTTP 200)
```json
{
  "short_forecasts": [
    {
      "nx": 58,
      "ny": 125,
      "한글지역명": "인천",
      "fcst_datetime_kr": "2025-09-03T00:00:00+00:00",
      "updated_at_kr": "2025-09-02T11:03:29.034+00:00",
      "base_date": "20250902",
      "base_time": "1100",
      "fcst_datetime": "2025-09-02T15:00:00+00:00",
      "pop": 60,
      "pty": 1,
      "pcp": "6.0mm",
      "reh": 70,
      "sno": "적설없음",
      "sky": 4,
      "tmp": 28,
      "tmn": null,
      "tmx": 30,
      "uuu": 2.1,
      "vvv": 2.1,
      "wav": -999,
      "vec": 225,
      "wsd": 3,
      "updated_at": "2025-09-02T02:03:29.034+00:00",
      "location_code": "DT_0001"
    }
  ],
  "marine": [
    {
      "reg_id": "12A10000",
      "reg_sp": "I",
      "reg_name": "서해북부",
      "mod": "A02",
      "tm_fc": "2025-09-02T21:00:00+00:00",
      "tm_fc_kr": "2025-09-03T06:00:00+00:00",
      "tm_ef": "2025-09-06T15:00:00+00:00",
      "tm_ef_kr": "2025-09-07T00:00:00+00:00",
      "wh_a": 1.0,
      "wh_b": 2.0,
      "wf": "흐리고 비",
      "sky": "WB04",
      "pre": "WB09",
      "conf": null,
      "rn_st": 80,
      "forecast_type": "marine"
    }
  ],
  "temper": [
    {
      "reg_id": "11B20201",
      "reg_sp": "C",
      "reg_name": "인천",
      "mod": "A01",
      "tm_fc": "2025-09-02T21:00:00+00:00",
      "tm_fc_kr": "2025-09-03T06:00:00+00:00",
      "tm_ef": "2025-09-06T15:00:00+00:00",
      "tm_ef_kr": "2025-09-07T00:00:00+00:00",
      "min_temp": 24,
      "max_temp": 29,
      "min_temp_l": 1,
      "min_temp_h": 1,
      "max_temp_l": 1,
      "max_temp_h": 1,
      "c": "2",
      "sky": "WB04",
      "pre": "WB09",
      "conf": null,
      "wf": "흐리고 비",
      "rn_st": 80,
      "forecast_type": "temperature"
    }
  ]
}
```

---

## 데이터 필드 상세

### 1. short_forecasts (단기예보 - 3일간)
기상청 단기예보 API 기반 상세 기상 정보

#### 공간 정보
- **`nx`**: X 격자 좌표
- **`ny`**: Y 격자 좌표  
- **`한글지역명`**: 한글 지역명
- **`location_code`**: 위치 코드

#### 시간 정보
- **`fcst_datetime`**: 예보 시각 (UTC)
- **`fcst_datetime_kr`**: 예보 시각 (KST)
- **`base_date`**: 발표 기준일 (YYYYMMDD)
- **`base_time`**: 발표 기준시 (HHMM)
- **`updated_at`**: 업데이트 시각 (UTC)
- **`updated_at_kr`**: 업데이트 시각 (KST)

#### 기상 데이터
| 필드 | 의미 | 단위 | 범위/값 |
|------|------|------|---------|
| **tmp** | 기온 | °C | -50~50 |
| **tmn** | 최저기온 | °C | -50~50 |
| **tmx** | 최고기온 | °C | -50~50 |
| **pop** | 강수확률 | % | 0~100 |
| **pty** | 강수형태 | - | 0(없음), 1(비), 2(비/눈), 3(눈), 4(소나기) |
| **pcp** | 강수량 | mm | "1.0mm" 또는 "강수없음" |
| **reh** | 습도 | % | 0~100 |
| **sno** | 적설량 | cm | "1.0cm" 또는 "적설없음" |
| **sky** | 하늘상태 | - | 1(맑음), 3(구름많음), 4(흐림) |
| **uuu** | 동서바람성분 | m/s | -100~100 |
| **vvv** | 남북바람성분 | m/s | -100~100 |
| **vec** | 풍향 | ° | 0~360 |
| **wsd** | 풍속 | m/s | 0~100 |
| **wav** | 파고 | m | 0~10 (내륙은 -999) |

### 2. marine (중기 해상예보 - 7일간)
기상청 중기 해상예보 데이터

#### 메타데이터 (8개 필드)
- **`reg_id`**: 예보구역코드 (예: 12A10000)
- **`reg_sp`**: 특성 (I: 해상, C: 육상, A: 광역)
- **`reg_name`**: 지역명 (예: 서해북부)
- **`mod`**: 구간 (A01: 24시간, A02: 12시간)
- **`tm_fc`/`tm_fc_kr`**: 발표시각 (UTC/KST)
- **`tm_ef`/`tm_ef_kr`**: 발효시각 (UTC/KST)
- **`forecast_type`**: "marine"

#### 해상 데이터 (6개 필드)
| 필드 | 의미 | 단위 | 설명 |
|------|------|------|------|
| **wh_a** | 파고1 | m | 평균 파고 |
| **wh_b** | 파고2 | m | 최대 파고 |
| **wf** | 예보 | - | 텍스트 형태 날씨 설명 |
| **sky** | 하늘상태코드 | - | WB01~WB04 |
| **pre** | 강수유무코드 | - | WB00, WB09, WB11~WB13 |
| **rn_st** | 강수확률 | % | 0~100 |
| **conf** | 신뢰도 | - | 예보 신뢰도 |

### 3. temper (중기 기온예보 - 7일간)
기상청 중기 기온예보 데이터

#### 메타데이터 (8개 필드)
marine과 동일한 메타데이터 구조 (`forecast_type`은 "temperature")

#### 기온 데이터 (11개 필드)
| 필드 | 의미 | 단위 | 설명 |
|------|------|------|------|
| **min_temp** | 아침최저기온 | °C | 일 최저기온 |
| **max_temp** | 낮최고기온 | °C | 일 최고기온 |
| **min_temp_l** | 최저기온 하한 | °C | 변동 범위 하한 |
| **min_temp_h** | 최저기온 상한 | °C | 변동 범위 상한 |
| **max_temp_l** | 최고기온 하한 | °C | 변동 범위 하한 |
| **max_temp_h** | 최고기온 상한 | °C | 변동 범위 상한 |
| **c** | 발표코드 | - | 기온 발표 코드 |
| **sky** | 하늘상태코드 | - | WB01~WB04 |
| **pre** | 강수유무코드 | - | WB00, WB09, WB11~WB13 |
| **wf** | 예보 | - | 텍스트 형태 날씨 설명 |
| **rn_st** | 강수확률 | % | 0~100 |
| **conf** | 신뢰도 | - | 예보 신뢰도 |

---

## 기상청 코드값

### 하늘상태 (SKY)
| 코드 | 단기예보 | 중기예보 | 의미 |
|------|----------|----------|------|
| 1 | ✅ | - | 맑음 |
| 3 | ✅ | - | 구름많음 |
| 4 | ✅ | - | 흐림 |
| WB01 | - | ✅ | 맑음 |
| WB02 | - | ✅ | 구름조금 |
| WB03 | - | ✅ | 구름많음 |
| WB04 | - | ✅ | 흐림 |

### 강수형태/강수유무 (PTY/PRE)
| 코드 | 단기예보 | 중기예보 | 의미 |
|------|----------|----------|------|
| 0 | ✅ | - | 강수없음 |
| 1 | ✅ | - | 비 |
| 2 | ✅ | - | 비/눈 |
| 3 | ✅ | - | 눈 |
| 4 | ✅ | - | 소나기 |
| WB00 | - | ✅ | 강수없음 |
| WB09 | - | ✅ | 비 |
| WB11 | - | ✅ | 비/눈 |
| WB12 | - | ✅ | 눈 |
| WB13 | - | ✅ | 눈/비 |

---

## 에러 응답

### 공통 에러 형식
```json
{
  "error": "에러 메시지"
}
```

### HTTP 상태 코드
- **200**: 성공
- **400**: 잘못된 요청
- **404**: 위치 코드 없음
- **405**: 허용되지 않는 메소드 (GET만 지원)
- **500**: 서버 내부 오류

### 에러 예시
```json
// 필수 파라미터 누락
{
  "error": "Missing required parameters: code and date are required."
}

// 날짜 형식 오류
{
  "error": "date는 YYYY-MM-DD 형식이어야 합니다."
}

// 위치 코드 없음
{
  "error": "해당 코드에 대한 지역 정보를 찾을 수 없습니다."
}

// 데이터 조회 오류
{
  "error": "Short forecasts 데이터 조회 중 오류가 발생했습니다."
}
```

---

## 사용 예시

### JavaScript (Fetch API)
```javascript
async function getWeatherData(code, date) {
  try {
    const response = await fetch(
      `https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1/get-medm-weather-data?code=${code}&date=${date}`
    );
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    
    console.log('단기예보 3일:', data.short_forecasts.length, '건');
    console.log('중기 해상예보 7일:', data.marine.length, '건');
    console.log('중기 기온예보 7일:', data.temper.length, '건');
    
    return data;
  } catch (error) {
    console.error('Error:', error);
  }
}

// 사용 예시
getWeatherData('DT_0001', '2025-09-03');
```

### cURL
```bash
# 기본 요청
curl "https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1/get-medm-weather-data?code=DT_0001&date=2025-09-03"

# 응답을 파일로 저장
curl "https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1/get-medm-weather-data?code=DT_0001&date=2025-09-03" \
  -o weather_data.json

# 상태 코드만 확인
curl -I "https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1/get-medm-weather-data?code=DT_0001&date=2025-09-03"
```

### Python (requests)
```python
import requests
import json
from datetime import datetime, timedelta

def get_weather_data(code, date):
    """
    통합 기상예보 데이터 조회
    
    Args:
        code (str): 위치 코드 (예: 'DT_0001')
        date (str): 기준 날짜 (YYYY-MM-DD)
    
    Returns:
        dict: 응답 데이터 또는 None (에러 시)
    """
    url = "https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1/get-medm-weather-data"
    params = {
        "code": code,
        "date": date
    }
    
    try:
        response = requests.get(url, params=params, timeout=30)
        response.raise_for_status()
        
        data = response.json()
        
        # 데이터 요약 출력
        print(f"=== {code} 지역 {date} 기준 기상정보 ===")
        print(f"단기예보: {len(data.get('short_forecasts', []))}건")
        print(f"중기 해상예보: {len(data.get('marine', []))}건") 
        print(f"중기 기온예보: {len(data.get('temper', []))}건")
        
        return data
        
    except requests.exceptions.RequestException as e:
        print(f"요청 오류: {e}")
        return None
    except json.JSONDecodeError as e:
        print(f"JSON 파싱 오류: {e}")
        return None

# 사용 예시
if __name__ == "__main__":
    # 오늘부터 10일 예보
    today = datetime.now().strftime('%Y-%m-%d')
    weather_data = get_weather_data('DT_0001', today)
    
    if weather_data:
        # 단기예보 온도 정보 출력
        for forecast in weather_data.get('short_forecasts', []):
            print(f"{forecast['fcst_datetime_kr']}: {forecast['tmp']}°C")
```

---

## 데이터 소스 및 업데이트

### 데이터 소스
- **단기예보**: 기상청 VilageFcst API (동네예보)
- **중기예보**: 기상청 중기예보 API (해상/기온)

### 업데이트 주기
- **단기예보**: 매일 8회 (02, 05, 08, 11, 14, 17, 20, 23시)
- **중기예보**: 매일 2회 (06:00, 18:00)

### 데이터 지연
- API 응답은 최신 수집된 데이터 기준
- 기상청 발표 후 약 10-30분 지연 가능

---

## 지원 위치 코드
- **DT_xxxx**: 조석관측소 기반 위치
- **SO_xxxx**: 해양관측부이 기반 위치

### 주요 위치 코드 예시
| 코드 | 지역명 |
|------|--------|
| DT_0001 | 인천 |
| DT_0005 | 부산 |
| DT_0007 | 목포 |
| DT_0016 | 여수 |
| DT_0021 | 추자도 |

---

## 주의사항
- 인증이 필요하지 않은 공개 API입니다
- 대량 요청 시 적절한 간격을 두어 호출하세요
- 모든 시간은 KST(한국 표준시) 기준입니다
- 중기예보는 단기예보보다 정확도가 낮습니다
- 해상 위치가 아닌 경우 파고 데이터는 -999로 표시됩니다

## 문의
API 관련 문의사항은 프로젝트 관리자에게 연락해주세요.