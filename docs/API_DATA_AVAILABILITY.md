# API 데이터 가용성 및 날짜 범위 가이드

## 개요

`get-weather-tide-data` API는 여러 데이터 소스를 통합하여 제공합니다. 각 데이터 소스는 서로 다른 수집 주기와 제공 기간을 가지고 있습니다.

**중요**: 이 문서는 미래 날짜 조회 시 데이터 가용성을 설명합니다.

---

## 데이터 소스별 제공 기간

### 1. 조석 데이터 (tide_data)
**출처**: 국립해양조사원
**수집 방식**: API 호출로 미리 계산된 데이터 수집

| 항목 | 내용 |
|------|------|
| 제공 기간 | 요청일 ~ +13일 (총 14일) |
| 미래 날짜 조회 | ✅ 전체 지원 |
| 데이터 특성 | 천체역학 계산 기반으로 장기 예측 가능 |
| 갱신 주기 | 월 1회 (필요 시) |

**예시**:
```
오늘: 2025-12-09
수집 데이터: 2025-12-09 ~ 2025-12-22 (14일)

사용자 조회:
- date=2025-12-09 → 2025-12-09 ~ 2025-12-22 반환 (14일) ✅
- date=2025-12-15 → 2025-12-15 ~ 2025-12-22 반환 (8일) ✅
- date=2025-12-23 → 데이터 없음 ❌
```

---

### 2. 기상청 단기 예보 (weather_forecasts)
**출처**: 기상청 단기예보 API
**수집 방식**: 매시간 자동 수집

| 항목 | 내용 |
|------|------|
| 제공 기간 | 요청일 ~ +2일 (총 3일) |
| 시간 간격 | 1시간 |
| 미래 날짜 조회 | ✅ +2일까지 지원 |
| 데이터 특성 | 단기 정밀 예보 |
| 갱신 주기 | 매시간 |

**예시**:
```
오늘: 2025-12-09 (매시간 수집)
수집 데이터: 2025-12-09 ~ 2025-12-11 (3일)

사용자 조회:
- date=2025-12-09 → 2025-12-09 ~ 2025-12-11 반환 (3일) ✅
- date=2025-12-10 → 2025-12-10 ~ 2025-12-11 반환 (2일) ✅
- date=2025-12-12 → 데이터 없음 ❌
```

---

### 3. 기상청 중기 예보 (marine, temper)
**출처**: 기상청 중기예보 API
**수집 방식**: 하루 2회 자동 수집 (06:00, 18:00)

| 항목 | 내용 |
|------|------|
| 제공 기간 | 요청일 +3일 ~ +10일 (총 8일) |
| 시간 간격 | 하루 1~2회 |
| 미래 날짜 조회 | ✅ +3일~+10일 구간만 지원 |
| 데이터 특성 | 중장기 추세 예보 |
| 갱신 주기 | 하루 2회 |

**예시**:
```
오늘: 2025-12-09 (하루 2회 수집)
수집 데이터: 2025-12-12 ~ 2025-12-19 (8일, +3~+10일)

사용자 조회:
- date=2025-12-09 → 2025-12-12 ~ 2025-12-19 반환 (8일) ✅
- date=2025-12-10 → 2025-12-12 ~ 2025-12-19 반환 (8일) ✅
- date=2025-12-15 → 2025-12-15 ~ 2025-12-19 반환 (5일) ✅
- date=2025-12-20 → 데이터 없음 ❌
```

**참고**: 단기 예보(0~2일)와 중기 예보(3~10일) 사이 1일 공백 존재

---

### 4. 해양 관측 데이터 (marine_observations)
**출처**: 기상청 해양기상관측 API
**수집 방식**: 매시간 실시간 수집

| 항목 | 내용 |
|------|------|
| 제공 기간 | 요청일 당일만 |
| 시간 간격 | 1시간 |
| 미래 날짜 조회 | ❌ 미래 데이터 없음 (관측 데이터) |
| 데이터 특성 | 실시간 관측 |
| 갱신 주기 | 매시간 |

**예시**:
```
오늘: 2025-12-09 (매시간 수집)
수집 데이터: 2025-12-09 당일 관측값만

사용자 조회:
- date=2025-12-09 → 2025-12-09 관측 데이터 반환 ✅
- date=2025-12-10 → 데이터 없음 ❌ (아직 관측 안 됨)
- date=2025-12-08 → 과거 데이터 있음 (보존 기간 내) ✅
```

---

### 5. OpenWeatherMap
**출처**: OpenWeatherMap API (One Call 3.0 + 5 Day Forecast)
**수집 방식**: 매일 새벽 자동 수집 (cron)

#### 5.1 현재 날씨 (current)
| 항목 | 내용 |
|------|------|
| 제공 기간 | 수집 시점 1개 |
| 미래 날짜 조회 | ❌ 현재 시각 데이터만 |

#### 5.2 단기 상세 예보 (5 Day / 3 Hour Forecast)
| 항목 | 내용 |
|------|------|
| 제공 기간 | 수집일 ~ +4일 (총 5일) |
| 시간 간격 | 3시간 |
| 미래 날짜 조회 | ⚠️ 제한적 지원 |
| 데이터 특성 | 단기 상세 예보 |
| 갱신 주기 | 매일 새벽 1회 |

#### 5.3 장기 일별 예보 (One Call Daily)
| 항목 | 내용 |
|------|------|
| 제공 기간 | 수집일 ~ +7일 (총 8일) |
| 시간 간격 | 하루 1회 (정오 12:00) |
| 미래 날짜 조회 | ⚠️ 제한적 지원 |
| 데이터 특성 | 장기 일별 예보 |
| 갱신 주기 | 매일 새벽 1회 |

**중요**: OpenWeatherMap은 "수집 시점 기준" 데이터이므로 미래 날짜 조회 시 데이터가 점진적으로 감소합니다.

**예시**:
```
수집: 2025-12-09 새벽 01:00 (매일 크론잡 실행)

수집된 데이터:
- 5 Day Forecast: 2025-12-09 ~ 2025-12-13 (5일, 3시간 간격)
- One Call Daily: 2025-12-09 ~ 2025-12-16 (8일, 일별)

사용자 조회:
- date=2025-12-09 → 전체 데이터 (5일 상세 + 8일 일별) ✅
- date=2025-12-10 → 4일 상세 + 7일 일별 ✅
- date=2025-12-11 → 3일 상세 + 6일 일별 ✅
- date=2025-12-15 → 0일 상세 + 2일 일별 ⚠️
- date=2025-12-17 → 데이터 없음 ❌

내일(2025-12-10) 크론잡 실행 후:
- 5 Day Forecast: 2025-12-10 ~ 2025-12-14 (5일)
- One Call Daily: 2025-12-10 ~ 2025-12-17 (8일)
→ 데이터 범위 갱신됨
```

---

## 미래 날짜 조회 시 데이터 가용성

### 완전 지원 (전체 기간 보장)
- ✅ **조석 데이터**: 14일 전체
- ✅ **기상청 단기**: +2일까지
- ✅ **기상청 중기**: +3일~+10일 구간

### 제한적 지원 (점진적 감소)
- ⚠️ **OpenWeatherMap**: 미래로 갈수록 데이터 감소

### 지원 안 함
- ❌ **해양 관측**: 미래 데이터 없음 (관측 데이터 특성)

---

## 날짜별 데이터 가용성 매트릭스

```
날짜        조석  단기  중기  OpenWeather  해양관측
------------------------------------------------------
오늘(D+0)    14    3     -       8           ✅
내일(D+1)    13    2     -       7           ❌
모레(D+2)    12    1     -       6           ❌
D+3          11    -     8       5           ❌
D+4          10    -     7       4           ❌
D+5           9    -     6       3           ❌
D+6           8    -     5       2           ❌
D+7           7    -     4       1           ❌
D+8           6    -     3       0           ❌
D+9           5    -     2       -           ❌
D+10          4    -     1       -           ❌
D+11          3    -     -       -           ❌
D+12          2    -     -       -           ❌
D+13          1    -     -       -           ❌
D+14          -    -     -       -           ❌

* 숫자: 해당 날짜부터 며칠치 데이터 제공
* -: 데이터 없음
* ✅: 관측 데이터 있음
* ❌: 미래 데이터 없음
```

---

## OpenWeatherMap 데이터 감소 이유

### API 특성
OpenWeatherMap API는 **"현재 시각 기준으로 미래 예보"**를 제공합니다.
- 특정 날짜부터 8일치를 제공하는 것이 **아닙니다**
- 요청 시점부터 미래 8일치를 제공합니다

### 이것은 정상입니다!

**날씨 예보의 본질**:
- 미래로 갈수록 예측 정확도 감소
- 8일 이후는 신뢰도 낮아 제공 안 함
- 매일 예보가 갱신되며 범위도 갱신됨

**실제 사용 시나리오**:
1. 사용자가 **오늘** 앱 실행 → 오늘부터 +7일까지 예보 확인 가능
2. 사용자가 **내일** 날짜 선택 → 내일부터 +6일까지 예보 확인 가능
3. 다음날 크론잡 실행 → 데이터 범위 갱신 → 다시 +7일까지 가능

---

## 클라이언트 처리 가이드

### 1. 빈 데이터 처리
```javascript
// 모든 응답은 동일한 구조 보장
const response = await fetchWeatherData(date);

// 각 필드별로 데이터 있는지 확인
if (response.openweathermap.forecast.length > 0) {
  showForecast(response.openweathermap.forecast);
} else {
  showMessage("OpenWeather 예보 정보가 없습니다");
}

if (response.weather_forecasts.length > 0) {
  showKmaShortTerm(response.weather_forecasts);
} else {
  showMessage("기상청 단기 예보 정보가 없습니다");
}
```

### 2. 날짜 선택 UI 제한
```javascript
// 추천: 날짜 선택을 데이터 가용 범위로 제한
const maxDate = new Date();
maxDate.setDate(maxDate.getDate() + 13); // 조석 기준 최대 13일

datePickerConfig = {
  minDate: new Date(),
  maxDate: maxDate,
  warningMessage: "예보 데이터는 최대 13일까지 제공됩니다"
};
```

### 3. 데이터 출처별 표시
```javascript
// 사용자에게 데이터 출처와 기간 안내
const dataInfo = {
  tide: "국립해양조사원 (14일)",
  kmaShort: "기상청 단기예보 (3일)",
  kmaMedium: "기상청 중기예보 (4~11일째)",
  openWeather: "OpenWeatherMap (최대 8일)"
};

// 선택 날짜에 따라 안내 메시지 변경
if (selectedDate > today + 7) {
  showWarning("OpenWeather 예보는 제공되지 않을 수 있습니다");
}
```

---

## FAQ

### Q1: 내일 날짜로 조회하면 왜 OpenWeather 데이터가 7일치만 있나요?
**A**: 정상입니다. OpenWeather는 "수집 시점부터 8일" 예보를 제공하므로, 내일 조회 시 7일치만 남습니다. 내일 새벽 크론잡이 실행되면 다시 8일치로 갱신됩니다.

### Q2: 과거 날짜를 조회하면 어떻게 되나요?
**A**:
- **조석/기상청**: 과거 데이터가 DB에 보존되어 있다면 반환됩니다
- **해양 관측**: 보존 기간 내 데이터 반환
- **OpenWeather**: 과거 날짜 데이터는 거의 없음 (현재 예보만 수집)

### Q3: 모든 데이터를 14일치로 맞출 수 없나요?
**A**: 불가능합니다. 각 API가 제공하는 기간이 다르기 때문입니다:
- 조석: 천문학적 계산으로 장기 예측 가능
- 기상청 단기: 3일까지만 정확도 보장
- OpenWeather: 8일 이후는 신뢰도 낮음

### Q4: 최적화가 필요하지 않나요? (데이터 없으면 쿼리 skip)
**A**: 불필요합니다:
- 성능 개선 미미 (~10ms, 10KB)
- API 일관성 유지가 더 중요
- 클라이언트에서 빈 배열 처리가 더 간단

---

## 권장 사항

### 서버
1. ✅ **크론잡 설정**: 매일 자동 수집 필수
   - OpenWeather: 매일 새벽 1시
   - 기상청 중기: 하루 2회 (06:00, 18:00)
   - 기상청 단기: 매시간
   - 해양 관측: 매시간

2. ✅ **API 일관성 유지**: 날짜 관계없이 동일한 구조 반환

3. ✅ **문서화**: 클라이언트 개발자에게 제한사항 명확히 안내

### 클라이언트
1. ✅ **빈 데이터 처리**: 모든 필드가 빈 배열일 수 있음을 가정
2. ✅ **날짜 범위 제한**: UI에서 13일 이후 선택 불가
3. ✅ **안내 메시지**: 데이터 출처와 기간 명시

---

## 변경 이력

### 2025-12-09
- 초안 작성
- OpenWeatherMap 5 Day Forecast 추가 반영
- 미래 날짜 조회 동작 명세화
