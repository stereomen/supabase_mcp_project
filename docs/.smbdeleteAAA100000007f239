# GET Weather Tide Data API 명세서

## 개요
통합 기상, 조석, 해양 관측 데이터, 중기예보 정보 및 **WeatherAPI.com 상세 기상예보**를 제공하는 API

## 기본 정보
- **URL**: `/functions/v1/get-weather-tide-data`
- **Method**: `GET`
- **Authentication**: 불필요 (JWT 검증 비활성화)

## 요청 파라미터

### Query Parameters
| 파라미터 | 타입 | 필수 | 설명 | 예시 |
|----------|------|------|------|------|
| `code` | string | 필수 | 지역 코드 | `DT_0001` |
| `date` | string | 필수 | 기준 날짜 (YYYY-MM-DD) | `2025-09-04` |
| `time` | string | 선택 | 시간 (HHMM 형식) | `1400` |

### 요청 예시
```
GET /functions/v1/get-weather-tide-data?code=DT_0001&date=2025-09-04&time=1400
```

## 응답 구조

### 성공 응답 (200 OK)
```json
{
  "weather_forecasts": [
    {
      "fcst_datetime_kr": "2025-09-04T15:00:00+09:00",
      "tmp": 25.0,
      "tmn": 20.0,
      "tmx": 28.0,
      "uuu": 2.5,
      "vvv": -1.2,
      "vec": 225,
      "wsd": 3.5,
      "sky": 3,
      "pty": 0,
      "pop": 20,
      "wav": 0.5,
      "pcp": "강수없음",
      "reh": 65,
      "sno": "적설없음"
    }
  ],
  "tide_data": [
    {
      "obs_date": "2025-09-04",
      "lvl1": "07:30:150",
      "lvl2": "13:45:320",
      "lvl3": "20:15:80",
      "lvl4": "02:10:280",
      "date_sun": "06:15:19:20",
      "date_moon": "14:30:03:45",
      "mool_normal": "중조",
      "mool7": "간조",
      "mool8": "만조"
    }
  ],
  "marine_observations": {
    "a": [
      {
        "station_id": "22184",
        "observation_time_kst": "202509041400",
        "water_temperature": 24.5,
        "significant_wave_height": 0.8
      }
    ],
    "b": [
      {
        "station_id": "22185",
        "observation_time_kst": "202509041400",
        "air_temperature": 25.2,
        "wind_direction": 225,
        "wind_speed": 3.2
      }
    ]
  },
  "marine": [
    {
      "reg_id": "12A10000",
      "reg_sp": "I",
      "reg_name": "서해북부",
      "mod": "A02",
      "tm_fc": "2025-09-04T09:00:00Z",
      "tm_fc_kr": "2025-09-04T18:00:00+09:00",
      "tm_ef": "2025-09-07T15:00:00Z",
      "tm_ef_kr": "2025-09-08T00:00:00+09:00",
      "wh_a": 1.0,
      "wh_b": 2.0,
      "wf": "흐리고 비",
      "sky": "WB04",
      "pre": "WB09",
      "conf": null,
      "rn_st": 0,
      "forecast_type": "marine"
    }
  ],
  "temper": [
    {
      "reg_id": "11B20201",
      "reg_sp": "C",
      "reg_name": "인천",
      "mod": "A01",
      "tm_fc": "2025-09-04T09:00:00Z",
      "tm_fc_kr": "2025-09-04T18:00:00+09:00",
      "tm_ef": "2025-09-07T15:00:00Z",
      "tm_ef_kr": "2025-09-08T00:00:00+09:00",
      "c": "2",
      "min_temp": 22,
      "max_temp": 28,
      "min_temp_l": 1,
      "min_temp_h": 1,
      "max_temp_l": 1,
      "max_temp_h": 1,
      "sky": null,
      "pre": null,
      "conf": null,
      "wf": null,
      "rn_st": 0,
      "forecast_type": "temperature"
    }
  ],
  "weatherapi": {
    "hourly": [
      {
        "forecast_date": "2025-10-03",
        "forecast_time": "15:00",
        "observation_time_utc": "2025-10-03T06:00:00Z",
        "temp_c": 22.0,
        "temp_f": 71.6,
        "condition_text": "Partly cloudy",
        "condition_icon": "//cdn.weatherapi.com/weather/64x64/day/116.png",
        "condition_code": 1003,
        "wind_kph": 13.0,
        "wind_degree": 220,
        "wind_direction": "SW",
        "humidity": 65,
        "cloud": 50,
        "feelslike_c": 23.5,
        "precip_mm": 0.0,
        "is_day": true
      }
    ]
  }
}
```

## 데이터 필드 상세 설명

### 1. weather_forecasts (기상예보 - 3일치)
| 필드 | 타입 | 단위 | 설명 |
|------|------|------|------|
| `fcst_datetime_kr` | string | - | 예보시각 (KST) |
| `tmp` | number | ℃ | 기온 |
| `tmn` | number | ℃ | 최저기온 |
| `tmx` | number | ℃ | 최고기온 |
| `uuu` | number | m/s | 동서바람성분 |
| `vvv` | number | m/s | 남북바람성분 |
| `vec` | number | deg | 풍향 |
| `wsd` | number | m/s | 풍속 |
| `sky` | number | - | 하늘상태 (1:맑음, 3:구름많음, 4:흐림) |
| `pty` | number | - | 강수형태 (0:없음, 1:비, 2:비/눈, 3:눈, 5:빗방울, 6:빗방울눈날림, 7:눈날림) |
| `pop` | number | % | 강수확률 |
| `wav` | number | m | 파고 |
| `pcp` | string | mm | 1시간 강수량 |
| `reh` | number | % | 습도 |
| `sno` | string | cm | 1시간 신적설 |

### 2. tide_data (조석정보 - 10일치)
| 필드 | 타입 | 설명 |
|------|------|------|
| `obs_date` | string | 관측일 (YYYY-MM-DD) |
| `lvl1` | string | 1차 조석시간:높이 |
| `lvl2` | string | 2차 조석시간:높이 |
| `lvl3` | string | 3차 조석시간:높이 |
| `lvl4` | string | 4차 조석시간:높이 |
| `date_sun` | string | 일출:일몰 시간 |
| `date_moon` | string | 월출:월몰 시간 |
| `mool_normal` | string | 조석 패턴 (일반) |
| `mool7` | string | 조석 패턴 (7) |
| `mool8` | string | 조석 패턴 (8) |

### 3. marine_observations (해양관측)
#### A 관측소 (수온, 파고)
| 필드 | 타입 | 단위 | 설명 |
|------|------|------|------|
| `station_id` | string | - | 관측소 ID |
| `observation_time_kst` | string | - | 관측시간 (YYYYMMDDHHMM) |
| `water_temperature` | number | ℃ | 수온 |
| `significant_wave_height` | number | m | 유의파고 |

#### B 관측소 (기온, 바람)
| 필드 | 타입 | 단위 | 설명 |
|------|------|------|------|
| `station_id` | string | - | 관측소 ID |
| `observation_time_kst` | string | - | 관측시간 (YYYYMMDDHHMM) |
| `air_temperature` | number | ℃ | 기온 |
| `wind_direction` | number | deg | 풍향 |
| `wind_speed` | number | m/s | 풍속 |

### 4. marine (중기 해상예보 - 4~10일째)
| 필드 | 타입 | 설명 |
|------|------|------|
| `reg_id` | string | 지역 ID |
| `reg_sp` | string | 지역 구분 (I: 해상) |
| `reg_name` | string | 지역명 |
| `mod` | string | 모델 구분 |
| `tm_fc` | string | 발표시각 (UTC) |
| `tm_fc_kr` | string | 발표시각 (KST) |
| `tm_ef` | string | 예보시각 (UTC) |
| `tm_ef_kr` | string | 예보시각 (KST) |
| `wh_a` | number | 파고 범위 시작값 |
| `wh_b` | number | 파고 범위 끝값 |
| `wf` | string | 날씨 예보 |
| `sky` | string | 하늘상태 코드 |
| `pre` | string | 강수 코드 |
| `conf` | string | 신뢰도 |
| `rn_st` | number | 강수상태 |
| `forecast_type` | string | 예보 타입 ("marine") |

### 5. temper (중기 기온예보 - 4~10일째)
| 필드 | 타입 | 단위 | 설명 |
|------|------|------|------|
| `reg_id` | string | - | 지역 ID |
| `reg_sp` | string | - | 지역 구분 (C: 시군구) |
| `reg_name` | string | - | 지역명 |
| `mod` | string | - | 모델 구분 |
| `tm_fc` | string | - | 발표시각 (UTC) |
| `tm_fc_kr` | string | - | 발표시각 (KST) |
| `tm_ef` | string | - | 예보시각 (UTC) |
| `tm_ef_kr` | string | - | 예보시각 (KST) |
| `c` | string | - | 일자 구분 |
| `min_temp` | number | ℃ | 최저기온 |
| `max_temp` | number | ℃ | 최고기온 |
| `min_temp_l` | number | - | 최저기온 하한 |
| `min_temp_h` | number | - | 최저기온 상한 |
| `max_temp_l` | number | - | 최고기온 하한 |
| `max_temp_h` | number | - | 최고기온 상한 |
| `sky` | string | - | 하늘상태 |
| `pre` | string | - | 강수확률 |
| `conf` | string | - | 신뢰도 |
| `wf` | string | - | 날씨 예보 |
| `rn_st` | number | - | 강수상태 |
| `forecast_type` | string | - | 예보 타입 ("temperature") |

### 6. weatherapi (WeatherAPI.com 시간별 기상예보)

#### hourly (시간별 예보 - 14일간 336시간)
| 필드 | 타입 | 단위 | 설명 |
|------|------|------|------|
| `forecast_date` | string | - | 예보 날짜 (YYYY-MM-DD) |
| `forecast_time` | string | - | 예보 시간 (HH:MM) |
| `observation_time_utc` | string | - | 예보시간 (UTC) |
| `temp_c` | number | ℃ | 시간별 온도 |
| `temp_f` | number | ℉ | 시간별 온도 (화씨) |
| `condition_text` | string | - | 날씨 상태 |
| `condition_icon` | string | - | 날씨 아이콘 URL |
| `condition_code` | number | - | 날씨 상태 코드 |
| `wind_kph` | number | km/h | 풍속 |
| `wind_degree` | number | deg | 풍향 (0-360도) |
| `wind_direction` | string | - | 풍향 (N, NE, E, SE, S, SW, W, NW) |
| `gust_kph` | number | km/h | 돌풍 |
| `pressure_mb` | number | mb | 기압 |
| `humidity` | number | % | 습도 |
| `visibility_km` | number | km | 가시거리 |
| `cloud` | number | % | 운량 |
| `feelslike_c` | number | ℃ | 체감온도 |
| `uv` | number | - | 자외선 지수 |
| `precip_mm` | number | mm | 강수량 |
| `is_day` | boolean | - | 주간/야간 구분 |

## 데이터 범위
- **기상예보**: 기준일부터 3일치 (D+0 ~ D+2)
- **조석정보**: 기준일부터 10일치 (D+0 ~ D+9)
- **해양관측**: 기준일 시점의 실시간 관측 데이터
- **중기 해상예보**: 기준일 4일째부터 10일째까지 (D+3 ~ D+9)
- **중기 기온예보**: 기준일 4일째부터 10일째까지 (D+3 ~ D+9)
- **WeatherAPI 시간별예보**: 기준일부터 14일간 시간별 상세 예보 (336시간)

## 오류 응답

### 400 Bad Request
```json
{
  "error": "Missing required parameters: code and date are required."
}
```

### 500 Internal Server Error
```json
{
  "error": "An unexpected critical error occurred."
}
```

## 사용 예시

### cURL
```bash
curl -X GET "https://your-project.supabase.co/functions/v1/get-weather-tide-data?code=DT_0001&date=2025-09-04&time=1400"
```

### JavaScript
```javascript
const response = await fetch(
  'https://your-project.supabase.co/functions/v1/get-weather-tide-data?code=DT_0001&date=2025-09-04&time=1400'
);
const data = await response.json();
console.log(data);
```

## 주요 특징

### 통합 기상해양 정보
- **단기예보 (3일)**: KMA 기상청 데이터
- **중기예보 (4-10일)**: KMA 중기예보 데이터
- **상세예보 (14일)**: WeatherAPI.com 시간별 데이터
- **해양정보**: 실시간 관측 + 조석 데이터

### 데이터 정확도
- **시간별예보**: WeatherAPI.com 14일간 336시간 상세 예보
- **해양관측**: 30분 단위 실시간 관측
- **조석정보**: 10일간 정확한 만조/간조 시간

## 주의사항
- 모든 시간은 KST(한국표준시) 기준으로 제공 (WeatherAPI 데이터 제외)
- WeatherAPI 데이터는 UTC 및 현지시간 모두 제공
- 중기예보 데이터는 해당 지역의 marine_reg_id, temper_reg_id가 설정된 경우에만 반환
- 해양 관측 데이터는 관측소별로 다른 정보 제공 (A: 수온/파고, B: 기온/바람)
- time 파라미터는 선택사항이며, 해양 관측 데이터 필터링에만 사용
- WeatherAPI 데이터는 code 매개변수로 연동되며, tide_abs_region 테이블의 지역 코드를 사용
- 일부 지역의 WeatherAPI 데이터가 없을 경우 빈 배열로 반환됨