# M4 í™˜ê²½ Supabase ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

M4 ë§¥ë¯¸ë‹ˆ + Docker í™˜ê²½ì—ì„œ Supabase í”„ë¡œì íŠ¸ë¥¼ ë¹ ë¥´ê²Œ ì‹œì‘í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

## ğŸš€ ë¹ ë¥¸ ì„¤ì¹˜ (5ë¶„)

### 1ë‹¨ê³„: CLI ì„¤ì¹˜
```bash
# ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ì „ì—­ ì„¤ì¹˜ í¬í•¨)
./m4-supabase/install-supabase-cli.sh

# ë˜ëŠ” ìˆ˜ë™ ì „ì—­ ì„¤ì¹˜
curl -sSL https://github.com/supabase/cli/releases/latest/download/supabase_linux_arm64.tar.gz | tar -xz -C /tmp
chmod +x /tmp/supabase
sudo cp /tmp/supabase /usr/local/bin/supabase
```

### 2ë‹¨ê³„: PostgreSQL í´ë¼ì´ì–¸íŠ¸ ì„¤ì¹˜
```bash
sudo apt-get update && sudo apt-get install -y postgresql-client
```

### 3ë‹¨ê³„: í™˜ê²½ë³€ìˆ˜ í™•ì¸
```bash
# .env íŒŒì¼ ë‚´ìš© í™•ì¸
cat .env

# í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
source .env

# ì—°ê²° í…ŒìŠ¤íŠ¸
curl -I $SUPABASE_URL
```

## âš¡ í•µì‹¬ ëª…ë ¹ì–´

### CLI ì‚¬ìš©
```bash
# PATH ì„¤ì • (ë§¤ ì„¸ì…˜ë§ˆë‹¤ í•„ìš”)
export PATH="/tmp:$PATH"

# ë²„ì „ í™•ì¸
supabase --version

# ë„ì›€ë§
supabase --help
```

### ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
```bash
# REST APIë¡œ í…Œì´ë¸” ëª©ë¡ í™•ì¸
source .env
curl -H "apikey: $SUPABASE_SERVICE_ROLE_KEY" \
     -H "Authorization: Bearer $SUPABASE_SERVICE_ROLE_KEY" \
     "$SUPABASE_URL/rest/v1/" | jq '.'
```

### í•¨ìˆ˜ ë°°í¬
```bash
# íŠ¹ì • í•¨ìˆ˜ ë°°í¬
supabase functions deploy get-kma-weather --no-verify-jwt

# ëª¨ë“  í•¨ìˆ˜ ë°°í¬
supabase functions deploy --no-verify-jwt
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
í”„ë¡œì íŠ¸/
â”œâ”€â”€ .env                          # í™˜ê²½ë³€ìˆ˜ ì„¤ì •
â”œâ”€â”€ m4-supabase/                  # M4 í™˜ê²½ ë¬¸ì„œ
â”‚   â”œâ”€â”€ README.md                 # ìƒì„¸ ê°€ì´ë“œ
â”‚   â”œâ”€â”€ install-supabase-cli.sh   # ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ troubleshooting.md        # ë¬¸ì œ í•´ê²°
â”‚   â””â”€â”€ quick-start.md            # ì´ íŒŒì¼
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ functions/                # Edge Functions
â”‚   â”‚   â”œâ”€â”€ get-kma-weather/      # ê¸°ìƒ ë°ì´í„° ìˆ˜ì§‘
â”‚   â”‚   â”œâ”€â”€ get-medm-weather/     # ì¤‘ê¸°ì˜ˆë³´ ìˆ˜ì§‘
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ migrations/               # ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
â””â”€â”€ docs/                         # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

## ğŸ”§ ì£¼ìš” ì‘ì—…ë“¤

### ìƒˆ í•¨ìˆ˜ ìƒì„±
```bash
# í•¨ìˆ˜ ìƒì„±
supabase functions new my-function

# í•¨ìˆ˜ ê°œë°œ (TypeScript)
# supabase/functions/my-function/index.ts í¸ì§‘

# í•¨ìˆ˜ ë°°í¬
supabase functions deploy my-function --no-verify-jwt
```

### ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…
```bash
# ìŠ¤í‚¤ë§ˆ í™•ì¸ (REST API ì‚¬ìš©)
curl -H "Authorization: Bearer $SUPABASE_SERVICE_ROLE_KEY" \
     "$SUPABASE_URL/rest/v1/" | jq '.paths | keys'

# í…Œì´ë¸” ë°ì´í„° í™•ì¸
curl -H "Authorization: Bearer $SUPABASE_SERVICE_ROLE_KEY" \
     "$SUPABASE_URL/rest/v1/weather_forecasts?limit=5" | jq '.'
```

### ë¡œê·¸ í™•ì¸
```bash
# í•¨ìˆ˜ ë¡œê·¸ ë³´ê¸°
supabase functions logs get-kma-weather

# ì‹¤ì‹œê°„ ë¡œê·¸
supabase functions logs get-kma-weather --follow
```

## ğŸŒ ìœ ìš©í•œ REST API ì—”ë“œí¬ì¸íŠ¸

```bash
# ê¸°ë³¸ URL
export API_BASE="$SUPABASE_URL/rest/v1"
export AUTH_HEADER="Authorization: Bearer $SUPABASE_SERVICE_ROLE_KEY"

# í…Œì´ë¸” ëª©ë¡
curl -H "$AUTH_HEADER" "$API_BASE/" | jq '.paths | keys'

# íŠ¹ì • í…Œì´ë¸” ë°ì´í„°
curl -H "$AUTH_HEADER" "$API_BASE/marine_observations?limit=3" | jq '.'

# í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ë³´
curl -H "$AUTH_HEADER" "$API_BASE/" | jq '.definitions.marine_observations'
```

## ğŸ“‹ ì¼ì¼ ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸

### í”„ë¡œì íŠ¸ ì‹œì‘ ì‹œ
- [ ] `source .env` í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
- [ ] `export PATH="/tmp:$PATH"` CLI ì„¤ì •
- [ ] `curl -I $SUPABASE_URL` ì—°ê²° í™•ì¸

### ê°œë°œ ì¤‘
- [ ] í•¨ìˆ˜ ì½”ë“œ ìˆ˜ì •
- [ ] `supabase functions deploy FUNCTION_NAME` ë°°í¬
- [ ] í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ ë° ë¡œê·¸ í™•ì¸

### ë¬¸ì œ ë°œìƒ ì‹œ
- [ ] `m4-supabase/troubleshooting.md` ì°¸ê³ 
- [ ] í™˜ê²½ë³€ìˆ˜ ë° ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
- [ ] REST API ëŒ€ì•ˆ ë°©ë²• ì‹œë„

## ğŸ”— ë¹ ë¥¸ ë§í¬

- **Supabase ëŒ€ì‹œë³´ë“œ**: https://supabase.com/dashboard
- **í”„ë¡œì íŠ¸ URL**: https://iwpgvdtfpwazzfeniusk.supabase.co
- **í•¨ìˆ˜ URL**: https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1/

## ğŸ’¡ íŒê³¼ ìš”ë ¹

1. **PATH ì„¤ì •**: `.bashrc`ì— `export PATH="/tmp:$PATH"` ì¶”ê°€í•˜ë©´ ë§¤ë²ˆ ì„¤ì •í•  í•„ìš” ì—†ìŒ
2. **í™˜ê²½ë³€ìˆ˜**: `alias senv='source .env'` ë³„ì¹­ ë§Œë“¤ì–´ì„œ ë¹ ë¥¸ ë¡œë“œ
3. **API í…ŒìŠ¤íŠ¸**: Postman ëŒ€ì‹  `curl` + `jq` ì¡°í•© ì‚¬ìš©
4. **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**: ê°œë°œ ì‹œ `supabase functions logs --follow` ì‹¤ì‹œê°„ í™•ì¸
5. **ë°±ì—…**: ì¤‘ìš”í•œ ë³€ê²½ ì „ `pg_dump` ë˜ëŠ” REST APIë¡œ ë°ì´í„° ë°±ì—…

## ğŸš¨ ì£¼ì˜ì‚¬í•­

- **ì•„í‚¤í…ì²˜**: ë°˜ë“œì‹œ ARM64 (`linux_arm64`) ë°”ì´ë„ˆë¦¬ ì‚¬ìš©
- **Docker**: ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ì‹œ `/tmp` íŒŒì¼ ì‚­ì œë¨ (ì¬ì„¤ì¹˜ í•„ìš”)
- **ë„¤íŠ¸ì›Œí¬**: Docker í™˜ê²½ì—ì„œ ì§ì ‘ DB ì—°ê²° ì œí•œì  (REST API ê¶Œì¥)
- **ê¶Œí•œ**: ì„œë¹„ìŠ¤ ì—­í•  í‚¤ ë…¸ì¶œ ì£¼ì˜ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©)