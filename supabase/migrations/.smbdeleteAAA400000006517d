-- supabase/migrations/20250716110001_recreate_rpc_with_correct_types.sql

CREATE OR REPLACE FUNCTION get_marine_observations_by_station_id(
    p_station_id INT,
    p_date TEXT
)
RETURNS TABLE (
    observation_time_kst VARCHAR(14), -- TEXT -> VARCHAR(14)로 수정
    significant_wave_height REAL,
    wind_direction REAL,
    wind_speed REAL,
    gust_wind_speed REAL,
    water_temperature REAL,
    air_temperature REAL,
    pressure REAL,
    humidity REAL
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        mo.observation_time_kst,
        mo.significant_wave_height,
        mo.wind_direction,
        mo.wind_speed,
        mo.gust_wind_speed,
        mo.water_temperature,
        mo.air_temperature,
        mo.pressure,
        mo.humidity
    FROM
        public.marine_observations mo
    WHERE
        mo.station_id = p_station_id
        AND TO_CHAR(mo.observation_time_utc, 'YYYY-MM-DD') = p_date
    ORDER BY
        mo.observation_time_utc;
END;
$$ LANGUAGE plpgsql;
