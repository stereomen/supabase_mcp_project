<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´‘ê³  ì‹œìŠ¤í…œ ë§ˆì´ê·¸ë ˆì´ì…˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .content {
            padding: 30px;
        }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .step h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .step p {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin: 10px 0;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .sql-preview {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }
        .link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ê´‘ê³  ì‹œìŠ¤í…œ ë§ˆì´ê·¸ë ˆì´ì…˜</h1>
            <p>ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ë° ë·°ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤</p>
        </div>

        <div class="content">
            <div class="step">
                <h2>ğŸ“‹ 1ë‹¨ê³„: SQL ë³µì‚¬í•˜ê¸°</h2>
                <p>ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ SQLì´ ìë™ìœ¼ë¡œ í´ë¦½ë³´ë“œì— ë³µì‚¬ë©ë‹ˆë‹¤.</p>
                <button onclick="copySQLToClipboard()">ğŸ“‹ SQL ë³µì‚¬í•˜ê¸°</button>
                <div id="copyStatus"></div>
            </div>

            <div class="step">
                <h2>ğŸ”— 2ë‹¨ê³„: SQL Editor ì—´ê¸°</h2>
                <p>Supabase SQL Editorë¥¼ ìƒˆ íƒ­ì—ì„œ ì—½ë‹ˆë‹¤.</p>
                <button onclick="openSQLEditor()">ğŸ”— SQL Editor ì—´ê¸°</button>
            </div>

            <div class="step">
                <h2>â–¶ï¸ 3ë‹¨ê³„: SQL ì‹¤í–‰í•˜ê¸°</h2>
                <p>SQL Editorì—ì„œ:</p>
                <ol style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Ctrl+V</strong> (ë˜ëŠ” Cmd+V)ë¡œ ë³µì‚¬í•œ SQL ë¶™ì—¬ë„£ê¸°</li>
                    <li><strong>Run</strong> ë²„íŠ¼ í´ë¦­ ë˜ëŠ” <strong>Ctrl+Enter</strong></li>
                    <li>ì„±ê³µ ë©”ì‹œì§€ í™•ì¸</li>
                </ol>
            </div>

            <div class="step">
                <h2>âœ… ì™„ë£Œ í™•ì¸</h2>
                <p>ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì„±ê³µí•˜ë©´ ì•„ë˜ í˜ì´ì§€ë“¤ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤:</p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><a href="ad-partners.html" class="link">ì œíœ´ì‚¬ ê´€ë¦¬</a></li>
                    <li><a href="ad-post.html" class="link">ê´‘ê³  ìº í˜ì¸ ë“±ë¡</a></li>
                    <li><a href="ad-analytics.html" class="link">ê´‘ê³  ì„±ê³¼ ë¶„ì„</a></li>
                    <li><a href="ad-partner-analytics.html" class="link">ì œíœ´ì‚¬ ì„±ê³¼ ì¡°íšŒ</a></li>
                </ul>
            </div>

            <div class="step" style="background: #fff3cd; border-left-color: #ffc107;">
                <h2>ğŸ² ë³´ë„ˆìŠ¤: ë”ë¯¸ ë°ì´í„° ì‚½ì… (ì„ íƒì‚¬í•­)</h2>
                <p>í…ŒìŠ¤íŠ¸ìš© ì œíœ´ì‚¬ 5ê°œ, ê´‘ê³  ìº í˜ì¸ 11ê°œ, ì´ë²¤íŠ¸ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.</p>
                <button onclick="copyDummyDataSQL()" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);">
                    ğŸ² ë”ë¯¸ ë°ì´í„° SQL ë³µì‚¬í•˜ê¸°
                </button>
                <div id="dummyStatus"></div>
                <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    â€» ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„ì— ì‹¤í–‰í•˜ì„¸ìš”<br>
                    â€» í¬í•¨ ë‚´ìš©: ì œíœ´ì‚¬ 5ê°œ, í˜„ì¬/ì˜ˆì •/ì¢…ë£Œ ìº í˜ì¸ 11ê°œ, ì¡°íšŒ/í´ë¦­ ì´ë²¤íŠ¸ ìˆ˜ë°± ê±´
                </p>
            </div>
        </div>
    </div>

    <script>
        const migrationSQL = `-- ============================================
-- ê´‘ê³  ì‹œìŠ¤í…œ í†µí•© ë§ˆì´ê·¸ë ˆì´ì…˜
-- ì‹¤í–‰ì¼: 2025-12-23
-- ============================================

-- 1. ad_repo í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS ad_repo (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    partner_id TEXT NOT NULL REFERENCES ad_partners(partner_id),
    campaign_name TEXT NOT NULL,
    matched_station_id TEXT,
    matched_area TEXT,
    ad_type_a TEXT,
    ad_type_b TEXT,
    image_a_url TEXT,
    image_b_url TEXT,
    landing_url TEXT,
    display_start_date DATE NOT NULL,
    display_end_date DATE NOT NULL,
    is_active BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 0,
    description TEXT,
    additional_data JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    CONSTRAINT valid_display_period CHECK (display_end_date >= display_start_date),
    CONSTRAINT valid_priority CHECK (priority >= 0)
);

CREATE INDEX IF NOT EXISTS idx_ad_repo_station_active ON ad_repo(matched_station_id, is_active) WHERE is_active = true;
CREATE INDEX IF NOT EXISTS idx_ad_repo_area_active ON ad_repo(matched_area, is_active) WHERE is_active = true;
CREATE INDEX IF NOT EXISTS idx_ad_repo_display_period ON ad_repo(display_start_date, display_end_date) WHERE is_active = true;
CREATE INDEX IF NOT EXISTS idx_ad_repo_partner_id ON ad_repo(partner_id);
CREATE INDEX IF NOT EXISTS idx_ad_repo_station_date_active ON ad_repo(matched_station_id, display_start_date, display_end_date, is_active) WHERE is_active = true;

ALTER TABLE ad_repo DISABLE ROW LEVEL SECURITY;

-- 2. ad_analytics í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS ad_analytics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ad_repo_id UUID NOT NULL REFERENCES ad_repo(id) ON DELETE CASCADE,
    event_type TEXT NOT NULL,
    station_id TEXT,
    event_timestamp TIMESTAMPTZ DEFAULT NOW(),
    event_date DATE,
    user_agent TEXT,
    ip_address TEXT,
    additional_data JSONB,
    CONSTRAINT valid_event_type CHECK (event_type IN ('impression', 'click'))
);

-- event_date ìë™ ì„¤ì • íŠ¸ë¦¬ê±° í•¨ìˆ˜
CREATE OR REPLACE FUNCTION set_ad_analytics_event_date()
RETURNS TRIGGER AS $$
BEGIN
    NEW.event_date := (NEW.event_timestamp AT TIME ZONE 'UTC')::DATE;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- íŠ¸ë¦¬ê±° ìƒì„±
DROP TRIGGER IF EXISTS trg_set_ad_analytics_event_date ON ad_analytics;
CREATE TRIGGER trg_set_ad_analytics_event_date
    BEFORE INSERT OR UPDATE ON ad_analytics
    FOR EACH ROW
    EXECUTE FUNCTION set_ad_analytics_event_date();

CREATE INDEX IF NOT EXISTS idx_ad_analytics_repo_id ON ad_analytics(ad_repo_id);
CREATE INDEX IF NOT EXISTS idx_ad_analytics_event_type ON ad_analytics(event_type);
CREATE INDEX IF NOT EXISTS idx_ad_analytics_date ON ad_analytics(event_date);
CREATE INDEX IF NOT EXISTS idx_ad_analytics_repo_date ON ad_analytics(ad_repo_id, event_date);
CREATE INDEX IF NOT EXISTS idx_ad_analytics_timestamp ON ad_analytics(event_timestamp DESC);
CREATE INDEX IF NOT EXISTS idx_ad_analytics_repo_event_date ON ad_analytics(ad_repo_id, event_type, event_date);

ALTER TABLE ad_analytics DISABLE ROW LEVEL SECURITY;

-- 3. ì„±ê³¼ ìš”ì•½ ë·°
CREATE OR REPLACE VIEW ad_analytics_daily_summary AS
SELECT
    ad_repo_id,
    event_date,
    COUNT(*) FILTER (WHERE event_type = 'impression') as impressions,
    COUNT(*) FILTER (WHERE event_type = 'click') as clicks,
    CASE
        WHEN COUNT(*) FILTER (WHERE event_type = 'impression') > 0
        THEN ROUND((COUNT(*) FILTER (WHERE event_type = 'click')::NUMERIC / COUNT(*) FILTER (WHERE event_type = 'impression')::NUMERIC) * 100, 2)
        ELSE 0
    END as ctr_percentage
FROM ad_analytics
GROUP BY ad_repo_id, event_date
ORDER BY event_date DESC, ad_repo_id;

CREATE OR REPLACE VIEW ad_analytics_campaign_summary AS
SELECT
    a.ad_repo_id,
    r.campaign_name,
    r.partner_id,
    p.partner_name,
    COUNT(*) FILTER (WHERE a.event_type = 'impression') as total_impressions,
    COUNT(*) FILTER (WHERE a.event_type = 'click') as total_clicks,
    CASE
        WHEN COUNT(*) FILTER (WHERE a.event_type = 'impression') > 0
        THEN ROUND((COUNT(*) FILTER (WHERE a.event_type = 'click')::NUMERIC / COUNT(*) FILTER (WHERE a.event_type = 'impression')::NUMERIC) * 100, 2)
        ELSE 0
    END as overall_ctr_percentage,
    MIN(a.event_timestamp) as first_event,
    MAX(a.event_timestamp) as last_event
FROM ad_analytics a
JOIN ad_repo r ON a.ad_repo_id = r.id
LEFT JOIN ad_partners p ON r.partner_id = p.partner_id
GROUP BY a.ad_repo_id, r.campaign_name, r.partner_id, p.partner_name
ORDER BY total_impressions DESC;

-- 4. ê´‘ê³  ì €ì¥ì†Œ ë·°
CREATE OR REPLACE VIEW ad_repo_view AS
SELECT
    r.id, r.partner_id, r.campaign_name, r.matched_station_id, r.matched_area,
    r.ad_type_a, r.ad_type_b, r.image_a_url, r.image_b_url, r.landing_url,
    r.display_start_date, r.display_end_date, r.is_active, r.priority,
    r.description, r.additional_data as ad_additional_data, r.created_at, r.updated_at,
    p.partner_name, p.address, p.phone, p.contact_name, p.business_type, p.business_level,
    p.staff_name_1, p.staff_name_2, p.staff_name_3, p.additional_data as partner_additional_data,
    CURRENT_DATE BETWEEN r.display_start_date AND r.display_end_date as is_currently_active,
    r.display_end_date - CURRENT_DATE as days_remaining,
    CURRENT_DATE - r.display_start_date as days_since_start
FROM ad_repo r
LEFT JOIN ad_partners p ON r.partner_id = p.partner_id
ORDER BY r.priority DESC, r.created_at DESC;

CREATE OR REPLACE VIEW ad_repo_active_view AS
SELECT * FROM ad_repo_view
WHERE is_active = true AND CURRENT_DATE BETWEEN display_start_date AND display_end_date
ORDER BY priority DESC, created_at DESC;

-- 5. ê´‘ê³  ì¡°íšŒ í•¨ìˆ˜
CREATE OR REPLACE FUNCTION get_active_ads_for_station(p_station_id TEXT, p_date DATE DEFAULT CURRENT_DATE)
RETURNS TABLE (
    id UUID, partner_id TEXT, partner_name TEXT, campaign_name TEXT,
    matched_station_id TEXT, matched_area TEXT, ad_type_a TEXT, ad_type_b TEXT,
    image_a_url TEXT, image_b_url TEXT, landing_url TEXT, priority INTEGER,
    business_type TEXT, business_level INTEGER
) AS $$
BEGIN
    RETURN QUERY
    SELECT r.id, r.partner_id, r.partner_name, r.campaign_name, r.matched_station_id,
           r.matched_area, r.ad_type_a, r.ad_type_b, r.image_a_url, r.image_b_url,
           r.landing_url, r.priority, r.business_type, r.business_level
    FROM ad_repo_view r
    WHERE r.is_active = true
      AND p_date BETWEEN r.display_start_date AND r.display_end_date
      AND (r.matched_station_id = p_station_id OR r.matched_station_id IS NULL)
    ORDER BY r.priority DESC, r.created_at DESC
    LIMIT 1;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION get_active_ads_for_area(p_area TEXT, p_date DATE DEFAULT CURRENT_DATE)
RETURNS TABLE (
    id UUID, partner_id TEXT, partner_name TEXT, campaign_name TEXT,
    matched_station_id TEXT, matched_area TEXT, ad_type_a TEXT, ad_type_b TEXT,
    image_a_url TEXT, image_b_url TEXT, landing_url TEXT, priority INTEGER
) AS $$
BEGIN
    RETURN QUERY
    SELECT r.id, r.partner_id, r.partner_name, r.campaign_name, r.matched_station_id,
           r.matched_area, r.ad_type_a, r.ad_type_b, r.image_a_url, r.image_b_url,
           r.landing_url, r.priority
    FROM ad_repo_view r
    WHERE r.is_active = true
      AND p_date BETWEEN r.display_start_date AND r.display_end_date
      AND (r.matched_area = p_area OR r.matched_area IS NULL)
    ORDER BY r.priority DESC, r.created_at DESC
    LIMIT 1;
END;
$$ LANGUAGE plpgsql;

-- 6. ì œíœ´ì‚¬ ë¹„ë°€ë²ˆí˜¸ í•„ë“œ ì¶”ê°€
ALTER TABLE ad_partners ADD COLUMN IF NOT EXISTS password TEXT;
UPDATE ad_partners SET password = partner_id WHERE password IS NULL;

CREATE TABLE IF NOT EXISTS ad_partner_password_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    partner_id TEXT NOT NULL REFERENCES ad_partners(partner_id) ON DELETE CASCADE,
    changed_at TIMESTAMPTZ DEFAULT NOW(),
    changed_by TEXT
);

ALTER TABLE ad_partner_password_history DISABLE ROW LEVEL SECURITY;
CREATE INDEX IF NOT EXISTS idx_password_history_partner ON ad_partner_password_history(partner_id);
CREATE INDEX IF NOT EXISTS idx_password_history_date ON ad_partner_password_history(changed_at DESC);`;

        async function copySQLToClipboard() {
            try {
                await navigator.clipboard.writeText(migrationSQL);
                document.getElementById('copyStatus').innerHTML = '<div class="success">âœ… SQLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                setTimeout(() => {
                    document.getElementById('copyStatus').innerHTML = '';
                }, 3000);
            } catch (err) {
                alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err.message);
            }
        }

        function openSQLEditor() {
            window.open('https://supabase.com/dashboard/project/iwpgvdtfpwazzfeniusk/sql', '_blank');
        }

        const dummyDataSQL = `-- ê´‘ê³  ì‹œìŠ¤í…œ ë”ë¯¸ ë°ì´í„° ì‚½ì…

-- 1. ì œíœ´ì‚¬ ë”ë¯¸ ë°ì´í„°
INSERT INTO ad_partners (partner_id, partner_name, address, phone, contact_name, business_type, business_level, staff_name_1, password)
VALUES
    ('PARTNER_001', 'ë°”ë‹¤ë‚šì‹œ ì „ë¬¸ì ', 'ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ ìš°ë™ 123', '051-123-4567', 'ê¹€í•´ìš´', 'ë‚šì‹œê°€ê²Œ', 5, 'ì´ë¯¼ìˆ˜', 'PARTNER_001'),
    ('PARTNER_002', 'í•´ì–‘ë ˆì € ë§ˆë¦°', 'ì¸ì²œê´‘ì—­ì‹œ ì¤‘êµ¬ ì—°ì•ˆë¶€ë‘ë¡œ 456', '032-987-6543', 'ë°•ì¸ì²œ', 'ì„ ë°•', 4, 'ìµœë°”ë‹¤', 'PARTNER_002'),
    ('PARTNER_003', 'ë‚¨í•´ ì¢ŒëŒ€ë‚šì‹œ', 'ê²½ìƒë‚¨ë„ ë‚¨í•´êµ° ë¯¸ì¡°ë©´ 789', '055-555-8888', 'ì •ë‚¨í•´', 'ì¢ŒëŒ€', 3, 'ê°•ë¬¼ê³ ê¸°', 'PARTNER_003'),
    ('PARTNER_004', 'ì„œí•´ í”¼ì‹±ìƒµ', 'ì¶©ì²­ë‚¨ë„ íƒœì•ˆêµ° ì•ˆë©´ì 101', '041-333-2222', 'ì˜¤ì„œí•´', 'ë‚šì‹œê°€ê²Œ', 4, 'ìœ¤ì¡°ìˆ˜', 'PARTNER_004'),
    ('PARTNER_005', 'ë™í•´ ë§ˆë¦°ìŠ¤í¬ì¸ ', 'ê°•ì›ë„ ì†ì´ˆì‹œ ë™ëª…í•­ 202', '033-444-5555', 'í•œë™í•´', 'ì„ ë°•', 5, 'ì†¡íŒŒë„', 'PARTNER_005')
ON CONFLICT (partner_id) DO NOTHING;

-- 2. ê´‘ê³  ìº í˜ì¸ ë”ë¯¸ ë°ì´í„°
INSERT INTO ad_repo (partner_id, campaign_name, matched_station_id, matched_area, ad_type_a, ad_type_b, image_a_url, image_b_url, landing_url, display_start_date, display_end_date, is_active, priority, description)
VALUES
    ('PARTNER_001', 'ë¶€ì‚° í•´ìš´ëŒ€ ë‚šì‹œ ì¥ë¹„ í• ì¸', 'DT_0005', NULL, 'banner', 'popup', 'https://picsum.photos/800/400?random=1', 'https://picsum.photos/400/600?random=2', 'https://example.com/busan-fishing', CURRENT_DATE - INTERVAL '5 days', CURRENT_DATE + INTERVAL '25 days', true, 10, 'ë¶€ì‚° ì§€ì—­ ë‚šì‹œ ì¥ë¹„ 20% í• ì¸ ì´ë²¤íŠ¸'),
    ('PARTNER_002', 'ì¸ì²œ ì„ ìƒë‚šì‹œ íŒ¨í‚¤ì§€', 'DT_0001', 'ì„œí•´ì¤‘ë¶€', 'banner', 'inline', 'https://picsum.photos/800/400?random=3', 'https://picsum.photos/600/400?random=4', 'https://example.com/incheon-boat', CURRENT_DATE - INTERVAL '10 days', CURRENT_DATE + INTERVAL '20 days', true, 8, 'ì¸ì²œ ì„ ìƒë‚šì‹œ ì£¼ë§ íŠ¹ê°€ - 4ì¸ íŒ¨í‚¤ì§€ 30% í• ì¸'),
    ('PARTNER_003', 'ë‚¨í•´ ì¢ŒëŒ€ë‚šì‹œ ì‹œì¦Œ ì˜¤í”ˆ', NULL, 'ë‚¨í•´ë™ë¶€', 'banner', NULL, 'https://picsum.photos/800/400?random=5', NULL, 'https://example.com/namhae-jwadae', CURRENT_DATE - INTERVAL '3 days', CURRENT_DATE + INTERVAL '27 days', true, 9, 'ë‚¨í•´ ì¢ŒëŒ€ë‚šì‹œ ë´„ ì‹œì¦Œ ì˜¤í”ˆ - ì˜ˆì•½ì ì‚¬ì€í’ˆ ì¦ì •'),
    ('PARTNER_004', 'íƒœì•ˆ ê°¯ë°”ìœ„ ë‚šì‹œíˆ¬ì–´', 'DT_0050', 'ì„œí•´ì¤‘ë¶€', 'banner', 'popup', 'https://picsum.photos/800/400?random=6', 'https://picsum.photos/400/600?random=7', 'https://example.com/taean-tour', CURRENT_DATE, CURRENT_DATE + INTERVAL '30 days', true, 7, 'íƒœì•ˆ ê°¯ë°”ìœ„ ë‚šì‹œíˆ¬ì–´ - ì „ë¬¸ ê°€ì´ë“œ ë™í–‰'),
    ('PARTNER_005', 'ì†ì´ˆ ë§ˆë¦°ìŠ¤í¬ì¸  ì²´í—˜', 'DT_0012', 'ë™í•´ì¤‘ë¶€', 'inline', 'banner', 'https://picsum.photos/600/400?random=8', 'https://picsum.photos/800/400?random=9', 'https://example.com/sokcho-marine', CURRENT_DATE - INTERVAL '7 days', CURRENT_DATE + INTERVAL '23 days', true, 6, 'ì†ì´ˆ ë§ˆë¦°ìŠ¤í¬ì¸  ì—¬ë¦„ ì‹œì¦Œ ì¡°ê¸° ì˜ˆì•½ í• ì¸'),
    ('PARTNER_001', 'ì—¬ë¦„ ë¦´ ë‚šì‹œëŒ€ ì‹ ì œí’ˆ', NULL, NULL, 'banner', 'popup', 'https://picsum.photos/800/400?random=10', 'https://picsum.photos/400/600?random=11', 'https://example.com/summer-reel', CURRENT_DATE + INTERVAL '5 days', CURRENT_DATE + INTERVAL '35 days', true, 5, 'ì—¬ë¦„ ì‹œì¦Œ ì‹ ì œí’ˆ ë¦´ ë‚šì‹œëŒ€ ì‚¬ì „ ì˜ˆì•½'),
    ('PARTNER_003', 'ê°€ì¡± ë‚šì‹œ ì²´í—˜', NULL, 'ë‚¨í•´ì„œë¶€', 'banner', NULL, 'https://picsum.photos/800/400?random=12', NULL, 'https://example.com/family-fishing', CURRENT_DATE + INTERVAL '10 days', CURRENT_DATE + INTERVAL '40 days', true, 4, 'ê°€ì¡±ê³¼ í•¨ê»˜í•˜ëŠ” ë‚šì‹œ ì²´í—˜ í”„ë¡œê·¸ë¨'),
    ('PARTNER_002', 'ê²¨ìš¸ ë°©í•œ ë‚šì‹œë³µ ì„¸ì¼', 'DT_0001', NULL, 'banner', 'inline', 'https://picsum.photos/800/400?random=13', 'https://picsum.photos/600/400?random=14', 'https://example.com/winter-clothes', CURRENT_DATE - INTERVAL '60 days', CURRENT_DATE - INTERVAL '30 days', false, 3, 'ê²¨ìš¸ ì‹œì¦Œ ë°©í•œ ë‚šì‹œë³µ ì¬ê³  ì •ë¦¬ ì„¸ì¼ (ì¢…ë£Œ)'),
    ('PARTNER_004', 'í…ŒìŠ¤íŠ¸ ìº í˜ì¸', 'DT_0050', NULL, 'banner', NULL, 'https://picsum.photos/800/400?random=15', NULL, 'https://example.com/test', CURRENT_DATE, CURRENT_DATE + INTERVAL '30 days', false, 1, 'í…ŒìŠ¤íŠ¸ìš© ìº í˜ì¸ - ë¹„í™œì„±í™”ë¨'),
    ('PARTNER_005', 'ì „êµ­ ë‚šì‹œ í˜ìŠ¤í‹°ë²Œ', NULL, NULL, 'banner', 'popup', 'https://picsum.photos/800/400?random=16', 'https://picsum.photos/400/600?random=17', 'https://example.com/festival', CURRENT_DATE - INTERVAL '2 days', CURRENT_DATE + INTERVAL '28 days', true, 15, 'ì „êµ­ ë‚šì‹œ í˜ìŠ¤í‹°ë²Œ - ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ ë° ê²½í’ˆ í–‰ì‚¬');

-- 3. ê´‘ê³  ì´ë²¤íŠ¸ ë”ë¯¸ ë°ì´í„° (ì¡°íšŒ/í´ë¦­ í†µê³„)
DO $$
DECLARE
    campaign RECORD;
    event_count INTEGER;
    i INTEGER;
BEGIN
    FOR campaign IN
        SELECT id, matched_station_id FROM ad_repo
        WHERE display_start_date <= CURRENT_DATE AND display_end_date >= CURRENT_DATE - INTERVAL '30 days'
    LOOP
        event_count := 100 + floor(random() * 400)::INTEGER;
        FOR i IN 1..event_count LOOP
            INSERT INTO ad_analytics (ad_repo_id, event_type, station_id, event_timestamp)
            VALUES (campaign.id, 'impression', COALESCE(campaign.matched_station_id, 'DT_0001'), CURRENT_TIMESTAMP - (random() * INTERVAL '30 days'));
        END LOOP;
        event_count := floor(event_count * (0.03 + random() * 0.07))::INTEGER;
        FOR i IN 1..event_count LOOP
            INSERT INTO ad_analytics (ad_repo_id, event_type, station_id, event_timestamp)
            VALUES (campaign.id, 'click', COALESCE(campaign.matched_station_id, 'DT_0001'), CURRENT_TIMESTAMP - (random() * INTERVAL '30 days'));
        END LOOP;
    END LOOP;
END $$;

SELECT 'âœ… ë”ë¯¸ ë°ì´í„° ì‚½ì… ì™„ë£Œ!' as message,
       (SELECT COUNT(*) FROM ad_partners) as partners,
       (SELECT COUNT(*) FROM ad_repo) as campaigns,
       (SELECT COUNT(*) FROM ad_analytics) as events;`;

        async function copyDummyDataSQL() {
            try {
                await navigator.clipboard.writeText(dummyDataSQL);
                document.getElementById('dummyStatus').innerHTML = '<div class="success">âœ… ë”ë¯¸ ë°ì´í„° SQLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!<br>SQL Editorì—ì„œ ë¶™ì—¬ë„£ê³  ì‹¤í–‰í•˜ì„¸ìš”.</div>';
                setTimeout(() => {
                    document.getElementById('dummyStatus').innerHTML = '';
                }, 5000);
            } catch (err) {
                alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err.message);
            }
        }
    </script>
</body>
</html>
