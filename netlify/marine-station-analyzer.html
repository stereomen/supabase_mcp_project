<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>해양관측소 데이터 분석기</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
        }
        .back-button {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }
        .content {
            padding: 30px;
        }
        .filters {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .filters h2 {
            color: #333;
            margin-bottom: 20px;
        }
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        .filter-group label {
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
            font-size: 0.9em;
        }
        .filter-group select,
        .filter-group input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
        }
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .analysis-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .analysis-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-top: 15px;
        }
        .timeline-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 10px;
            align-items: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.2s;
        }
        .timeline-row:hover {
            background: #f0f0f0;
        }
        .timeline-label {
            font-size: 0.85em;
            color: #666;
            font-weight: 500;
        }
        .timeline-bar {
            height: 25px;
            background: #e0e0e0;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        .timeline-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            transition: width 0.3s;
        }
        .timeline-fill.partial {
            background: linear-gradient(90deg, #ffc107 0%, #ff9800 100%);
        }
        .timeline-fill.empty {
            background: linear-gradient(90deg, #dc3545 0%, #c82333 100%);
        }
        .data-fields {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .field-badge {
            padding: 10px 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            font-size: 0.9em;
        }
        .field-available {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .field-unavailable {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .missing-times {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
        }
        .missing-time-item {
            padding: 8px 12px;
            margin-bottom: 5px;
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .distance-calc {
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .distance-calc h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .distance-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: 1px solid #888;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h2 {
            margin: 0;
        }
        .modal-close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
        }
        .modal-close:hover {
            opacity: 0.7;
        }
        .modal-body {
            padding: 20px;
        }
        .hourly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .hourly-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            background: white;
        }
        .hourly-item.has-data {
            background: #e8f5e9;
            border-color: #4caf50;
        }
        .hourly-item.no-data {
            background: #ffebee;
            border-color: #f44336;
        }
        .hourly-time {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #333;
        }
        .hourly-fields {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 0.75em;
        }
        .field-tag {
            padding: 2px 6px;
            border-radius: 3px;
            background: #e3f2fd;
            color: #1976d2;
            white-space: nowrap;
        }
        .no-data-text {
            color: #999;
            font-size: 0.9em;
            font-style: italic;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: bold;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9em;
        }
        tr:hover {
            background: #f8f9fa;
        }
    </style>

    <!-- Supabase 설정 (인라인) -->
    <script>
    const SUPABASE_CONFIG = {
        url: 'https://iwpgvdtfpwazzfeniusk.supabase.co',
        anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml3cGd2ZHRmcHdhenpmZW5pdXNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwNzEzOTQsImV4cCI6MjA2NjY0NzM5NH0.d0pjIvnOdPGbc_-cfqRNu9yOIutyO1eex848k1yNZJE'
    };

    // 해양관측소 목록 A - 총 139개 관측소 (주로 파고, 수온 데이터 제공)
    const A_STATIONS = [
        {name: "가거도", id: "22297", lat: 34.0275, lon: 125.214722},
        {name: "가덕도", id: "618440", lat: 35.02166667, lon: 128.81305556},
        {name: "가파도", id: "22476", lat: 33.1627, lon: 126.2637},
        {name: "간절곶", id: "22483", lat: 35.3663, lon: 129.3752},
        {name: "강릉", id: "22520", lat: 37.79833, lon: 129.06083},
        {name: "거문도", id: "22103", lat: 34.0014, lon: 127.5014},
        {name: "거문도", id: "556851", lat: 34.025, lon: 127.31083333},
        {name: "거제도", id: "22104", lat: 34.7667, lon: 128.9},
        {name: "거제도", id: "626800", lat: 34.79888889, lon: 128.70166667},
        {name: "고성", id: "22310", lat: 38.31722, lon: 128.639167},
        {name: "고흥", id: "548893", lat: 34.47666667, lon: 127.3475},
        {name: "고흥", id: "22478", lat: 34.3752, lon: 127.1785},
        {name: "구룡포", id: "22524", lat: 35.9687, lon: 129.5997},
        {name: "구암", id: "22443", lat: 37.4792, lon: 130.8043},
        {name: "군산", id: "22474", lat: 35.8878, lon: 126.4255},
        {name: "군산외항", id: "573400", lat: 35.96833333, lon: 126.62666667},
        {name: "금오도", id: "22466", lat: 34.567, lon: 127.7767},
        {name: "기상1호", id: "22003", lat: 33.235279, lon: 126.569443},
        {name: "기장", id: "22511", lat: 35.2187, lon: 129.2645},
        {name: "김녕", id: "22491", lat: 33.5818, lon: 126.764},
        {name: "나로도", id: "22502", lat: 34.4322, lon: 127.5892},
        {name: "낙월", id: "22494", lat: 35.2003, lon: 126.21},
        {name: "남해", id: "22498", lat: 34.6963, lon: 127.9923},
        {name: "남해111", id: "22309", lat: 33.775, lon: 128.375},
        {name: "남해239", id: "22300", lat: 32.83, lon: 124.73},
        {name: "남해244", id: "22304", lat: 32.72222, lon: 127.27222},
        {name: "남해465", id: "22301", lat: 31.666667, lon: 126.4},
        {name: "내파수도", id: "22446", lat: 36.45139, lon: 126.24},
        {name: "노화도", id: "22477", lat: 34.2415, lon: 126.4918},
        {name: "녹도", id: "22526", lat: 36.264, lon: 126.2075},
        {name: "다대포", id: "22460", lat: 35.0213, lon: 128.955},
        {name: "당사", id: "22518", lat: 35.5777, lon: 129.5032},
        {name: "대산", id: "356870", lat: 37.00472222, lon: 126.35444444},
        {name: "대치마도", id: "22489", lat: 35.0175, lon: 126.0319},
        {name: "대흑산도", id: "535951", lat: 34.68388889, lon: 125.4358333},
        {name: "덕적도", id: "22101", lat: 37.2361, lon: 126.0188},
        {name: "독도", id: "22441", lat: 37.2375, lon: 131.8695},
        {name: "동해", id: "22105", lat: 37.5442, lon: 130.0},
        {name: "동해57", id: "22305", lat: 38.366667, lon: 129.6},
        {name: "동해78", id: "22302", lat: 36.966667, lon: 130.516667},
        {name: "두미도", id: "22450", lat: 34.7098, lon: 128.1497},
        {name: "마라도", id: "22107", lat: 33.0833, lon: 126.0333},
        {name: "마산", id: "630651", lat: 35.19694444, lon: 128.58},
        {name: "맹골수도", id: "22481", lat: 34.2262, lon: 125.9545},
        {name: "맹방", id: "22479", lat: 37.4015, lon: 129.2288},
        {name: "모슬포", id: "699835", lat: 33.21444444, lon: 126.25111111},
        {name: "목포", id: "530350", lat: 34.77805556, lon: 126.3925},
        {name: "묵호", id: "240050", lat: 37.5475, lon: 129.11861111},
        {name: "변산", id: "22497", lat: 35.659, lon: 126.4588},
        {name: "보령", id: "355844", lat: 36.40305555, lon: 126.4880555},
        {name: "볼음도", id: "22525", lat: 37.6117, lon: 126.1335},
        {name: "부산", id: "158650", lat: 35.09305556, lon: 129.0375},
        {name: "부안", id: "22186", lat: 35.6586, lon: 125.8139},
        {name: "불무도", id: "22503", lat: 34.318, lon: 126.1737},
        {name: "비안도", id: "22492", lat: 35.74, lon: 126.3518},
        {name: "사량도", id: "22501", lat: 34.861, lon: 128.1382},
        {name: "삼척", id: "22311", lat: 37.46389, lon: 129.31805},
        {name: "삼천포", id: "52565", lat: 34.924056, lon: 128.069722},
        {name: "삽시도", id: "22445", lat: 36.3712, lon: 126.338},
        {name: "서귀포", id: "22187", lat: 33.1281, lon: 127.0228},
        {name: "서귀포", id: "697010", lat: 33.23666667, lon: 126.56361111},
        {name: "서천", id: "22473", lat: 36.1668, lon: 126.3327},
        {name: "서해143", id: "22193", lat: 37.5, lon: 124.0167},
        {name: "서해170", id: "22191", lat: 36.13333, lon: 124.05694},
        {name: "서해190", id: "22299", lat: 35.0, lon: 124.13},
        {name: "서해206", id: "22192", lat: 34.0, lon: 123.2625},
        {name: "성산포", id: "699903", lat: 33.475, lon: 126.92777778},
        {name: "소매물도", id: "22485", lat: 34.62138889, lon: 128.538},
        {name: "속초", id: "217800", lat: 38.20444444, lon: 128.59666667},
        {name: "신산", id: "22495", lat: 33.3775, lon: 126.906},
        {name: "신안", id: "22183", lat: 34.73333333, lon: 126.24166667},
        {name: "신진도", id: "22444", lat: 36.6047, lon: 126.126},
        {name: "신창", id: "22516", lat: 33.366, lon: 126.1092},
        {name: "안면도", id: "22488", lat: 36.5367, lon: 126.2982},
        {name: "안산", id: "445310", lat: 37.18944444, lon: 126.64972222},
        {name: "안흥", id: "357945", lat: 36.67, lon: 126.135},
        {name: "어청도", id: "573819", lat: 36.1169, lon: 125.9847},
        {name: "여수", id: "550070", lat: 34.74416667, lon: 127.76805555},
        {name: "연곡", id: "22451", lat: 37.8673, lon: 128.8855},
        {name: "연평도", id: "22522", lat: 37.61944444, lon: 125.64833333},
        {name: "연화도", id: "22499", lat: 34.6738, lon: 128.3648},
        {name: "영광", id: "22475", lat: 35.4353, lon: 126.176},
        {name: "영락", id: "22505", lat: 33.2383, lon: 126.195},
        {name: "오륙도", id: "22459", lat: 35.0948, lon: 129.1282},
        {name: "완도", id: "537800", lat: 34.3125, lon: 126.76138889},
        {name: "외연도", id: "22108", lat: 36.25, lon: 125.75},
        {name: "우도", id: "22469", lat: 33.5223, lon: 126.9662},
        {name: "울릉도", id: "21229", lat: 37.4554, lon: 131.1144},
        {name: "울릉도", id: "799801", lat: 37.49333333, lon: 130.91388889},
        {name: "울릉읍", id: "22464", lat: 37.4717, lon: 130.9005},
        {name: "울산", id: "22189", lat: 35.3453, lon: 129.8414},
        {name: "울산", id: "695851", lat: 35.50055556, lon: 129.38944444},
        {name: "울진", id: "22190", lat: 36.9069, lon: 129.8744},
        {name: "월포", id: "22490", lat: 36.2163, lon: 129.4012},
        {name: "위도", id: "22504", lat: 35.6582, lon: 126.2607},
        {name: "위도동부", id: "22510", lat: 35.64297, lon: 126.358611},
        {name: "위미", id: "22515", lat: 33.22369, lon: 126.71119},
        {name: "이작도", id: "22461", lat: 37.1653, lon: 126.2067},
        {name: "인천", id: "22185", lat: 37.0917, lon: 125.4289},
        {name: "인천", id: "400031", lat: 37.44916667, lon: 126.59416667},
        {name: "인천(송도)", id: "406800", lat: 37.3381, lon: 126.5861},
        {name: "자월도", id: "22472", lat: 37.3043, lon: 126.158},
        {name: "자은", id: "22493", lat: 34.91917, lon: 125.86806},
        {name: "잠도", id: "22484", lat: 35.0578, lon: 128.6807},
        {name: "장봉도", id: "22496", lat: 37.4897, lon: 126.3532},
        {name: "장안", id: "22454", lat: 35.2972, lon: 129.2883},
        {name: "제주", id: "690704", lat: 33.52416667, lon: 126.54527778},
        {name: "제주항", id: "22457", lat: 33.5255, lon: 126.4942},
        {name: "조도", id: "22500", lat: 34.2867, lon: 126.1138},
        {name: "죽변", id: "22523", lat: 37.10278, lon: 129.45944},
        {name: "중문", id: "22458", lat: 33.2253, lon: 126.3923},
        {name: "지심도", id: "22512", lat: 34.82777778, lon: 128.775},
        {name: "진도", id: "539800", lat: 34.3777, lon: 126.3086},
        {name: "진도", id: "22449", lat: 34.4418, lon: 126.0568},
        {name: "천수만", id: "22487", lat: 36.4672, lon: 126.4395},
        {name: "청산도", id: "22456", lat: 34.138, lon: 126.744},
        {name: "초도", id: "22507", lat: 34.1512, lon: 127.2187},
        {name: "추자도", id: "22184", lat: 33.79361, lon: 126.1411},
        {name: "추자도", id: "22468", lat: 33.9732, lon: 126.2788},
        {name: "추자도", id: "680050", lat: 33.95861111, lon: 126.30222222},
        {name: "칠발도", id: "22102", lat: 34.7933, lon: 125.7769},
        {name: "토성", id: "22471", lat: 38.2772, lon: 128.5753},
        {name: "통영", id: "22188", lat: 34.3917, lon: 128.225},
        {name: "통영", id: "650804", lat: 34.82472222, lon: 128.43694444},
        {name: "평택", id: "451821", lat: 36.96388889, lon: 126.82472222},
        {name: "포항", id: "22106", lat: 36.35, lon: 129.7833},
        {name: "포항", id: "37716", lat: 36.01777778, lon: 129.39916667},
        {name: "표류25011", id: "22946", lat: 29.12392, lon: 131.41194},
        {name: "표류25016", id: "22601", lat: 6.05024, lon: 102.40561},
        {name: "표류25019", id: "22604", lat: 21.2811, lon: 136.05235},
        {name: "표류25020", id: "22605", lat: 21.06382, lon: 125.3735},
        {name: "표류25023", id: "22683", lat: 23.07905, lon: 132.08839},
        {name: "풍도", id: "22303", lat: 37.15833, lon: 126.41},
        {name: "한산도", id: "22467", lat: 34.7055, lon: 128.4953},
        {name: "해금강", id: "22455", lat: 34.735, lon: 128.691},
        {name: "혈암", id: "22442", lat: 37.5413, lon: 130.8542},
        {name: "협재", id: "22486", lat: 33.4007, lon: 126.2092},
        {name: "홍도", id: "22298", lat: 34.746667, lon: 125.245556},
        {name: "후포", id: "22465", lat: 36.7195, lon: 129.4883},
        {name: "후포", id: "767800", lat: 36.67444444, lon: 129.45555556},
    ];

    // 해양관측소 목록 B - 총 117개 관측소 (주로 기온, 풍향, 풍속 데이터 제공)
    const B_STATIONS = [
        {name: "가거도", id: "22297", lat: 34.0275, lon: 125.214722},
        {name: "가대암", id: "956", lat: 36.77, lon: 125.9767},
        {name: "가덕도", id: "618440", lat: 35.02166667, lon: 128.81305556},
        {name: "간여암", id: "961", lat: 34.285, lon: 127.85778},
        {name: "갈매여", id: "958", lat: 35.61333333, lon: 126.245},
        {name: "강릉", id: "22520", lat: 37.79833, lon: 129.06083},
        {name: "거문도", id: "22103", lat: 34.0014, lon: 127.5014},
        {name: "거문도", id: "556851", lat: 34.025, lon: 127.31083333},
        {name: "거제도", id: "22104", lat: 34.7667, lon: 128.9},
        {name: "거제도", id: "626800", lat: 34.79888889, lon: 128.70166667},
        {name: "격포", id: "33004", lat: 35.61902, lon: 126.46304},
        {name: "고성", id: "22310", lat: 38.31722, lon: 128.639167},
        {name: "고흥", id: "548893", lat: 34.47666667, lon: 127.3475},
        {name: "광양", id: "545711", lat: 34.90342, lon: 127.75483},
        {name: "교본초", id: "650940", lat: 34.70167, lon: 128.31},
        {name: "구룡포", id: "33021", lat: 35.95183, lon: 129.54965},
        {name: "군산외항", id: "573400", lat: 35.96833333, lon: 126.62666667},
        {name: "기상1호", id: "22003", lat: 33.235279, lon: 126.569443},
        {name: "남해111", id: "22309", lat: 33.775, lon: 128.375},
        {name: "남해239", id: "22300", lat: 32.83, lon: 124.73},
        {name: "남해244", id: "22304", lat: 32.72222, lon: 127.27222},
        {name: "남해465", id: "22301", lat: 31.666667, lon: 126.4},
        {name: "내파수도", id: "22446", lat: 36.45139, lon: 126.24},
        {name: "대산", id: "356870", lat: 37.00472222, lon: 126.35444444},
        {name: "대산", id: "33001", lat: 37.0275, lon: 126.3625},
        {name: "대치마도", id: "22489", lat: 35.0175, lon: 126.0319},
        {name: "대흑산도", id: "535951", lat: 34.68388889, lon: 125.4358333},
        {name: "덕적도", id: "22101", lat: 37.2361, lon: 126.0188},
        {name: "동해", id: "22105", lat: 37.5442, lon: 130.0},
        {name: "동해57", id: "22305", lat: 38.366667, lon: 129.6},
        {name: "동해78", id: "22302", lat: 36.966667, lon: 130.516667},
        {name: "동해항", id: "240130", lat: 37.495, lon: 129.1439},
        {name: "마라도", id: "22107", lat: 33.0833, lon: 126.0333},
        {name: "마산", id: "630651", lat: 35.19694444, lon: 128.58},
        {name: "말도", id: "33003", lat: 35.85391, lon: 126.31797},
        {name: "모슬포", id: "699835", lat: 33.21444444, lon: 126.25111111},
        {name: "목포", id: "530350", lat: 34.77805556, lon: 126.3925},
        {name: "묵호", id: "240050", lat: 37.5475, lon: 129.11861111},
        {name: "백령도", id: "23102", lat: 37.9556, lon: 124.7361},
        {name: "법성포", id: "33018", lat: 35.352, lon: 126.3874},
        {name: "보령", id: "355844", lat: 36.40305555, lon: 126.4880555},
        {name: "부산", id: "158650", lat: 35.09305556, lon: 129.0375},
        {name: "부산신항", id: "516090", lat: 35.0744, lon: 128.7869},
        {name: "부안", id: "22186", lat: 35.6586, lon: 125.8139},
        {name: "삼척", id: "22311", lat: 37.46389, lon: 129.31805},
        {name: "삼천포", id: "52565", lat: 34.924056, lon: 128.069722},
        {name: "서귀포", id: "22187", lat: 33.1281, lon: 127.0228},
        {name: "서귀포", id: "697010", lat: 33.23666667, lon: 126.56361111},
        {name: "서귀포", id: "33015", lat: 33.2635, lon: 126.6426},
        {name: "서수도", id: "955", lat: 37.325, lon: 126.39333333},
        {name: "서천(마량)", id: "325894", lat: 36.1286, lon: 126.4956},
        {name: "서해143", id: "22193", lat: 37.5, lon: 124.0167},
        {name: "서해170", id: "22191", lat: 36.13333, lon: 124.05694},
        {name: "서해190", id: "22299", lat: 35.0, lon: 124.13},
        {name: "서해206", id: "22192", lat: 34.0, lon: 123.2625},
        {name: "성산포", id: "699903", lat: 33.475, lon: 126.92777778},
        {name: "소매물도", id: "22485", lat: 34.62138889, lon: 128.538},
        {name: "속초", id: "217800", lat: 38.20444444, lon: 128.59666667},
        {name: "신안", id: "22183", lat: 34.73333333, lon: 126.24166667},
        {name: "신안", id: "33017", lat: 34.727, lon: 125.9009},
        {name: "실리도", id: "33019", lat: 35.06265, lon: 128.63935},
        {name: "십이동파", id: "957", lat: 35.98666667, lon: 126.225},
        {name: "안산", id: "445310", lat: 37.18944444, lon: 126.64972222},
        {name: "안흥", id: "357945", lat: 36.67, lon: 126.135},
        {name: "어청도", id: "573819", lat: 36.1169, lon: 125.9847},
        {name: "여수", id: "550070", lat: 34.74416667, lon: 127.76805555},
        {name: "여수", id: "33014", lat: 34.5242, lon: 127.7303},
        {name: "연평도", id: "22522", lat: 37.61944444, lon: 125.64833333},
        {name: "연평도", id: "23108", lat: 37.6577, lon: 125.7144},
        {name: "영광", id: "513800", lat: 34.77666667, lon: 126.39388889},
        {name: "영덕", id: "33008", lat: 36.33874, lon: 129.38274},
        {name: "영흥도", id: "409870", lat: 37.2367, lon: 126.4314},
        {name: "오륙도", id: "984", lat: 35.091, lon: 129.127},
        {name: "완도", id: "537800", lat: 34.3125, lon: 126.76138889},
        {name: "왕돌초", id: "132129", lat: 36.71667, lon: 129.735},
        {name: "외연도", id: "22108", lat: 36.25, lon: 125.75},
        {name: "울릉도", id: "21229", lat: 37.4554, lon: 131.1144},
        {name: "울릉도", id: "799801", lat: 37.49333333, lon: 130.91388889},
        {name: "울산", id: "22189", lat: 35.3453, lon: 129.8414},
        {name: "울산", id: "695851", lat: 35.50055556, lon: 129.38944444},
        {name: "울산", id: "33016", lat: 35.581, lon: 129.4563},
        {name: "울진", id: "22190", lat: 36.9069, lon: 129.8744},
        {name: "위도", id: "579911", lat: 35.6153, lon: 126.3039},
        {name: "위도동부", id: "22510", lat: 35.64297, lon: 126.358611},
        {name: "위미", id: "22515", lat: 33.22369, lon: 126.71119},
        {name: "이덕서", id: "963", lat: 35.5667, lon: 129.475},
        {name: "인천", id: "22185", lat: 37.0917, lon: 125.4289},
        {name: "인천", id: "400031", lat: 37.44916667, lon: 126.59416667},
        {name: "인천(송도)", id: "406800", lat: 37.3381, lon: 126.5861},
        {name: "자은", id: "22493", lat: 34.91917, lon: 125.86806},
        {name: "장항", id: "325903", lat: 36.00694444, lon: 126.6875},
        {name: "정동진", id: "33020", lat: 37.68472, lon: 129.04444},
        {name: "제주", id: "690704", lat: 33.52416667, lon: 126.54527778},
        {name: "죽도", id: "33002", lat: 36.27511, lon: 126.53792},
        {name: "죽변", id: "22523", lat: 37.10278, lon: 129.45944},
        {name: "지귀도", id: "960", lat: 33.22333, lon: 126.6542},
        {name: "지산", id: "33006", lat: 34.44957, lon: 126.1184},
        {name: "지심도", id: "22512", lat: 34.82777778, lon: 128.775},
        {name: "진도", id: "539800", lat: 34.3777, lon: 126.3086},
        {name: "진해군항", id: "645600", lat: 35.14722, lon: 128.64306},
        {name: "추자도", id: "22184", lat: 33.79361, lon: 126.1411},
        {name: "추자도", id: "680050", lat: 33.95861111, lon: 126.30222222},
        {name: "칠발도", id: "22102", lat: 34.7933, lon: 125.7769},
        {name: "태안", id: "357914", lat: 36.9133, lon: 126.2386},
        {name: "통영", id: "22188", lat: 34.3917, lon: 128.225},
        {name: "통영", id: "650804", lat: 34.82472222, lon: 128.43694444},
        {name: "통영", id: "33009", lat: 34.76516, lon: 128.4048},
        {name: "판포", id: "33011", lat: 33.36686, lon: 126.20052},
        {name: "평택", id: "451821", lat: 36.96388889, lon: 126.82472222},
        {name: "포항", id: "22106", lat: 36.35, lon: 129.7833},
        {name: "포항", id: "37716", lat: 36.01777778, lon: 129.39916667},
        {name: "풍도", id: "22303", lat: 37.15833, lon: 126.41},
        {name: "해남", id: "33013", lat: 34.3157, lon: 126.5145},
        {name: "해수서", id: "959", lat: 34.26333333, lon: 126.02666667},
        {name: "홍도", id: "22298", lat: 34.746667, lon: 125.245556},
        {name: "후포", id: "767800", lat: 36.67444444, lon: 129.45555556},
        {name: "흑산도", id: "33010", lat: 34.65088, lon: 125.39348},
    ];
    // 조석관측소 목록 (locations_with_addresses.xml) - 총 178개
    const TIDE_STATIONS = [
        {code: "SO_0326", name: "미조항", lat: 34.706389, lon: 128.048611, marine_reg: "남해동부", address: "경상남도 남해군 방파제길"},
        {code: "SO_0536", name: "덕적도", lat: 37.227778, lon: 126.157778, marine_reg: "서해북부", address: "인천광역시 옹진군 덕적면"},
        {code: "SO_0537", name: "벽파진(벽파항)", lat: 34.539444, lon: 126.346111, marine_reg: "서해남부", address: "전라남도 진도군 벽파길"},
        {code: "SO_0538", name: "안마도", lat: 35.345556, lon: 126.016111, marine_reg: "서해남부", address: "전라남도 영광군 안마길"},
        {code: "SO_0539", name: "강화외포", lat: 37.700833, lon: 126.3725, marine_reg: "서해북부", address: "인천광역시 강화군 내가면"},
        {code: "SO_0540", name: "호산항", lat: 37.176111, lon: 129.342778, marine_reg: "동해중부", address: "강원특별자치도 삼척시 호산3길"},
        {code: "SO_0543", name: "서거차도", lat: 34.253611, lon: 125.917778, marine_reg: "서해남부", address: "전라남도 진도군 서거차도1길"},
        {code: "SO_0547", name: "말도", lat: 35.855278, lon: 126.318333, marine_reg: "서해중부", address: "전북특별자치도 군산시 말도길"},
        {code: "SO_0548", name: "우이도(신안)", lat: 34.620556, lon: 125.856667, marine_reg: "서해남부", address: "전라남도 신안군 우이진리길"},
        {code: "SO_0550", name: "나로도", lat: 34.463056, lon: 127.453889, marine_reg: "남해서부", address: "전라남도 고흥군 나로도항길"},
        {code: "SO_0551", name: "여서도", lat: 33.988056, lon: 126.923333, marine_reg: "서해남부", address: "전라남도 완도군 여서도길"},
        {code: "SO_0552", name: "고현항", lat: 34.901944, lon: 128.622222, marine_reg: "남해동부", address: "경상남도 거제시 연하해안로"},
        {code: "SO_0553", name: "해운대", lat: 35.1602777777778, lon: 129.1915, marine_reg: "남해동부", address: "부산광역시 해운대구 중1동"},
        {code: "SO_0554", name: "영종왕산", lat: 37.458056, lon: 126.358889, marine_reg: "서해북부", address: "인천광역시 중구 왕산마리나길 131"},
        {code: "SO_0555", name: "서망항", lat: 34.366667, lon: 126.134167, marine_reg: "서해남부", address: "전라남도 진도군 서망항길"},
        {code: "SO_0562", name: "승봉도", lat: 37.169722, lon: 126.290556, marine_reg: "서해북부", address: "인천광역시 옹진군 자월면"},
        {code: "SO_0563", name: "울도", lat: 37.035556, lon: 125.995, marine_reg: "서해북부", address: "인천광역시 옹진군 덕적면 울도리 산46-1"},
        {code: "SO_0564", name: "국화도", lat: 37.060556, lon: 126.560556, marine_reg: "서해북부", address: "경기도 화성시 우정읍"},
        {code: "SO_0565", name: "향화도항", lat: 35.167778, lon: 126.359444, marine_reg: "서해남부", address: "전라남도 영광군 77"},
        {code: "SO_0566", name: "송공항", lat: 34.848333, lon: 126.225278, marine_reg: "서해남부", address: "전라남도 신안군 압해로"},
        {code: "SO_0567", name: "쉬미항", lat: 34.504722, lon: 126.183611, marine_reg: "서해남부", address: "전라남도 진도군 소포리"},
        {code: "SO_0568", name: "백야도", lat: 34.624444, lon: 127.632222, marine_reg: "남해서부", address: "전라남도 여수시 백야해안길"},
        {code: "SO_0569", name: "남포항", lat: 34.957778, lon: 128.321667, marine_reg: "남해동부", address: "경상남도 고성군 공룡로"},
        {code: "SO_0570", name: "광암항", lat: 35.1025, lon: 128.498889, marine_reg: "남해동부", address: "경상남도 창원시 해양관광로"},
        {code: "SO_0571", name: "거제외포", lat: 34.939444, lon: 128.718056, marine_reg: "남해동부", address: "경상남도 거제시 외포5길 60"},
        {code: "SO_0572", name: "읍천항", lat: 35.690833, lon: 129.475556, marine_reg: "남해동부", address: "경상북도 경주시 양남항구길"},
        {code: "SO_0573", name: "양포항", lat: 35.881389, lon: 129.5275, marine_reg: "남해동부", address: "경상북도 포항시 양포항길"},
        {code: "SO_0574", name: "백사장항", lat: 36.586389, lon: 126.315, marine_reg: "서해중부", address: "충청남도 태안군 안면읍"},
        {code: "SO_0576", name: "화봉리", lat: 34.661111, lon: 126.256944, marine_reg: "서해남부", address: "전라남도 해남군 화봉리"},
        {code: "SO_0577", name: "가거도", lat: 34.050833, lon: 125.128889, marine_reg: "서해남부", address: "전라남도 신안군 가거도길"},
        {code: "SO_0578", name: "소매물도", lat: 34.621944, lon: 128.548056, marine_reg: "남해동부", address: "경상남도 통영시 장군봉 등산로"},
        {code: "SO_0581", name: "강양항", lat: 35.39, lon: 129.344722, marine_reg: "남해동부", address: "울산광역시 울주군 서생면 진하리 410"},
        {code: "SO_0631", name: "암태도", lat: 34.853056, lon: 126.071389, marine_reg: "서해남부", address: "전라남도 신안군 중부로"},
        {code: "SO_0699", name: "천리포항", lat: 36.803889, lon: 126.146944, marine_reg: "서해중부", address: "충청남도 태안군 소원면 천리포2길 61"},
        {code: "SO_0701", name: "홍도항", lat: 34.681111, lon: 125.195, marine_reg: "서해남부", address: "전라남도 신안군 홍도1길"},
        {code: "SO_0702", name: "진도옥도", lat: 34.350833, lon: 126.018611, marine_reg: "서해남부", address: "전라남도 진도군 옥도길"},
        {code: "SO_0703", name: "땅끝항", lat: 34.298889, lon: 126.531111, marine_reg: "서해남부", address: "전라남도 해남군 갈두산 등산로"},
        {code: "SO_0704", name: "소안항(완도)", lat: 34.15, lon: 126.631944, marine_reg: "서해남부", address: "전라남도 완도군 소안로"},
        {code: "SO_0705", name: "마량항", lat: 34.448889, lon: 126.821944, marine_reg: "서해남부", address: "전라남도 강진군 미항로 181-3"},
        {code: "SO_0706", name: "청산도", lat: 34.180833, lon: 126.856111, marine_reg: "서해남부", address: "전라남도 완도군 청산로"},
        {code: "SO_0707", name: "시산항", lat: 34.394444, lon: 127.261667, marine_reg: "남해서부", address: "전라남도 고흥군 시산리"},
        {code: "SO_0708", name: "안도항", lat: 34.479722, lon: 127.797778, marine_reg: "남해서부", address: "전라남도 여수시 안도리"},
        {code: "SO_0709", name: "두문포", lat: 34.643611, lon: 127.7975, marine_reg: "남해서부", address: "전라남도 여수시 죽포리"},
        {code: "SO_0710", name: "봉우항", lat: 34.932778, lon: 127.9275, marine_reg: "남해서부", address: "경상남도 남해군 강진로438번길"},
        {code: "SO_0711", name: "창선도", lat: 34.840556, lon: 128.019444, marine_reg: "남해동부", address: "경상남도 남해군 동부대로2084번길"},
        {code: "SO_0712", name: "능양항", lat: 34.812222, lon: 128.245, marine_reg: "남해동부", address: "경상남도 통영시 백학길"},
        {code: "SO_0731", name: "대진항", lat: 38.501389, lon: 128.426167, marine_reg: "동해중부", address: "강원특별자치도 고성군 대진항길"},
        {code: "SO_0732", name: "남애항", lat: 37.944222, lon: 128.788333, marine_reg: "동해중부", address: "강원특별자치도 양양군 매바위길"},
        {code: "SO_0733", name: "강릉항", lat: 37.772278, lon: 128.951333, marine_reg: "동해중부", address: "강원특별자치도 강릉시 경강로"},
        {code: "SO_0734", name: "궁촌항", lat: 37.327806, lon: 129.270028, marine_reg: "동해중부", address: "강원특별자치도 삼척시 근덕면 궁촌리 213-13"},
        {code: "SO_0735", name: "죽변항", lat: 37.054833, lon: 129.423917, marine_reg: "동해중부", address: "울진군 죽변항길"},
        {code: "SO_0736", name: "축산항", lat: 36.509944, lon: 129.448139, marine_reg: "동해남부", address: "영덕군 동해안 자전거길"},
        {code: "SO_0737", name: "강구항", lat: 36.358583, lon: 129.391306, marine_reg: "동해남부", address: "영덕군 동해안 자전거길"},
        {code: "SO_0738", name: "여호항", lat: 34.661556, lon: 127.469556, marine_reg: "남해서부", address: "전라남도 고흥군 여호리"},
        {code: "SO_0739", name: "도장항", lat: 34.367306, lon: 127.011972, marine_reg: "남해서부", address: "전라남도 완도군 장정리"},
        {code: "SO_0740", name: "보옥항", lat: 34.129, lon: 126.513556, marine_reg: "서해남부", address: "전라남도 완도군 보길로"},
        {code: "SO_0752", name: "검산항", lat: 35.0, lon: 126.107778, marine_reg: "서해남부", address: "전라남도 신안군 보물섬길"},
        {code: "SO_0753", name: "하의도웅곡", lat: 34.608333, lon: 126.038611, marine_reg: "서해남부", address: "전라남도 신안군 곰실길 3-23"},
        {code: "SO_0754", name: "평호리", lat: 34.448056, lon: 126.455, marine_reg: "서해남부", address: "전라남도 해남군 평호길"},
        {code: "SO_0755", name: "원동항", lat: 34.393889, lon: 126.648611, marine_reg: "서해남부", address: "전라남도 완도군 완도로"},
        {code: "SO_0756", name: "사초항", lat: 34.470278, lon: 126.761111, marine_reg: "서해남부", address: "전라남도 강진군 사초리"},
        {code: "SO_0757", name: "안남리", lat: 34.730278, lon: 127.264444, marine_reg: "남해서부", address: "전라남도 고흥군 동서로"},
        {code: "SO_0758", name: "달천도", lat: 34.761667, lon: 127.563056, marine_reg: "남해서부", address: "전라남도 여수시 섬달천길"},
        {code: "SO_0759", name: "장문리", lat: 34.873611, lon: 128.424167, marine_reg: "남해동부", address: "경상남도 통영시 죽림해안로"},
        {code: "SO_0760", name: "오산항", lat: 36.888889, lon: 129.416111, marine_reg: "동해남부", address: "경상북도 울진군 망양정로 54"},
        {code: "SO_0761", name: "녹동항", lat: 34.527028, lon: 127.134528, marine_reg: "남해서부", address: "전라남도 고흥군 목넘가는길"},
        {code: "DT_0001", name: "인천", lat: 37.451944, lon: 126.592222, marine_reg: "서해북부", address: "인천광역시 중구 항동 7가 82-10"},
        {code: "DT_0002", name: "평택", lat: 36.966944, lon: 126.822778, marine_reg: "서해중부", address: "충청남도 당진시 당진항만로"},
        {code: "DT_0003", name: "영광", lat: 35.426111, lon: 126.420556, marine_reg: "서해남부", address: "전라남도 영광군 버든"},
        {code: "DT_0004", name: "제주", lat: 33.5275, lon: 126.543056, marine_reg: "제주도해상", address: "제주특별자치도 제주시 임항로"},
        {code: "DT_0005", name: "부산", lat: 35.096389, lon: 129.035278, marine_reg: "남해동부", address: "부산광역시 중구 남포동"},
        {code: "DT_0006", name: "묵호", lat: 37.550278, lon: 129.116389, marine_reg: "동해중부", address: "강원특별자치도 동해시 묵호진동 15-200"},
        {code: "DT_0007", name: "목포", lat: 34.7797222222222, lon: 126.375556, marine_reg: "서해남부", address: "전라남도 목포시 해안로"},
        {code: "DT_0008", name: "안산", lat: 37.192222, lon: 126.647222, marine_reg: "서해북부", address: "경기도 안산시 대부황금로 5-5"},
        {code: "DT_0009", name: "포항", lat: 36.0472222222222, lon: 129.383888888889, marine_reg: "동해남부", address: "경상북도 포항시 동해안 자전거길"},
        {code: "DT_0010", name: "서귀포", lat: 33.24, lon: 126.561667, marine_reg: "남해서부", address: "제주특별자치도 서귀포시 칠십리로"},
        {code: "DT_0011", name: "후포", lat: 36.6775, lon: 129.453056, marine_reg: "동해남부", address: "경상북도 울진군 후포면"},
        {code: "DT_0012", name: "속초", lat: 38.207222, lon: 128.594167, marine_reg: "동해중부", address: "강원특별자치도 속초시 설악금강대교로"},
        {code: "DT_0013", name: "울릉도", lat: 37.491389, lon: 130.913611, marine_reg: "동해중부", address: "경상북도 울릉군 해안산책로"},
        {code: "DT_0014", name: "통영", lat: 34.827778, lon: 128.434722, marine_reg: "남해동부", address: "경상남도 통영시 통영 자전거길"},
        {code: "DT_0015", name: "마산", lat: 35.21, lon: 128.588889, marine_reg: "남해동부", address: "경상남도 창원시 무역로"},
        {code: "DT_0016", name: "여수", lat: 34.747222, lon: 127.765556, marine_reg: "남해서부", address: "전라남도 여수시 오동도로 248"},
        {code: "DT_0017", name: "대산", lat: 37.0075, lon: 126.352778, marine_reg: "서해북부", address: "충청남도 서산시 독곶2로"},
        {code: "DT_0018", name: "군산", lat: 35.975556, lon: 126.563056, marine_reg: "서해중부", address: "전북특별자치도 군산시 서해로"},
        {code: "DT_0019", name: "가덕도", lat: 35.024167, lon: 128.810833, marine_reg: "남해동부", address: "부산광역시 가덕해안로"},
        {code: "DT_0020", name: "울산", lat: 35.501944, lon: 129.387222, marine_reg: "남해동부", address: "울산광역시 장생포고래로 28"},
        {code: "DT_0021", name: "추자도", lat: 33.961944, lon: 126.300278, marine_reg: "서해남부", address: "제주특별자치도 제주시 대서2길"},
        {code: "DT_0022", name: "성산포", lat: 33.474722, lon: 126.927778, marine_reg: "남해서부", address: "제주특별자치도 서귀포시 성산등용로"},
        {code: "DT_0023", name: "모슬포", lat: 33.214444, lon: 126.251111, marine_reg: "남해서부", address: "제주특별자치도 서귀포시 하모항구로"},
        {code: "DT_0024", name: "장항", lat: 36.006944, lon: 126.6875, marine_reg: "서해중부", address: "충청남도 서천군 장산로"},
        {code: "DT_0025", name: "보령", lat: 36.406389, lon: 126.486111, marine_reg: "서해중부", address: "충청남도 보령시 영보리"},
        {code: "DT_0026", name: "고흥발포", lat: 34.481111, lon: 127.342778, marine_reg: "남해서부", address: "전라남도 고흥군"},
        {code: "DT_0027", name: "완도", lat: 34.315556, lon: 126.759722, marine_reg: "서해남부", address: "전라남도 완도군 장보고대로 315"},
        {code: "DT_0028", name: "진도", lat: 34.377778, lon: 126.308611, marine_reg: "서해남부", address: "전라남도 진도군 금갑리"},
        {code: "DT_0029", name: "거제도", lat: 34.801389, lon: 128.699167, marine_reg: "남해동부", address: "경상남도 거제시 구조라로 101"},
        {code: "DT_0030", name: "위도", lat: 35.618056, lon: 126.301667, marine_reg: "서해중부", address: "전북특별자치도 부안군 위도로 2"},
        {code: "DT_0031", name: "거문도", lat: 34.028333, lon: 127.308889, marine_reg: "남해서부", address: "전라남도 여수시 거문길"},
        {code: "DT_0032", name: "강화대교", lat: 37.731944, lon: 126.522222, marine_reg: "서해북부", address: "김포시 강화대교"},
        {code: "DT_0034", name: "안흥", lat: 36.673611, lon: 126.132222, marine_reg: "서해중부", address: "충청남도 태안군 신진도리"},
        {code: "DT_0035", name: "흑산도", lat: 34.684167, lon: 125.435556, marine_reg: "서해남부", address: "전라남도 신안군 진리"},
        {code: "DT_0036", name: "대청도", lat: 37.825222, lon: 124.718056, marine_reg: "서해북부", address: "인천광역시 옹진군 대청면"},
        {code: "DT_0037", name: "어청도", lat: 36.117222, lon: 125.984722, marine_reg: "서해중부", address: "전북특별자치도 군산시 어청도길"},
        {code: "DT_0038", name: "굴업도", lat: 37.194444, lon: 125.995, marine_reg: "서해북부", address: "인천광역시 옹진군 덕적면"},
        {code: "DT_0039", name: "왕돌초", lat: 36.7191666666667, lon: 129.7325, marine_reg: "동해남부", address: "경상북도 울진군 후포면 후포리"},
        {code: "DT_0040", name: "독도", lat: 37.238889, lon: 131.867222, marine_reg: "동해중부", address: "경상북도 울릉군 독도이사부길"},
        {code: "DT_0041", name: "복사초", lat: 34.0983333333333, lon: 126.168333333333, marine_reg: "서해남부", address: "전라남도 신안군 흑산면"},
        {code: "DT_0042", name: "교본초", lat: 34.7047222222222, lon: 128.306388888889, marine_reg: "남해동부", address: "경상남도 여수시 삼산면"},
        {code: "DT_0043", name: "영흥도", lat: 37.2386111111111, lon: 126.428611111111, marine_reg: "서해북부", address: "인천광역시 옹진군 영흥면"},
        {code: "DT_0044", name: "영종대교", lat: 37.545556, lon: 126.584444, marine_reg: "서해북부", address: "인천광역시 중구 중산동"},
        {code: "DT_0045", name: "격렬비열도", lat: 36.624369, lon: 125.561964, marine_reg: "서해중부", address: "충청남도 태안군 근흥면 가의도리"},
        {code: "DT_0046", name: "쌍정초", lat: 37.556161, lon: 130.939211, marine_reg: "동해중부", address: "경상북도 울릉군 저동리"},
        {code: "DT_0047", name: "도농탄", lat: 33.158056, lon: 126.274722, marine_reg: "남해서부", address: "제주특별자치도 서귀포시 가파리"},
        {code: "DT_0048", name: "속초등표", lat: 38.199478, lon: 128.613083, marine_reg: "동해중부", address: "강원특별자치도 속초시 청호해안길 (동해안 자전거길)"},
        {code: "DT_0049", name: "광양", lat: 34.903672, lon: 127.754836, marine_reg: "남해서부", address: "전라남도 광양시 제철로 1800"},
        {code: "DT_0050", name: "태안", lat: 36.9130555555556, lon: 126.238888888889, marine_reg: "서해중부", address: "충청남도 태안군 발전로"},
        {code: "DT_0051", name: "서천마량", lat: 36.1288888888889, lon: 126.495277777778, marine_reg: "서해중부", address: "충청남도 서천군 마량리"},
        {code: "DT_0052", name: "인천송도", lat: 37.3380555555556, lon: 126.586111111111, marine_reg: "서해북부", address: "인천광역시 연수구 송도동"},
        {code: "DT_0054", name: "진해", lat: 35.147222, lon: 128.643056, marine_reg: "남해동부", address: "경상남도 창원시 충장로"},
        {code: "DT_0056", name: "부산항신항", lat: 35.0775, lon: 128.784722, marine_reg: "남해동부", address: "경상남도 창원시 진해구 웅동2동"},
        {code: "DT_0057", name: "동해항", lat: 37.494722, lon: 129.143889, marine_reg: "동해남부", address: "강원특별자치도 동해시 갯목길"},
        {code: "DT_0058", name: "경인항", lat: 37.560833, lon: 126.601111, marine_reg: "서해북부", address: "인천광역시 갑문1로"},
        {code: "DT_0059", name: "백령도", lat: 37.95565, lon: 124.736081, marine_reg: "서해북부", address: "옹진군 백령로"},
        {code: "DT_0060", name: "연평도", lat: 37.657669, lon: 125.714417, marine_reg: "서해북부", address: "옹진군 연평리"},
        {code: "DT_0061", name: "삼천포", lat: 34.924167, lon: 128.069722, marine_reg: "남해동부", address: "경상남도 사천시 어시장길"},
        {code: "DT_0062", name: "마산", lat: 35.1975, lon: 128.576389, marine_reg: "남해동부", address: "경상남도 창원시 제2부두로"},
        {code: "DT_0063", name: "가덕도", lat: 35.024178, lon: 128.810933, marine_reg: "남해동부", address: "부산광역시 가덕해안로"},
        {code: "DT_0064", name: "교동대교", lat: 37.789611, lon: 126.339611, marine_reg: "서해북부", address: "인천광역시 교동대교"},
        {code: "DT_0065", name: "덕적도", lat: 37.226333, lon: 126.156556, marine_reg: "서해북부", address: "옹진군 덕적북로"},
        {code: "DT_0067", name: "안흥", lat: 36.6746388888889, lon: 126.129555555556, marine_reg: "서해중부", address: "충청남도 태안군 마도길"},
        {code: "DT_0068", name: "위도", lat: 35.6180844444444, lon: 126.301815833333, marine_reg: "서해중부", address: "전북특별자치도 부안군 위도로 2"},
        {code: "DT_0091", name: "포항", lat: 36.051777, lon: 129.376277, marine_reg: "동해남부", address: "경상북도 포항시 동해안 자전거길"},
        {code: "DT_0092", name: "여호항", lat: 34.661944, lon: 127.469167, marine_reg: "남해서부", address: "전라남도 고흥군 여호리"},
        {code: "DT_0093", name: "소무의도", lat: 37.373069, lon: 126.440066, marine_reg: "서해북부", address: "인천광역시 소무의로16번길"},
        {code: "DT_0094", name: "서거차도", lat: 34.25142222, lon: 125.915449999, marine_reg: "서해남부", address: "전라남도 진도군 서거차도2길"},
        {code: "IE_0060", name: "이어도", lat: 32.1227777777778, lon: 125.182222222222, marine_reg: "남해서부", address: "제주 서귀포시 대정읍 가파리"},
        {code: "IE_0061", name: "신안가거초", lat: 33.941944, lon: 124.592778, marine_reg: "서해남부", address: "전라남도 신안군 흑산면 가거도리"},
        {code: "IE_0062", name: "옹진소청초", lat: 37.423056, lon: 124.738056, marine_reg: "서해북부", address: "인천광역시 옹진군 영흥면 외리 1133-18"},
        {code: "AD_0001", name: "시화방조제", lat: 37.311241, lon: 126.607595, marine_reg: "서해북부", address: "경기도 안산시 단원구 대부동동 2110"},
        {code: "AD_0002", name: "삼길포항", lat: 37.003892, lon: 126.453104, marine_reg: "서해중부", address: "충청남도 서산시 대산읍 화곡리"},
        {code: "AD_0003", name: "석문방조제", lat: 37.001554, lon: 126.643014, marine_reg: "서해중부", address: "충청남도 당진시 송산면 석문방조제로"},
        {code: "AD_0004", name: "대부도", lat: 37.207938, lon: 126.540241, marine_reg: "서해북부", address: "경기도 안산시 단원구 대부남동 1345"},
        {code: "AD_0005", name: "제부도", lat: 37.166686, lon: 126.616773, marine_reg: "서해북부", address: "경기도 화성시 서신면 제부리"},
        {code: "AD_0006", name: "전곡항", lat: 37.187681, lon: 126.652290, marine_reg: "서해북부", address: "경기도 화성시 서신면 전곡리"},
        {code: "AD_0007", name: "석모도", lat: 37.654450, lon: 126.327121, marine_reg: "서해북부", address: "인천광역시 강화군 삼산면 매음리 627-71"},
        {code: "AD_0008", name: "궁평항", lat: 37.116110, lon: 126.677130, marine_reg: "서해북부", address: "경기도 화성시 서신면 궁평항로 1049-24"},
        {code: "AD_0009", name: "자월도", lat: 37.244555, lon: 126.318354, marine_reg: "서해북부", address: "인천광역시 옹진군 자월면 자월리 306-10"},
        {code: "AD_0010", name: "왜목항", lat: 37.044797, lon: 126.527138, marine_reg: "서해중부", address: "충청남도 당진시 석문면 교로리"},
        {code: "AD_0011", name: "도비도항", lat: 37.018513, lon: 126.462040, marine_reg: "서해중부", address: "충청남도 당진시 석문면 난지도리"},
        {code: "AD_0012", name: "황금산", lat: 36.990378, lon: 126.327876, marine_reg: "서해중부", address: "충청남도 서산시 독곶리 산 230-2"},
        {code: "AD_0013", name: "벌천포해수욕장", lat: 36.968196, lon: 126.336212, marine_reg: "서해중부", address: "충청남도 서산시 대산읍 오지리"},
        {code: "AD_0014", name: "이원방조제", lat: 36.904202, lon: 126.263425, marine_reg: "서해중부", address: "충청남도 태안군 이원면 포지리 1288"},
        {code: "AD_0015", name: "서산A지구방조제", lat: 36.602727, lon: 126.435026, marine_reg: "서해중부", address: "충청남도 홍성군 서부면 궁리"},
        {code: "AD_0016", name: "서산B지구방조제", lat: 36.625471, lon: 126.360493, marine_reg: "서해중부", address: "충청남도 태안군 남면 당암리 980"},
        {code: "AD_0018", name: "가의도항", lat: 36.673562, lon: 126.064058, marine_reg: "서해중부", address: "충청남도 태안군 근흥면 가의도리"},
        {code: "AD_0019", name: "학암포항", lat: 36.902522, lon: 126.206355, marine_reg: "서해중부", address: "충청남도 태안군 원북면 방갈리"},
        {code: "AD_0020", name: "신진도항", lat: 36.902522, lon: 126.206355, marine_reg: "서해중부", address: "충청남도 태안군 근흥면 신진도리 75-12"},
        {code: "AD_0021", name: "드르니항", lat: 36.590059, lon: 126.314880, marine_reg: "서해중부", address: "충청남도 태안군 남면 신온리"},
        {code: "AD_0022", name: "영목항", lat: 36.400043, lon: 126.426899, marine_reg: "서해중부", address: "충청남도 태안군 고남면 고남리"},
        {code: "AD_0023", name: "대천항(무창포항)", lat: 36.328198, lon: 126.509917, marine_reg: "서해중부", address: "충청남도 보령시 신흑동 2245"},
        {code: "AD_0024", name: "무창포해수욕장", lat: 36.245178, lon: 126.536391, marine_reg: "서해중부", address: "충청남도 보령시 웅천읍 열린바다1길 10"},
        {code: "AD_0025", name: "홍원항", lat: 36.162883, lon: 126.499793, marine_reg: "서해중부", address: "충청남도 서천군 서면 도둔리"},
        {code: "AD_0026", name: "새만금방조제", lat: 35.833138, lon: 126.484020, marine_reg: "서해남부", address: "전북특별자치도 군산시 비응도동 123"},
        {code: "AD_0027", name: "비안도선착장", lat: 35.735745, lon:  126.461443, marine_reg: "서해남부", address: "전북특별자치도 군산시 옥도면 비안도리"},
        {code: "AD_0028", name: "격포항", lat: 35.623433, lon: 126.463768, marine_reg: "서해남부", address: "전북특별자치도 부안군 변산면 격포리 788-15"},
        {code: "AD_0029", name: "구시포항", lat: 35.449806, lon: 126.435537, marine_reg: "서해남부", address: "전북특별자치도 고창군 상하면 자룡리 산 96"},
        {code: "AD_0030", name: "동호항", lat: 35.521553, lon: 126.486863, marine_reg: "서해남부", address: "전북특별자치도 고창군 해리면 동호리"},
        {code: "AD_0031", name: "항화도항", lat: 35.167977, lon: 126.359493, marine_reg: "서해남부", address: "전라남도 영광군 염산면 옥실리"},
        {code: "AD_0032", name: "비금도가산", lat: 34.760966, lon: 125.999144, marine_reg: "서해남부", address: "전라남도 신안군 비금면 가산리 180-58"},
        {code: "AD_0033", name: "송평항", lat: 34.426953, lon: 126.481791, marine_reg: "남해서부", address: "전라남도 해남군 화산면 평호리 395-39"},
        {code: "AD_0034", name: "갈두항", lat: 34.330291, lon: 126.534920, marine_reg: "남해서부", address: "전라남도 해남군 송지면 송호리 1127-22"},
        {code: "AD_0035", name: "동천항", lat: 34.203406, lon: 126.624946, marine_reg: "남해서부", address: "전라남도 완도군 노화읍 동천리"},
        {code: "AD_0036", name: "정남진해양낚시공원", lat: 34.470784, lon: 126.976240, marine_reg: "남해서부", address: "전라남도 장흥군 회진면 해양낚시길 137"},
        {code: "AD_0037", name: "고흥만방조제", lat: 34.651229, lon: 127.213832, marine_reg: "남해서부", address: "전라남도 고흥군 도덕면 용동리 1454"},
        {code: "AD_0038", name: "용두항", lat: 34.835211, lon: 127.433247, marine_reg: "남해서부", address: "전라남도 순천시 별량면 구룡리 6-8"},
        {code: "AD_0039", name: "내지항", lat: 34.855647, lon: 128.180548, marine_reg: "남해동부", address: "경상남도 통영시 사량면 상도일주로 494"},
        {code: "AD_0040", name: "계도항", lat: 34.974278, lon: 128.517630, marine_reg: "남해동부", address: "경상남도 거제시 사등면 창호리 1070-24"},
        {code: "AD_0041", name: "가배항", lat: 34.785960, lon: 128.568371, marine_reg: "남해동부", address: "경상남도 거제시 동부면 가배리"},
        {code: "AD_0042", name: "다대포항", lat: 35.057047, lon: 128.979232, marine_reg: "남해동부", address: "경상남도 사하구 다대동"}
    ];
    </script>

    <!-- jQuery (Select2 requires jQuery) - jsdelivr CDN을 사용하여 CSP 준수 -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        /* Select2 커스텀 스타일 */
        .select2-container--default .select2-selection--single {
            height: 42px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 38px;
            padding-left: 12px;
            color: #333;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 38px;
        }
        .select2-container--default.select2-container--focus .select2-selection--single {
            border-color: #667eea;
        }
        .select2-container {
            width: 100% !important;
        }
        .select2-dropdown {
            border: 2px solid #667eea;
            border-radius: 8px;
        }
        .select2-search--dropdown .select2-search__field {
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            padding: 8px;
        }
        .select2-results__option--highlighted {
            background-color: #667eea !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/" class="back-button">← 대시보드</a>
            <h1>🌊 해양관측소 데이터 분석기</h1>
            <p>해양관측소별 데이터 가용성 분석 및 조석관측소 매칭 추천</p>
        </div>

        <div class="content">
            <!-- 필터 섹션 -->
            <div class="filters">
                <h2>🔍 분석 설정</h2>
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="stationSelect">해양관측소 선택</label>
                        <select id="stationSelect">
                            <option value="">관측소를 선택하세요</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="dateFrom">시작일</label>
                        <input type="date" id="dateFrom">
                    </div>
                    <div class="filter-group">
                        <label for="dateTo">종료일</label>
                        <input type="date" id="dateTo">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-primary" onclick="analyzeStation()">📊 분석 실행</button>
                    <button class="btn btn-secondary" onclick="resetFilters()">🔄 초기화</button>
                </div>
            </div>

            <!-- 에러 메시지 -->
            <div id="errorMessage" class="error" style="display: none;"></div>

            <!-- 로딩 표시 -->
            <div id="loading" class="loading" style="display: none;">
                데이터를 분석하는 중...
            </div>

            <!-- 결과 섹션 -->
            <div id="results" style="display: none;">
                <!-- 통계 카드 -->
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="coverageRate">-</div>
                        <div class="stat-label">일평균 수집 횟수</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalHours">-</div>
                        <div class="stat-label">분석 기간</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="providedHours">-</div>
                        <div class="stat-label">총 수집 횟수</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="missingHours">-</div>
                        <div class="stat-label">상태</div>
                    </div>
                </div>

                <!-- 데이터 항목 분석 -->
                <div class="analysis-section">
                    <h3>📋 제공 데이터 항목</h3>
                    <div class="data-fields" id="dataFields"></div>
                </div>

                <!-- 시간별 커버리지 -->
                <div class="analysis-section">
                    <h3>📈 일별 데이터 커버리지</h3>
                    <div class="timeline" id="timeline"></div>
                </div>

                <!-- 데이터 수집 정보 -->
                <div class="analysis-section">
                    <h3>📊 데이터 수집 정보</h3>
                    <div class="missing-times" id="missingTimes"></div>
                </div>

                <!-- 조석관측소 매칭 추천 -->
                <div class="analysis-section">
                    <h3>🎯 가까운 조석관측소 매칭 추천</h3>
                    <div id="matchingRecommendation"></div>
                </div>
            </div>
        </div>

        <!-- 일별 상세 데이터 모달 -->
        <div id="dailyDetailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle">일별 상세 데이터</h2>
                    <button class="modal-close" onclick="closeDailyDetailModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="modalBody"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수로 분석 데이터 저장
        let currentAnalysisData = null;
        let currentRawData = null;
        // 날짜 필터 초기값 설정
        const today = new Date();
        const sevenDaysAgo = new Date(today);
        sevenDaysAgo.setDate(today.getDate() - 7);

        document.getElementById('dateFrom').valueAsDate = sevenDaysAgo;
        document.getElementById('dateTo').valueAsDate = today;

        // 관측소 목록 업데이트
        function updateStationList() {
            const select = $('#stationSelect');
            // A_STATIONS와 B_STATIONS를 모두 합침 (중복 제거)
            const allStations = [...A_STATIONS, ...B_STATIONS];

            // 중복 제거 (id 기준)
            const uniqueStationsMap = new Map();
            allStations.forEach(station => {
                const key = `${station.id}_${station.name}`;
                if (!uniqueStationsMap.has(key)) {
                    uniqueStationsMap.set(key, station);
                }
            });
            const stations = Array.from(uniqueStationsMap.values());

            // Select2 제거 (재초기화를 위해)
            if (select.hasClass("select2-hidden-accessible")) {
                select.select2('destroy');
            }

            // 기존 옵션 제거
            select.empty();

            // 기본 옵션 추가
            select.append('<option value="">관측소를 선택하세요</option>');

            // 가나다순으로 정렬
            const sortedStations = [...stations].sort((a, b) => {
                return a.name.localeCompare(b.name, 'ko-KR');
            });

            // 옵션 추가
            sortedStations.forEach(station => {
                const option = $('<option></option>')
                    .val(JSON.stringify(station))
                    .text(`${station.name} (${station.id})`);
                select.append(option);
            });

            // Select2 초기화 (검색 기능 활성화)
            select.select2({
                placeholder: '관측소를 선택하거나 검색하세요',
                allowClear: true,
                language: {
                    noResults: function() {
                        return "검색 결과가 없습니다";
                    },
                    searching: function() {
                        return "검색 중...";
                    }
                },
                width: '100%'
            });
        }

        // 초기 로드 (DOM이 준비된 후 실행)
        $(document).ready(function() {
            updateStationList();
        });

        // 거리 계산 (Haversine formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // 지구 반지름 (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // 분석 실행
        async function analyzeStation() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('errorMessage').style.display = 'none';
                document.getElementById('results').style.display = 'none';

                const stationJson = $('#stationSelect').val();
                const dateFrom = document.getElementById('dateFrom').value;
                const dateTo = document.getElementById('dateTo').value;

                if (!stationJson) {
                    throw new Error('관측소를 선택해주세요.');
                }
                if (!dateFrom || !dateTo) {
                    throw new Error('시작일과 종료일을 모두 선택해주세요.');
                }

                const station = JSON.parse(stationJson);

                // KST 날짜를 UTC로 변환 (KST = UTC+9)
                // KST 2026-01-17 00:00 = UTC 2026-01-16 15:00
                const kstStartDate = new Date(dateFrom + 'T00:00:00+09:00');
                const kstEndDate = new Date(dateTo + 'T23:59:59.999+09:00');

                // UTC로 변환
                const startDate = new Date(kstStartDate.toISOString());
                const endDate = new Date(kstEndDate.toISOString());

                console.log(`분석 시작: ${station.name} (${station.id}), ${dateFrom} ~ ${dateTo} (KST)`);
                console.log(`UTC 범위: ${startDate.toISOString()} ~ ${endDate.toISOString()}`);

                // abs_fetch_log에서 데이터 조회 (페이지네이션)
                let allData = [];
                let offset = 0;
                const limit = 1000;
                let hasMore = true;

                while (hasMore) {
                    const url = `${SUPABASE_CONFIG.url}/rest/v1/abs_fetch_log?select=*&station_id=eq.${station.id}&request_time=gte.${startDate.toISOString()}&request_time=lte.${endDate.toISOString()}&limit=${limit}&offset=${offset}`;

                    const response = await fetch(url, {
                        headers: {
                            'apikey': SUPABASE_CONFIG.anonKey,
                            'Authorization': `Bearer ${SUPABASE_CONFIG.anonKey}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const pageData = await response.json();
                    allData = allData.concat(pageData);

                    if (pageData.length < limit) {
                        hasMore = false;
                    } else {
                        offset += limit;
                    }
                }

                console.log(`총 ${allData.length}개 레코드 조회`);

                if (allData.length === 0) {
                    throw new Error('선택한 기간에 데이터가 없습니다.');
                }

                // 원본 데이터 저장 (모달에서 사용)
                currentRawData = allData;

                // 데이터 분석 (KST 날짜 문자열 전달)
                const analysis = analyzeData(allData, dateFrom, dateTo, station);
                currentAnalysisData = analysis;

                // 결과 표시
                displayResults(analysis, station);

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').textContent = `분석 실패: ${error.message}`;
                document.getElementById('errorMessage').style.display = 'block';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // 데이터 분석
        function analyzeData(data, dateFrom, dateTo, station) {
            // 날짜 범위 계산
            const startDate = new Date(dateFrom);
            const endDate = new Date(dateTo);
            const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;

            // 실제 제공된 고유 시간 수 계산 (중복 제거, observation_time_kst 사용)
            // 각 station_id는 고유한 데이터 제공 패턴을 가지므로 실제 수집된 데이터만 카운트
            const uniqueTimes = new Set(
                data
                    .filter(row => row.observation_time_kst)
                    .map(row => row.observation_time_kst)
            );
            const providedHours = uniqueTimes.size;

            // 일평균 수집 횟수 계산
            const avgPerDay = daysDiff > 0 ? (providedHours / daysDiff).toFixed(1) : 0;

            // 제공된 데이터 항목 분석 (중복 제거 - 고유 시간대별로만 카운트)
            const fieldCounts = {
                'significant_wave_height_available': 0,
                'wind_direction_available': 0,
                'wind_speed_available': 0,
                'gust_wind_speed_available': 0,
                'water_temperature_available': 0,
                'air_temperature_available': 0,
                'pressure_available': 0,
                'humidity_available': 0
            };

            // 시간대별로 중복 제거하여 카운트
            const timeBasedFields = {};
            data.forEach(row => {
                if (!row.observation_time_kst) return;

                if (!timeBasedFields[row.observation_time_kst]) {
                    timeBasedFields[row.observation_time_kst] = {};
                    Object.keys(fieldCounts).forEach(field => {
                        // true인 경우만 true로, 나머지(false/null/undefined)는 모두 false로
                        timeBasedFields[row.observation_time_kst][field] = row[field] === true;
                    });
                }
            });

            // 고유 시간대에서 필드 존재 여부 카운트 (true인 경우만)
            Object.values(timeBasedFields).forEach(fields => {
                Object.keys(fieldCounts).forEach(field => {
                    if (fields[field] === true) fieldCounts[field]++;
                });
            });

            // 일별 커버리지 계산 (시간별 중복 제거, observation_time_kst 사용)
            const dailyCoverage = {};
            const dailyTimeSet = {}; // 날짜별 고유 시간 추적

            data.forEach(row => {
                // observation_time_kst에서 날짜 추출 (YYYYMMDDHHMI -> YYYY-MM-DD)
                if (!row.observation_time_kst || row.observation_time_kst.length < 8) return;

                const kstDateStr = row.observation_time_kst.substring(0, 8); // YYYYMMDD
                const date = `${kstDateStr.substring(0, 4)}-${kstDateStr.substring(4, 6)}-${kstDateStr.substring(6, 8)}`; // YYYY-MM-DD
                const dateTime = row.observation_time_kst; // 전체 타임스탬프 (KST)

                if (!dailyCoverage[date]) {
                    dailyCoverage[date] = { total: 0, complete: 0 };
                    dailyTimeSet[date] = new Set();
                }

                // 중복되지 않은 시간만 카운트
                if (!dailyTimeSet[date].has(dateTime)) {
                    dailyTimeSet[date].add(dateTime);
                    dailyCoverage[date].total++;

                    // 완전한 데이터 판단 (주요 항목이 true인 경우만)
                    const hasData = row.significant_wave_height_available === true ||
                                   row.water_temperature_available === true ||
                                   row.air_temperature_available === true ||
                                   row.wind_speed_available === true;
                    if (hasData) {
                        dailyCoverage[date].complete++;
                    }
                }
            });

            // 데이터 제공률 계산 (일평균 수집 횟수 기준, 24시간 = 100%)
            const coverageRate = Math.min(100, ((avgPerDay / 24) * 100).toFixed(1));

            return {
                daysDiff,
                providedHours,
                avgPerDay,
                coverageRate,
                fieldCounts,
                dailyCoverage
            };
        }

        // 결과 표시
        function displayResults(analysis, station) {
            // 통계 업데이트
            document.getElementById('coverageRate').textContent = analysis.avgPerDay + '회/일';
            document.getElementById('totalHours').textContent = analysis.daysDiff + '일';
            document.getElementById('providedHours').textContent = analysis.providedHours + '회';
            document.getElementById('missingHours').textContent = '-';

            // 데이터 항목 표시
            const fieldLabels = {
                'significant_wave_height_available': '파고',
                'wind_direction_available': '풍향',
                'wind_speed_available': '풍속',
                'gust_wind_speed_available': '돌풍',
                'water_temperature_available': '수온',
                'air_temperature_available': '기온',
                'pressure_available': '기압',
                'humidity_available': '습도'
            };

            const dataFieldsHtml = Object.entries(analysis.fieldCounts).map(([field, count]) => {
                const percentage = analysis.providedHours > 0 ? (count / analysis.providedHours * 100) : 0;
                const isAvailable = percentage > 50;
                const className = isAvailable ? 'field-available' : 'field-unavailable';
                const icon = isAvailable ? '✅' : '❌';

                return `
                    <div class="field-badge ${className}">
                        ${icon} ${fieldLabels[field]}
                        <div style="font-size: 0.85em; margin-top: 5px;">${percentage.toFixed(1)}%</div>
                    </div>
                `;
            }).join('');

            document.getElementById('dataFields').innerHTML = dataFieldsHtml;

            // 일별 타임라인
            const timelineHtml = Object.entries(analysis.dailyCoverage)
                .sort((a, b) => a[0].localeCompare(b[0]))
                .map(([date, data]) => {
                    const percentage = (data.complete / 48 * 100); // 하루 48회 기준 (정시 + 30분)
                    let fillClass = 'timeline-fill';
                    if (percentage < 50) fillClass += ' empty';
                    else if (percentage < 90) fillClass += ' partial';

                    return `
                        <div class="timeline-row" onclick="showDailyDetail('${date}')" title="클릭하여 30분 단위 상세 데이터 보기">
                            <div class="timeline-label">${date}</div>
                            <div class="timeline-bar">
                                <div class="${fillClass}" style="width: ${percentage}%"></div>
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 0.8em; font-weight: bold;">
                                    ${data.total}회 / ${percentage.toFixed(0)}%
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

            document.getElementById('timeline').innerHTML = timelineHtml;

            // 수집 정보 표시
            document.getElementById('missingTimes').innerHTML = `
                <div style="color: #666; font-weight: normal; text-align: center; padding: 15px; background-color: #f8f9fa; border-radius: 4px;">
                    ℹ️ 이 관측소는 ${analysis.daysDiff}일간 총 <strong>${analysis.providedHours}회</strong> 데이터를 제공했습니다.
                    (평균 <strong>${analysis.avgPerDay}회/일</strong>)
                    <br><small style="color: #999; margin-top: 5px; display: block;">
                    각 관측소는 고유한 데이터 제공 패턴을 가지며, observation_time_kst 기준으로 분석됩니다.
                    </small>
                </div>
            `;

            // 조석관측소 매칭 - 가장 가까운 조석관측소 찾기
            const tidesWithDistance = TIDE_STATIONS.map(tide => ({
                ...tide,
                distance: calculateDistance(station.lat, station.lon, tide.lat, tide.lon)
            })).sort((a, b) => a.distance - b.distance);

            // 가장 가까운 30개의 조석관측소 표시
            const nearestTides = tidesWithDistance.slice(0, 30);

            const tideListHtml = nearestTides.map((tide, index) => {
                // 거리 판정
                let distanceJudgment = '';
                let distanceColor = '#28a745';
                if (tide.distance < 5) {
                    distanceJudgment = ' (동일 지점)';
                    distanceColor = '#28a745';
                } else if (tide.distance < 20) {
                    distanceJudgment = ' (인접)';
                    distanceColor = '#20c997';
                } else if (tide.distance < 50) {
                    distanceJudgment = ' (보통)';
                    distanceColor = '#ffc107';
                } else if (tide.distance < 100) {
                    distanceJudgment = ' (다소 멀음)';
                    distanceColor = '#fd7e14';
                } else {
                    distanceJudgment = ' (매우 멀음)';
                    distanceColor = '#dc3545';
                }

                return `
                <tr style="background: ${index === 0 ? '#e8f5e9' : 'white'};">
                    <td style="padding: 10px; text-align: center; font-weight: ${index === 0 ? 'bold' : 'normal'};">
                        ${index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : (index + 1)}
                    </td>
                    <td style="padding: 10px;">
                        <strong>${tide.name}</strong><br>
                        <small style="color: #666;">${tide.code}</small>
                    </td>
                    <td style="padding: 10px; text-align: center;">
                        <span style="display: inline-block; padding: 5px 10px; border-radius: 5px; background: ${distanceColor}; color: white; font-weight: bold;">
                            ${tide.distance.toFixed(1)} km${distanceJudgment}
                        </span>
                    </td>
                    <td style="padding: 10px;">
                        <small style="color: #666;">${tide.marine_reg}</small>
                    </td>
                    <td style="padding: 10px;">
                        <small style="color: #777;">${tide.address}</small>
                    </td>
                </tr>
            `;
            }).join('');

            // 가장 가까운 조석관측소 거리 경고
            const closestDistance = nearestTides[0].distance;
            let distanceWarning = '';
            if (closestDistance > 100) {
                distanceWarning = `
                    <div style="padding: 15px; margin: 15px 0; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">
                        ⚠️ <strong>경고:</strong> 가장 가까운 조석관측소가 ${closestDistance.toFixed(1)}km 떨어져 있습니다.
                        조석 데이터의 정확도가 낮을 수 있으니 참고용으로만 사용하세요.
                    </div>
                `;
            } else if (closestDistance > 50) {
                distanceWarning = `
                    <div style="padding: 15px; margin: 15px 0; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 5px;">
                        ℹ️ <strong>안내:</strong> 가장 가까운 조석관측소가 ${closestDistance.toFixed(1)}km 떨어져 있습니다.
                        인접 해역의 조석 데이터로 참고하시기 바랍니다.
                    </div>
                `;
            } else if (closestDistance < 10) {
                distanceWarning = `
                    <div style="padding: 15px; margin: 15px 0; background: #d4edda; border-left: 4px solid #28a745; border-radius: 5px;">
                        ✅ <strong>우수:</strong> 가장 가까운 조석관측소가 ${closestDistance.toFixed(1)}km 거리에 있어 신뢰도 높은 조석 데이터를 제공할 수 있습니다.
                    </div>
                `;
            }

            const matchingHtml = `
                <div class="distance-calc">
                    <h4>📍 선택된 해양관측소</h4>
                    <p><strong>${station.name}</strong> (${station.id})</p>
                    <p>위도: ${station.lat.toFixed(4)}, 경도: ${station.lon.toFixed(4)}</p>
                    <p style="margin-top: 10px; padding: 10px; background: ${analysis.coverageRate >= 90 ? '#d4edda' : analysis.coverageRate >= 70 ? '#fff3cd' : '#f8d7da'}; border-radius: 5px;">
                        💡 데이터 제공률: <strong>${analysis.coverageRate}%</strong>
                        ${analysis.coverageRate >= 90 ? '- 우수한 신뢰도' : analysis.coverageRate >= 70 ? '- 보통 수준' : '- 낮은 신뢰도, 주의 필요'}
                    </p>
                </div>

                ${distanceWarning}

                <div style="margin-top: 20px;">
                    <h4>🎯 가까운 조석관측소 매칭 추천 (TOP 30)</h4>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                        해양관측소에서 가장 가까운 조석관측소들입니다.
                        <strong>거리 판정:</strong>
                        <span style="color: #28a745;">■ 5km 이내(동일지점)</span>,
                        <span style="color: #20c997;">■ 20km 이내(인접)</span>,
                        <span style="color: #ffc107;">■ 50km 이내(보통)</span>,
                        <span style="color: #fd7e14;">■ 100km 이내(다소 멀음)</span>,
                        <span style="color: #dc3545;">■ 100km 이상(매우 멀음)</span>
                    </p>
                    <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
                        <thead style="background: #f8f9fa;">
                            <tr>
                                <th style="padding: 10px; border: 1px solid #ddd; width: 50px;">순위</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">조석관측소</th>
                                <th style="padding: 10px; border: 1px solid #ddd; width: 100px;">거리</th>
                                <th style="padding: 10px; border: 1px solid #ddd; width: 100px;">해역</th>
                                <th style="padding: 10px; border: 1px solid #ddd;">주소</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tideListHtml}
                        </tbody>
                    </table>
                </div>
            `;

            document.getElementById('matchingRecommendation').innerHTML = matchingHtml;

            // 결과 섹션 표시
            document.getElementById('results').style.display = 'block';
        }

        // 필터 초기화
        function resetFilters() {
            const today = new Date();
            const sevenDaysAgo = new Date(today);
            sevenDaysAgo.setDate(today.getDate() - 7);

            document.getElementById('dateFrom').valueAsDate = sevenDaysAgo;
            document.getElementById('dateTo').valueAsDate = today;
            updateStationList();
            document.getElementById('results').style.display = 'none';
        }

        // 일별 상세 데이터 모달 표시
        function showDailyDetail(date) {
            if (!currentRawData) {
                alert('데이터가 없습니다.');
                return;
            }

            // 데이터 필드 라벨
            const fieldLabels = {
                'significant_wave_height_available': '파고',
                'wind_direction_available': '풍향',
                'wind_speed_available': '풍속',
                'gust_wind_speed_available': '돌풍',
                'water_temperature_available': '수온',
                'air_temperature_available': '기온',
                'pressure_available': '기압',
                'humidity_available': '습도'
            };

            // 해당 날짜의 데이터 필터링 (observation_time_kst 사용, YYYYMMDD 형식으로 변환)
            const dateStr = date.replace(/-/g, ''); // '2026-01-17' -> '20260117'
            const dateData = currentRawData.filter(row => {
                // observation_time_kst는 'YYYYMMDDHHMI' 형식
                return row.observation_time_kst && row.observation_time_kst.startsWith(dateStr);
            });

            // 시간별 데이터 맵 생성 및 시간 목록 추출 (observation_time_kst 기준)
            const timeDataMap = {};
            const timeSet = new Set();

            dateData.forEach(row => {
                if (row.observation_time_kst && row.observation_time_kst.length >= 12) {
                    // 'YYYYMMDDHHMI' 형식에서 'HH:MI' 추출
                    const hour = row.observation_time_kst.substring(8, 10);
                    const minute = row.observation_time_kst.substring(10, 12);
                    const time = `${hour}:${minute}`;

                    // 같은 시간에 여러 행이 있을 수 있으므로 데이터 병합
                    if (!timeDataMap[time]) {
                        timeDataMap[time] = row;
                    } else {
                        // 기존 데이터와 병합 (null이 아닌 값 우선)
                        Object.keys(row).forEach(key => {
                            if (row[key] !== null && row[key] !== undefined) {
                                timeDataMap[time][key] = row[key];
                            }
                        });
                    }
                    timeSet.add(time);
                }
            });

            // 실제 데이터가 있는 시간만 오름차순 정렬
            const actualTimes = Array.from(timeSet).sort((a, b) => {
                // HH:MM 형식을 숫자로 변환하여 비교
                const [aHour, aMin] = a.split(':').map(Number);
                const [bHour, bMin] = b.split(':').map(Number);
                return (aHour * 60 + aMin) - (bHour * 60 + bMin);
            });

            // HTML 생성
            let html = `
                <p style="color: #666; margin-bottom: 15px;">
                    총 <strong>${actualTimes.length}개</strong> 시간대에 데이터가 수집되었습니다.
                </p>
                <div class="hourly-grid">
            `;

            actualTimes.forEach((time, index) => {
                const rowData = timeDataMap[time];
                const itemClass = 'has-data';

                // 사용 가능한 데이터 필드 표시 (true인 필드만)
                const availableFields = Object.keys(fieldLabels).filter(field => rowData[field] === true);

                html += `
                    <div class="hourly-item ${itemClass}">
                        <div class="hourly-time">${time}</div>
                `;

                if (availableFields.length > 0) {
                    html += '<div class="hourly-fields">';
                    availableFields.forEach(field => {
                        html += `<span class="field-tag">${fieldLabels[field]}</span>`;
                    });
                    html += '</div>';
                } else {
                    html += '<div class="no-data-text">데이터 필드 없음</div>';
                }

                html += `</div>`;
            });

            html += '</div>';

            // 모달에 표시
            document.getElementById('modalTitle').textContent = `${date} 상세 데이터 (${actualTimes.length}개 시간대)`;
            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('dailyDetailModal').style.display = 'block';
        }

        // 모달 닫기
        function closeDailyDetailModal() {
            document.getElementById('dailyDetailModal').style.display = 'none';
        }

        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const modal = document.getElementById('dailyDetailModal');
            if (event.target === modal) {
                closeDailyDetailModal();
            }
        }

        // 페이지 로드 시 초기화
        updateStationList();

        // iframe 안에서 로드될 때 헤더 숨기기
        if (window.self !== window.top) {
            const backButtons = document.querySelectorAll('.back-button');
            backButtons.forEach(btn => btn.style.display = 'none');
        }
    </script>
</body>
</html>
