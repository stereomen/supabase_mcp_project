<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´‘ê³  ìº í˜ì¸ ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .back-button {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }
        .content {
            padding: 30px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab:hover {
            background: #f5f5f5;
        }
        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .section h2 {
            color: #333;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .message.success {
            background: #d4edda;
            color: #155724;
        }
        .message.error {
            background: #f8d7da;
            color: #721c24;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
        tr:hover {
            background: #f5f5f5;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .badge.active {
            background: #28a745;
            color: white;
        }
        .badge.inactive {
            background: #dc3545;
            color: white;
        }
        .actions {
            display: flex;
            gap: 10px;
        }
        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
        }
        .image-preview {
            margin-top: 10px;
            position: relative;
        }
        .image-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        .image-preview .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            padding: 0;
        }
        .upload-progress {
            margin-top: 5px;
            color: #667eea;
            font-size: 14px;
        }
        /* ë‹¤ì¤‘ ì„ íƒ dropdown ìŠ¤íƒ€ì¼ */
        select[multiple] {
            min-height: 200px;
            padding: 8px;
        }
        select[multiple] option {
            padding: 6px;
            margin: 2px 0;
            border-radius: 3px;
        }
        select[multiple] option:checked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }
    </style>

    <!-- ê³µí†µ ê´€ì¸¡ì†Œ ëª©ë¡ ë°ì´í„° -->
    <script src="shared/locations.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="index.html" class="back-button">â† ë’¤ë¡œ</a>
            <h1>ğŸ“¢ ê´‘ê³  ìº í˜ì¸ ê´€ë¦¬</h1>
            <p>ì œíœ´ì‚¬ ê´‘ê³  ìº í˜ì¸ ë“±ë¡ ë° ê´€ë¦¬</p>
        </div>

        <div class="content">
            <div class="tabs">
                <div class="tab active" onclick="showTab('list')">ìº í˜ì¸ ëª©ë¡</div>
                <div class="tab" onclick="showTab('create')">ìƒˆ ìº í˜ì¸ ë“±ë¡</div>
            </div>

            <!-- ìº í˜ì¸ ëª©ë¡ íƒ­ -->
            <div id="listTab" class="tab-content active">
                <div class="section">
                    <h2>ğŸ“‹ ê´‘ê³  ìº í˜ì¸ ëª©ë¡</h2>

                    <!-- í•„í„° ì„¹ì…˜ -->
                    <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="filter_status" style="font-size: 13px;">ë…¸ì¶œ ì—¬ë¶€</label>
                                <select id="filter_status" onchange="applyFilters()">
                                    <option value="">ì „ì²´</option>
                                    <option value="active">ë…¸ì¶œì¤‘</option>
                                    <option value="waiting">ëŒ€ê¸°ì¤‘</option>
                                    <option value="inactive">ë¹„í™œì„±</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="filter_station" style="font-size: 13px;">ê´€ì¸¡ì†Œ</label>
                                <select id="filter_station" onchange="applyFilters()">
                                    <option value="">ì „ì²´</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="filter_area" style="font-size: 13px;">í•´ì—­</label>
                                <input type="text" id="filter_area" placeholder="í•´ì—­ ì…ë ¥" oninput="applyFilters()">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="filter_partner" style="font-size: 13px;">ì œíœ´ì‚¬</label>
                                <select id="filter_partner" onchange="applyFilters()">
                                    <option value="">ì „ì²´</option>
                                </select>
                            </div>
                            <button onclick="resetFilters()" style="background: #6c757d; padding: 10px 15px; height: 40px;">ì´ˆê¸°í™”</button>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 20px;">
                            <label style="display: flex; align-items: center; cursor: pointer; font-size: 14px;">
                                <input type="checkbox" id="filter_include_all" onchange="applyFilters()" style="margin-right: 5px; width: auto; cursor: pointer;">
                                <span>ì „ì²´ ë…¸ì¶œ í¬í•¨ (ê´€ì¸¡ì†Œ ë¯¸ì§€ì • ìº í˜ì¸ í¬í•¨)</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer; font-size: 14px;">
                                <input type="checkbox" id="filter_show_deleted" onchange="applyFilters()" style="margin-right: 5px; width: auto; cursor: pointer;">
                                <span style="color: #dc3545;">ì‚­ì œëœ ìº í˜ì¸ ë³´ê¸°</span>
                            </label>
                        </div>
                    </div>

                    <button onclick="loadCampaigns()">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                    <div id="campaignsList"></div>
                </div>
            </div>

            <!-- ìƒˆ ìº í˜ì¸ ë“±ë¡ íƒ­ -->
            <div id="createTab" class="tab-content">
                <div class="section">
                    <h2 id="formTitle">â• ìƒˆ ìº í˜ì¸ ë“±ë¡</h2>
                    <form id="createForm" onsubmit="saveCampaign(event)">
                        <input type="hidden" id="edit_campaign_id" value="">
                        <div class="form-group">
                            <label for="partner_select">ì œíœ´ì‚¬ ì„ íƒ *</label>
                            <select id="partner_select" required onchange="fillPartnerInfo()">
                                <option value="">ì œíœ´ì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="partner_id">ì—…ì²´ ID</label>
                                <input type="text" id="partner_id" readonly>
                            </div>
                            <div class="form-group">
                                <label for="partner_name">ì—…ì²´ëª…</label>
                                <input type="text" id="partner_name" readonly>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="campaign_name">ìº í˜ì¸ëª… *</label>
                            <input type="text" id="campaign_name" required placeholder="ì˜ˆ: ì—¬ë¦„ ì‹œì¦Œ íŠ¹ê°€ í”„ë¡œëª¨ì…˜">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="matched_station_id">
                                    ë§¤í•‘ ê´€ì¸¡ì†Œ
                                    <span id="station_count" style="color: #667eea; font-size: 12px; font-weight: normal;"></span>
                                </label>
                                <select id="matched_station_id" multiple size="8">
                                    <!-- ì˜µì…˜ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
                                </select>
                                <small style="color: #666; display: block; margin-top: 5px;">
                                    Ctrl/Cmd + í´ë¦­ìœ¼ë¡œ ì—¬ëŸ¬ ê´€ì¸¡ì†Œ ì„ íƒ. ë¯¸ì„ íƒ ì‹œ ì „ì²´ ê´€ì¸¡ì†Œ ëŒ€ìƒ.
                                </small>
                                <button type="button" onclick="clearStationSelection()"
                                        style="margin-top: 5px; padding: 5px 10px; font-size: 12px; background: #ccc; border: none; border-radius: 4px; cursor: pointer;">
                                    ì„ íƒ í•´ì œ
                                </button>
                            </div>
                            <div class="form-group">
                                <label for="matched_area">ë§¤í•‘ í•´ì—­</label>
                                <input type="text" id="matched_area" placeholder="ì˜ˆ: ì„œí•´ì¤‘ë¶€ (ë¹„ì›Œë‘ë©´ ì „ì²´)">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="ad_type_a">ê´‘ê³  íƒ€ì… A</label>
                                <select id="ad_type_a">
                                    <option value="">ì„ íƒ</option>
                                    <option value="banner">ë°°ë„ˆ</option>
                                    <option value="popup">íŒì—…</option>
                                    <option value="inline">ì¸ë¼ì¸</option>
                                    <option value="native">ë„¤ì´í‹°ë¸Œ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="ad_type_b">ê´‘ê³  íƒ€ì… B</label>
                                <select id="ad_type_b">
                                    <option value="">ì„ íƒ</option>
                                    <option value="text">í…ìŠ¤íŠ¸</option>
                                    <option value="image">ì´ë¯¸ì§€</option>
                                    <option value="video">ë¹„ë””ì˜¤</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="image_a_url">ì´ë¯¸ì§€ A</label>
                                <input type="file" id="image_a_file" accept="image/*" onchange="handleImageUpload('a')" style="margin-bottom: 10px;">
                                <input type="text" id="image_a_url" placeholder="ì´ë¯¸ì§€ URL ì…ë ¥ (http:// ìƒëµ ê°€ëŠ¥)">
                                <div id="preview_a" class="image-preview"></div>
                                <small style="color: #666;">íŒŒì¼ ì—…ë¡œë“œ ë˜ëŠ” URL ì§ì ‘ ì…ë ¥ (ìµœëŒ€ 5MB, JPG/PNG/GIF/WEBP)</small>
                            </div>
                            <div class="form-group">
                                <label for="image_b_url">ì´ë¯¸ì§€ B</label>
                                <input type="file" id="image_b_file" accept="image/*" onchange="handleImageUpload('b')" style="margin-bottom: 10px;">
                                <input type="text" id="image_b_url" placeholder="ì´ë¯¸ì§€ URL ì…ë ¥ (http:// ìƒëµ ê°€ëŠ¥)">
                                <div id="preview_b" class="image-preview"></div>
                                <small style="color: #666;">íŒŒì¼ ì—…ë¡œë“œ ë˜ëŠ” URL ì§ì ‘ ì…ë ¥ (ìµœëŒ€ 5MB, JPG/PNG/GIF/WEBP)</small>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="landing_url">ëœë”© í˜ì´ì§€ URL</label>
                            <input type="text" id="landing_url" placeholder="ëœë”© URL ì…ë ¥ (http:// ìƒëµ ê°€ëŠ¥)">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="display_start_date">ë…¸ì¶œ ì‹œì‘ì¼ *</label>
                                <input type="date" id="display_start_date" required onchange="updateEndDate()">
                            </div>
                            <div class="form-group">
                                <label for="display_end_date">ë…¸ì¶œ ì¢…ë£Œì¼ *</label>
                                <input type="date" id="display_end_date" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="priority">ìš°ì„ ìˆœìœ„ (0-100, ë†’ì„ìˆ˜ë¡ ìš°ì„ )</label>
                                <input type="number" id="priority" min="0" max="100" value="0">
                            </div>
                            <div class="form-group">
                                <label for="is_active">í™œì„± ìƒíƒœ</label>
                                <select id="is_active">
                                    <option value="true">í™œì„±</option>
                                    <option value="false">ë¹„í™œì„±</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="description">ì„¤ëª…</label>
                            <textarea id="description" placeholder="ìº í˜ì¸ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                        </div>

                        <div class="button-group">
                            <button type="submit" id="submitBtn">ìº í˜ì¸ ë“±ë¡</button>
                            <button type="button" id="cancelBtn" onclick="cancelEdit()" style="display: none; background: #6c757d;">ì·¨ì†Œ</button>
                        </div>
                    </form>
                    <div id="createMessage"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase ì„¤ì • (ì¸ë¼ì¸) -->
    <script>
    const SUPABASE_CONFIG = {
        url: 'https://iwpgvdtfpwazzfeniusk.supabase.co',
        anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml3cGd2ZHRmcHdhenpmZW5pdXNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwNzEzOTQsImV4cCI6MjA2NjY0NzM5NH0.d0pjIvnOdPGbc_-cfqRNu9yOIutyO1eex848k1yNZJE'
    };
    </script>

    <!-- ê´€ë¦¬ì ì¸ì¦ ì²´í¬ -->
    <script src="_shared/auth-check.js"></script>

    <script>
        const SUPABASE_URL = SUPABASE_CONFIG.url;
        const ANON_KEY = SUPABASE_CONFIG.anonKey;
        const FUNCTION_URL = SUPABASE_URL + '/functions/v1/manage-ad-repo';

        // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        let supabaseClient;
        try {
            if (window.supabase && window.supabase.createClient) {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, ANON_KEY);
            } else {
                console.error('Supabase library not loaded');
            }
        } catch (error) {
            console.error('Failed to initialize Supabase client:', error);
        }

        let campaignsData = [];
        let partnersData = [];
        let uploadedImages = { a: null, b: null }; // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URL ì €ì¥

        // ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 2ì£¼ í›„ ë‚ ì§œ ê³„ì‚°
        function getTwoWeeksLater(dateString) {
            const date = new Date(dateString);
            date.setDate(date.getDate() + 14);
            return formatDate(date);
        }

        // ì‹œì‘ì¼ ë³€ê²½ ì‹œ ì¢…ë£Œì¼ ìë™ ì„¤ì •
        function updateEndDate() {
            const startDate = document.getElementById('display_start_date').value;
            if (startDate) {
                document.getElementById('display_end_date').value = getTwoWeeksLater(startDate);
            }
        }

        // ê´€ì¸¡ì†Œ ëª©ë¡: shared/locations.jsì—ì„œ ë¡œë“œë¨ (ì´ 178ê°œ)

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // í´ë¦­ëœ íƒ­ í™œì„±í™”
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                if (tab.textContent.includes('ìº í˜ì¸ ëª©ë¡') && tabName === 'list') {
                    tab.classList.add('active');
                } else if (tab.textContent.includes('ìƒˆ ìº í˜ì¸ ë“±ë¡') && tabName === 'create') {
                    tab.classList.add('active');
                }
            });

            document.getElementById(tabName + 'Tab').classList.add('active');

            if (tabName === 'create') {
                if (partnersData.length === 0) {
                    loadPartners();
                }
                loadLocations();
            }
        }

        async function loadPartners() {
            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ action: 'list_partners' })
                });

                const result = await response.json();

                if (result.success) {
                    partnersData = result.data;
                    const select = document.getElementById('partner_select');
                    select.innerHTML = '<option value="">ì œíœ´ì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';

                    partnersData.forEach(partner => {
                        const option = document.createElement('option');
                        option.value = partner.partner_id;
                        option.textContent = `${partner.partner_name} (${partner.partner_id})`;
                        option.dataset.partner = JSON.stringify(partner);
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('ì œíœ´ì‚¬ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        function loadLocations() {
            const select = document.getElementById('matched_station_id');
            select.innerHTML = '';  // "ì „ì²´" ì˜µì…˜ ì œê±° (ë¹ˆ ì„ íƒ = ì „ì²´)

            // ì½”ë“œ ìˆœìœ¼ë¡œ ì •ë ¬ëœ ê´€ì¸¡ì†Œ ëª©ë¡
            const sortedLocations = [...locations].sort((a, b) => a.code.localeCompare(b.code));

            sortedLocations.forEach(loc => {
                const option = document.createElement('option');
                option.value = loc.code;
                option.textContent = `${loc.code} - ${loc.name}`;
                select.appendChild(option);
            });

            // ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            select.addEventListener('change', updateStationCount);

            console.log(`ê´€ì¸¡ì†Œ ëª©ë¡ ë¡œë“œ ì™„ë£Œ: ${sortedLocations.length}ê°œ`);
        }

        // ì„ íƒëœ ê´€ì¸¡ì†Œ ê°œìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStationCount() {
            const select = document.getElementById('matched_station_id');
            const count = Array.from(select.selectedOptions).length;
            document.getElementById('station_count').textContent =
                count === 0 ? '(ì „ì²´)' : `(${count}ê°œ ì„ íƒë¨)`;
        }

        // ê´€ì¸¡ì†Œ ì„ íƒ í•´ì œ
        function clearStationSelection() {
            const select = document.getElementById('matched_station_id');
            Array.from(select.options).forEach(opt => opt.selected = false);
            updateStationCount();
        }

        function fillPartnerInfo() {
            const select = document.getElementById('partner_select');
            const selectedOption = select.options[select.selectedIndex];

            if (selectedOption.dataset.partner) {
                const partner = JSON.parse(selectedOption.dataset.partner);
                document.getElementById('partner_id').value = partner.partner_id;
                document.getElementById('partner_name').value = partner.partner_name;

                // ê´€ì¸¡ì†ŒëŠ” ë“œë¡­ë°•ìŠ¤ì—ì„œ ì„ íƒ
                const stationSelect = document.getElementById('matched_station_id');
                if (partner.matched_station_id) {
                    stationSelect.value = partner.matched_station_id;
                } else {
                    stationSelect.value = '';
                }

                document.getElementById('matched_area').value = partner.matched_area || '';
            } else {
                document.getElementById('partner_id').value = '';
                document.getElementById('partner_name').value = '';
                document.getElementById('matched_station_id').value = '';
            }
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        async function handleImageUpload(imageType) {
            const fileInput = document.getElementById(`image_${imageType}_file`);
            const urlInput = document.getElementById(`image_${imageType}_url`);
            const previewDiv = document.getElementById(`preview_${imageType}`);
            const file = fileInput.files[0];

            if (!file) return;

            // íŒŒì¼ í¬ê¸° ì²´í¬ (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 5MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                fileInput.value = '';
                return;
            }

            // íŒŒì¼ íƒ€ì… ì²´í¬
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                alert('JPG, PNG, GIF, WEBP íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                fileInput.value = '';
                return;
            }

            // ì—…ë¡œë“œ ì§„í–‰ í‘œì‹œ
            previewDiv.innerHTML = '<div class="upload-progress">â³ ì—…ë¡œë“œ ì¤‘...</div>';

            try {
                // íŒŒì¼ëª… ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤ ë¬¸ìì—´)
                const fileExt = file.name.split('.').pop();
                const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}.${fileExt}`;
                const filePath = `${fileName}`;

                // Supabase Storageì— ì—…ë¡œë“œ
                const { data, error } = await supabaseClient.storage
                    .from('ad-images')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });

                if (error) {
                    throw error;
                }

                // Public URL ê°€ì ¸ì˜¤ê¸°
                const { data: { publicUrl } } = supabaseClient.storage
                    .from('ad-images')
                    .getPublicUrl(filePath);

                // URL inputì— ìë™ ì…ë ¥
                urlInput.value = publicUrl;
                uploadedImages[imageType] = publicUrl;

                // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                showImagePreview(imageType, publicUrl, filePath);

                console.log(`Image ${imageType} uploaded:`, publicUrl);
            } catch (error) {
                console.error('Upload error:', error);
                previewDiv.innerHTML = `<div class="message error">âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
                fileInput.value = '';
            }
        }

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showImagePreview(imageType, imageUrl, filePath) {
            const previewDiv = document.getElementById(`preview_${imageType}`);
            previewDiv.innerHTML = `
                <img src="${imageUrl}" alt="Preview ${imageType}">
                <button type="button" class="remove-btn" onclick="removeImage('${imageType}', '${filePath}')" title="ì‚­ì œ">Ã—</button>
            `;
        }

        // URLì—ì„œ íŒŒì¼ ê²½ë¡œ ì¶”ì¶œ (Supabase Storage URLì—ì„œ)
        function extractFilePathFromUrl(imageUrl) {
            if (!imageUrl) return '';

            // Supabase Storage URL í˜•ì‹: https://[project].supabase.co/storage/v1/object/public/ad-images/[filepath]
            const match = imageUrl.match(/\/ad-images\/(.+)$/);
            return match ? match[1] : '';
        }

        // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ì‚­ì œ
        async function removeImage(imageType, filePath) {
            if (!confirm('ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                // Storageì—ì„œ ì‚­ì œ
                const { error } = await supabaseClient.storage
                    .from('ad-images')
                    .remove([filePath]);

                if (error) {
                    console.error('Delete error:', error);
                    // ì‚­ì œ ì‹¤íŒ¨í•´ë„ UIëŠ” ì´ˆê¸°í™” (íŒŒì¼ì´ ì´ë¯¸ ì—†ì„ ìˆ˜ë„ ìˆìŒ)
                }

                // UI ì´ˆê¸°í™”
                document.getElementById(`image_${imageType}_file`).value = '';
                document.getElementById(`image_${imageType}_url`).value = '';
                document.getElementById(`preview_${imageType}`).innerHTML = '';
                uploadedImages[imageType] = null;

                console.log(`Image ${imageType} removed`);
            } catch (error) {
                console.error('Remove error:', error);
                alert('ì´ë¯¸ì§€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function loadCampaigns() {
            const listDiv = document.getElementById('campaignsList');
            listDiv.innerHTML = '<div class="loading">ğŸ”„ ë¡œë”© ì¤‘...</div>';

            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify({ action: 'list' })
                });

                const result = await response.json();

                if (result.success) {
                    campaignsData = result.data;
                    initializeFilterDropdowns();
                    displayCampaigns();
                } else {
                    listDiv.innerHTML = `<div class="message error">âŒ ${result.error}</div>`;
                }
            } catch (error) {
                listDiv.innerHTML = `<div class="message error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // í•„í„° ë“œë¡­ë°•ìŠ¤ ì´ˆê¸°í™”
        function initializeFilterDropdowns() {
            // ê´€ì¸¡ì†Œ ëª©ë¡ ì±„ìš°ê¸°
            const stationSelect = document.getElementById('filter_station');
            stationSelect.innerHTML = '<option value="">ì „ì²´</option>';

            const sortedLocations = [...locations].sort((a, b) => a.code.localeCompare(b.code));
            sortedLocations.forEach(loc => {
                const option = document.createElement('option');
                option.value = loc.code;
                option.textContent = `${loc.code} - ${loc.name}`;
                stationSelect.appendChild(option);
            });

            // ì œíœ´ì‚¬ ëª©ë¡ ì±„ìš°ê¸°
            if (partnersData.length === 0) {
                loadPartners().then(() => {
                    populatePartnerFilter();
                });
            } else {
                populatePartnerFilter();
            }
        }

        function populatePartnerFilter() {
            const partnerSelect = document.getElementById('filter_partner');
            partnerSelect.innerHTML = '<option value="">ì „ì²´</option>';

            partnersData.forEach(partner => {
                const option = document.createElement('option');
                option.value = partner.partner_id;
                option.textContent = `${partner.partner_name} (${partner.partner_id})`;
                partnerSelect.appendChild(option);
            });
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            displayCampaigns();
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('filter_status').value = '';
            document.getElementById('filter_station').value = '';
            document.getElementById('filter_area').value = '';
            document.getElementById('filter_partner').value = '';
            document.getElementById('filter_include_all').checked = false;
            document.getElementById('filter_show_deleted').checked = false;
            displayCampaigns();
        }

        function displayCampaigns() {
            const listDiv = document.getElementById('campaignsList');

            if (campaignsData.length === 0) {
                listDiv.innerHTML = '<p>ë“±ë¡ëœ ìº í˜ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
            const filterStatus = document.getElementById('filter_status').value;
            const filterStation = document.getElementById('filter_station').value;
            const filterArea = document.getElementById('filter_area').value.trim().toLowerCase();
            const filterPartner = document.getElementById('filter_partner').value;
            const includeAll = document.getElementById('filter_include_all').checked;
            const showDeleted = document.getElementById('filter_show_deleted').checked;

            // í•„í„°ë§ ì ìš©
            let filteredCampaigns = campaignsData.filter(campaign => {
                // ì‚­ì œëœ ìº í˜ì¸ í•„í„° (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€)
                if (!showDeleted && !campaign.is_active) {
                    return false;
                }

                // ë…¸ì¶œ ì—¬ë¶€ í•„í„°
                if (filterStatus) {
                    if (filterStatus === 'active' && !campaign.is_currently_active) return false;
                    if (filterStatus === 'waiting' && (!campaign.is_active || campaign.is_currently_active)) return false;
                    if (filterStatus === 'inactive' && campaign.is_active) return false;
                }

                // ê´€ì¸¡ì†Œ í•„í„° (ë°°ì—´ ì§€ì›)
                if (filterStation) {
                    const stationArray = campaign.matched_station_id;

                    if (includeAll) {
                        // "ì „ì²´ ë…¸ì¶œ í¬í•¨" ì²´í¬ë¨: ë°°ì—´ì— í¬í•¨ë˜ê±°ë‚˜ NULL
                        if (stationArray && Array.isArray(stationArray) && stationArray.length > 0) {
                            if (!stationArray.includes(filterStation)) return false;
                        }
                        // NULL ë˜ëŠ” ë¹ˆ ë°°ì—´ì€ í†µê³¼ (ì „ì²´ ê´€ì¸¡ì†Œ)
                    } else {
                        // "ì „ì²´ ë…¸ì¶œ í¬í•¨" ì²´í¬ ì•ˆë¨: ì •í™•íˆ íƒ€ê²ŸíŒ…ëœ ê²ƒë§Œ
                        if (!stationArray || !Array.isArray(stationArray) ||
                            !stationArray.includes(filterStation)) {
                            return false;
                        }
                    }
                } else {
                    // ê´€ì¸¡ì†Œ ì„ íƒ ì•ˆë¨ (ì „ì²´)
                    // ì²´í¬ë°•ìŠ¤ëŠ” ê´€ì¸¡ì†Œê°€ ì„ íƒëœ ê²½ìš°ì—ë§Œ ì˜ë¯¸ê°€ ìˆìŒ
                }

                // í•´ì—­ í•„í„°
                if (filterArea) {
                    const campaignArea = (campaign.matched_area || '').toLowerCase();
                    if (!campaignArea.includes(filterArea)) return false;
                }

                // ì œíœ´ì‚¬ í•„í„°
                if (filterPartner && campaign.partner_id !== filterPartner) return false;

                return true;
            });

            if (filteredCampaigns.length === 0) {
                listDiv.innerHTML = '<p>í•„í„° ì¡°ê±´ì— ë§ëŠ” ìº í˜ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            let html = '<table><thead><tr>';
            html += '<th>ìº í˜ì¸ëª…</th><th>ì œíœ´ì‚¬</th><th>ê´€ì¸¡ì†Œ/í•´ì—­</th>';
            html += '<th>ë…¸ì¶œê¸°ê°„</th><th>ìš°ì„ ìˆœìœ„</th><th>ìƒíƒœ</th><th>ì‘ì—…</th>';
            html += '</tr></thead><tbody>';

            filteredCampaigns.forEach(campaign => {
                // ì‚­ì œëœ ìº í˜ì¸ ì—¬ë¶€
                const isDeleted = !campaign.is_active;

                const status = isDeleted ?
                    '<span class="badge inactive">ì‚­ì œë¨</span>' :
                    campaign.is_currently_active ?
                    '<span class="badge active">ë…¸ì¶œì¤‘</span>' :
                    '<span class="badge">ëŒ€ê¸°ì¤‘</span>';

                // ê´€ì¸¡ì†Œ í‘œì‹œ ë¡œì§ (ë°°ì—´ ì§€ì›)
                let stationDisplay = 'ì „ì²´';
                if (campaign.matched_station_id && Array.isArray(campaign.matched_station_id) && campaign.matched_station_id.length > 0) {
                    if (campaign.matched_station_id.length <= 3) {
                        stationDisplay = campaign.matched_station_id.join(', ');
                    } else {
                        stationDisplay = campaign.matched_station_id.slice(0, 2).join(', ') +
                            ` <span style="background: #667eea; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">+${campaign.matched_station_id.length - 2}ê°œ</span>`;
                    }
                }

                // ì‚­ì œëœ ìº í˜ì¸ì€ íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œ
                const rowStyle = isDeleted ? 'style="opacity: 0.6; background-color: #f5f5f5;"' : '';

                html += `<tr ${rowStyle}>`;
                html += `<td><strong>${campaign.campaign_name}</strong></td>`;
                html += `<td>${campaign.partner_name || campaign.partner_id}</td>`;
                html += `<td>${stationDisplay} / ${campaign.matched_area || 'ì „ì²´'}</td>`;
                html += `<td>${campaign.display_start_date} ~ ${campaign.display_end_date}</td>`;
                html += `<td>${campaign.priority}</td>`;
                html += `<td>${status}</td>`;
                html += `<td class="actions">`;

                if (isDeleted) {
                    html += `<button class="btn-small" onclick="restoreCampaign('${campaign.id}')" style="background: #28a745;">ë³µì›</button>`;
                } else {
                    html += `<button class="btn-small" onclick="editCampaign('${campaign.id}')" style="background: #28a745;">ìˆ˜ì •</button>
                    <button class="btn-small" onclick="deleteCampaign('${campaign.id}')" style="background: #dc3545;">ì‚­ì œ</button>`;
                }

                html += `</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            html = `<p style="color: #666; margin-top: 10px;">ì´ ${filteredCampaigns.length}ê°œì˜ ìº í˜ì¸ (ì „ì²´ ${campaignsData.length}ê°œ ì¤‘)</p>` + html;
            listDiv.innerHTML = html;
        }

        async function saveCampaign(event) {
            event.preventDefault();

            const messageDiv = document.getElementById('createMessage');
            const editId = document.getElementById('edit_campaign_id').value;
            const isEdit = editId !== '';

            // ì—…ë¡œë“œëœ ì´ë¯¸ì§€ URL ë˜ëŠ” ì§ì ‘ ì…ë ¥ëœ URL ì‚¬ìš©
            const imageAUrl = document.getElementById('image_a_url').value || null;
            const imageBUrl = document.getElementById('image_b_url').value || null;

            // ì„ íƒëœ ê´€ì¸¡ì†Œë“¤ì„ ë°°ì—´ë¡œ ë³€í™˜
            const stationSelect = document.getElementById('matched_station_id');
            const selectedStations = Array.from(stationSelect.selectedOptions)
                .map(opt => opt.value);
            console.log('ì„ íƒëœ ê´€ì¸¡ì†Œ:', selectedStations);

            const campaignData = {
                partner_id: document.getElementById('partner_id').value,
                campaign_name: document.getElementById('campaign_name').value,
                matched_station_id: selectedStations.length > 0 ? selectedStations : null,
                matched_area: document.getElementById('matched_area').value && document.getElementById('matched_area').value.trim() !== '' ? document.getElementById('matched_area').value : null,
                ad_type_a: document.getElementById('ad_type_a').value || null,
                ad_type_b: document.getElementById('ad_type_b').value || null,
                image_a_url: imageAUrl,
                image_b_url: imageBUrl,
                landing_url: document.getElementById('landing_url').value && document.getElementById('landing_url').value.trim() !== '' ? document.getElementById('landing_url').value : null,
                display_start_date: document.getElementById('display_start_date').value,
                display_end_date: document.getElementById('display_end_date').value,
                is_active: document.getElementById('is_active').value === 'true',
                priority: parseInt(document.getElementById('priority').value) || 0,
                description: document.getElementById('description').value && document.getElementById('description').value.trim() !== '' ? document.getElementById('description').value : null
            };

            console.log('ì „ì†¡í•  ìº í˜ì¸ ë°ì´í„°:', campaignData);
            messageDiv.innerHTML = `<div class="loading">â³ ${isEdit ? 'ìˆ˜ì •' : 'ë“±ë¡'} ì¤‘...</div>`;

            try {
                const requestBody = isEdit
                    ? { action: 'update', id: editId, data: campaignData }
                    : { action: 'create', data: campaignData };

                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify(requestBody)
                });

                const result = await response.json();

                console.log('ì„œë²„ ì‘ë‹µ:', result);
                if (result.data) {
                    console.log('ë°˜í™˜ëœ ìº í˜ì¸ ë°ì´í„°:', result.data);
                    console.log('matched_station_id ê°’:', result.data.matched_station_id);
                }

                if (result.success) {
                    messageDiv.innerHTML = `<div class="message success">âœ… ìº í˜ì¸ì´ ì„±ê³µì ìœ¼ë¡œ ${isEdit ? 'ìˆ˜ì •' : 'ë“±ë¡'}ë˜ì—ˆìŠµë‹ˆë‹¤.</div>`;

                    // í¼ ì´ˆê¸°í™”
                    resetForm();
                    loadCampaigns();

                    // ìº í˜ì¸ ëª©ë¡ìœ¼ë¡œ ì´ë™
                    setTimeout(() => {
                        showTab('list');
                        messageDiv.innerHTML = '';
                    }, 1500);
                } else {
                    messageDiv.innerHTML = `<div class="message error">âŒ ${result.error || (isEdit ? 'ìˆ˜ì •' : 'ë“±ë¡') + ' ì‹¤íŒ¨'}</div>`;
                }
            } catch (error) {
                messageDiv.innerHTML = `<div class="message error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        function resetForm() {
            document.getElementById('createForm').reset();
            document.getElementById('edit_campaign_id').value = '';
            document.getElementById('preview_a').innerHTML = '';
            document.getElementById('preview_b').innerHTML = '';
            uploadedImages = { a: null, b: null };

            // UI ì´ˆê¸°í™”
            document.getElementById('formTitle').textContent = 'â• ìƒˆ ìº í˜ì¸ ë“±ë¡';
            document.getElementById('submitBtn').textContent = 'ìº í˜ì¸ ë“±ë¡';
            document.getElementById('cancelBtn').style.display = 'none';

            // ìƒˆ ìº í˜ì¸ ë“±ë¡ ì‹œ ë‚ ì§œ ìë™ ì„¤ì • (ì˜¤ëŠ˜ + 2ì£¼ í›„)
            const today = formatDate(new Date());
            document.getElementById('display_start_date').value = today;
            document.getElementById('display_end_date').value = getTwoWeeksLater(today);
        }

        async function editCampaign(id) {
            // ìº í˜ì¸ ë°ì´í„° ì°¾ê¸°
            const campaign = campaignsData.find(c => c.id === id);
            if (!campaign) {
                alert('ìº í˜ì¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // create íƒ­ìœ¼ë¡œ ì „í™˜
            showTab('create');

            // í¼ ì±„ìš°ê¸°
            document.getElementById('edit_campaign_id').value = campaign.id;
            document.getElementById('partner_id').value = campaign.partner_id;
            document.getElementById('partner_name').value = campaign.partner_name || campaign.partner_id;

            // ì œíœ´ì‚¬ ì„ íƒ (ì œíœ´ì‚¬ ëª©ë¡ì´ ë¡œë“œë˜ì–´ ìˆì–´ì•¼ í•¨)
            const partnerSelect = document.getElementById('partner_select');
            partnerSelect.value = campaign.partner_id;

            document.getElementById('campaign_name').value = campaign.campaign_name;

            // ë‹¤ì¤‘ ì„ íƒ ë³µì›
            const stationSelect = document.getElementById('matched_station_id');
            Array.from(stationSelect.options).forEach(opt => opt.selected = false);
            if (campaign.matched_station_id && Array.isArray(campaign.matched_station_id)) {
                campaign.matched_station_id.forEach(stationCode => {
                    const option = Array.from(stationSelect.options)
                        .find(opt => opt.value === stationCode);
                    if (option) option.selected = true;
                });
            }
            updateStationCount();

            document.getElementById('matched_area').value = campaign.matched_area || '';
            document.getElementById('ad_type_a').value = campaign.ad_type_a || '';
            document.getElementById('ad_type_b').value = campaign.ad_type_b || '';
            document.getElementById('image_a_url').value = campaign.image_a_url || '';
            document.getElementById('image_b_url').value = campaign.image_b_url || '';
            document.getElementById('landing_url').value = campaign.landing_url || '';
            document.getElementById('display_start_date').value = campaign.display_start_date;
            document.getElementById('display_end_date').value = campaign.display_end_date;
            document.getElementById('priority').value = campaign.priority || 0;
            document.getElementById('is_active').value = campaign.is_active ? 'true' : 'false';
            document.getElementById('description').value = campaign.description || '';

            // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ (ì‚­ì œ ë²„íŠ¼ í¬í•¨)
            if (campaign.image_a_url) {
                const filePathA = extractFilePathFromUrl(campaign.image_a_url);
                showImagePreview('a', campaign.image_a_url, filePathA);
            }
            if (campaign.image_b_url) {
                const filePathB = extractFilePathFromUrl(campaign.image_b_url);
                showImagePreview('b', campaign.image_b_url, filePathB);
            }

            // UI ë³€ê²½
            document.getElementById('formTitle').textContent = 'âœï¸ ìº í˜ì¸ ìˆ˜ì •';
            document.getElementById('submitBtn').textContent = 'ìˆ˜ì • ì™„ë£Œ';
            document.getElementById('cancelBtn').style.display = 'inline-block';

            // ë©”ì‹œì§€ ì´ˆê¸°í™”
            document.getElementById('createMessage').innerHTML = '';
        }

        function cancelEdit() {
            resetForm();
            document.getElementById('createMessage').innerHTML = '';
            // ìº í˜ì¸ ëª©ë¡ íƒ­ìœ¼ë¡œ ì´ë™
            showTab('list');
        }

        async function deleteCampaign(id) {
            if (!confirm('ì´ ìº í˜ì¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ë¹„í™œì„±í™”ë˜ë©° ë¶„ì„ ë°ì´í„°ëŠ” ë³´ì¡´ë©ë‹ˆë‹¤)')) {
                return;
            }

            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify({ action: 'delete', id: id, hardDelete: false })
                });

                const result = await response.json();

                if (result.success) {
                    alert('ìº í˜ì¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadCampaigns();
                } else {
                    alert('ì‚­ì œ ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message);
            }
        }

        async function restoreCampaign(id) {
            if (!confirm('ì´ ìº í˜ì¸ì„ ë³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...getAuthHeaders()
                    },
                    body: JSON.stringify({
                        action: 'update',
                        id: id,
                        data: { is_active: true }
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('ìº í˜ì¸ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadCampaigns();
                } else {
                    alert('ë³µì› ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìº í˜ì¸ ëª©ë¡ ë¡œë“œ ë° ë‚ ì§œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            loadCampaigns();

            // ìƒˆ ìº í˜ì¸ ë“±ë¡ í¼ ë‚ ì§œ ì´ˆê¸°í™”
            const today = formatDate(new Date());
            document.getElementById('display_start_date').value = today;
            document.getElementById('display_end_date').value = getTwoWeeksLater(today);
        });

        // í•¨ìˆ˜ë“¤ì„ ì „ì—­ ìŠ¤ì½”í”„ì— ëª…ì‹œì ìœ¼ë¡œ ë…¸ì¶œ
        window.showTab = showTab;
        window.loadCampaigns = loadCampaigns;
        window.loadPartners = loadPartners;
        window.loadLocations = loadLocations;
        window.fillPartnerInfo = fillPartnerInfo;
        window.handleImageUpload = handleImageUpload;
        window.removeImage = removeImage;
        window.extractFilePathFromUrl = extractFilePathFromUrl;
        window.saveCampaign = saveCampaign;
        window.editCampaign = editCampaign;
        window.cancelEdit = cancelEdit;
        window.deleteCampaign = deleteCampaign;
        window.restoreCampaign = restoreCampaign;
        window.updateEndDate = updateEndDate;
        window.applyFilters = applyFilters;
        window.resetFilters = resetFilters;
    </script>
</body>
</html>
