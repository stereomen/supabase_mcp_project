<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´‘ê³  ì œíœ´ì‚¬ ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 15px;
            transition: gap 0.2s;
        }
        .back-button:hover {
            gap: 12px;
        }
        .content {
            padding: 30px 40px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        .section h2 {
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input[type="text"],
        input[type="password"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        button {
            background-color: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #5568d3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .message {
            padding: 12px;
            margin: 15px 0;
            border-radius: 6px;
            font-weight: 600;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            transition: all 0.3s;
        }
        .tab:hover {
            background-color: #f5f5f5;
        }
        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        .action-buttons button {
            padding: 6px 12px;
            font-size: 12px;
            margin: 0;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 1.5em;
            }
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        .status-inactive {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="https://mancool.netlify.app/" class="back-button">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
            <h1>ğŸ“¢ ê´‘ê³  ì œíœ´ì‚¬ ê´€ë¦¬</h1>
            <p>ì œíœ´ê´‘ê³ ìƒí’ˆ íŒë§¤ë¥¼ ìœ„í•œ ì œíœ´ì‚¬ ì •ë³´ ê´€ë¦¬</p>
        </div>

        <div class="content">
            <!-- íƒ­ ë©”ë‰´ -->
            <div class="tabs">
                <div class="tab active" onclick="showTab('list')">ì œíœ´ì‚¬ ëª©ë¡</div>
                <div class="tab" onclick="showTab('create')">ìƒˆ ì œíœ´ì‚¬ ë“±ë¡</div>
            </div>

            <!-- ì œíœ´ì‚¬ ëª©ë¡ íƒ­ -->
            <div id="listTab" class="tab-content active">
                <div class="section">
                    <h2>ğŸ“‹ ì œíœ´ì‚¬ ëª©ë¡</h2>
                    <button onclick="loadPartners()">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                    <div id="partnersList"></div>
                </div>
            </div>

            <!-- ìƒˆ ì œíœ´ì‚¬ ë“±ë¡ íƒ­ -->
            <div id="createTab" class="tab-content">
                <div class="section">
                    <h2>â• ìƒˆ ì œíœ´ì‚¬ ë“±ë¡</h2>
                    <form id="createForm" onsubmit="createPartner(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="partner_id">ì—…ì²´ID *</label>
                                <input type="text" id="partner_id" required placeholder="ì˜ˆ: PARTNER_0001">
                            </div>
                            <div class="form-group">
                                <label for="partner_name">ì—…ì²´ëª… *</label>
                                <input type="text" id="partner_name" required placeholder="ì˜ˆ: ë°”ë‹¤ë‚šì‹œ">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="address">ì£¼ì†Œ</label>
                            <input type="text" id="address" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬...">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="phone">ì „í™”ë²ˆí˜¸</label>
                                <input type="text" id="phone" placeholder="ì˜ˆ: 02-1234-5678">
                            </div>
                            <div class="form-group">
                                <label for="contact_name">ë‹´ë‹¹ì ì´ë¦„</label>
                                <input type="text" id="contact_name" placeholder="ì˜ˆ: í™ê¸¸ë™">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="matched_station_id">ë§¤ì¹­ ê´€ì¸¡ì†Œ ID</label>
                                <input type="text" id="matched_station_id" placeholder="ì˜ˆ: DT_0001">
                            </div>
                            <div class="form-group">
                                <label for="matched_area">ë§¤ì¹­ í•´ì—­</label>
                                <select id="matched_area">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ì„œí•´ë¶ë¶€">ì„œí•´ë¶ë¶€</option>
                                    <option value="ì„œí•´ì¤‘ë¶€">ì„œí•´ì¤‘ë¶€</option>
                                    <option value="ì„œí•´ë‚¨ë¶€">ì„œí•´ë‚¨ë¶€</option>
                                    <option value="ë‚¨í•´ì„œë¶€">ë‚¨í•´ì„œë¶€</option>
                                    <option value="ë‚¨í•´ì¤‘ë¶€">ë‚¨í•´ì¤‘ë¶€</option>
                                    <option value="ë‚¨í•´ë™ë¶€">ë‚¨í•´ë™ë¶€</option>
                                    <option value="ë™í•´ë‚¨ë¶€">ë™í•´ë‚¨ë¶€</option>
                                    <option value="ë™í•´ì¤‘ë¶€">ë™í•´ì¤‘ë¶€</option>
                                    <option value="ë™í•´ë¶ë¶€">ë™í•´ë¶ë¶€</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="business_type">ì—…ì²´ êµ¬ë¶„</label>
                                <select id="business_type">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="ë‚šì‹œê°€ê²Œ">ë‚šì‹œê°€ê²Œ</option>
                                    <option value="ì„ ë°•">ì„ ë°•</option>
                                    <option value="ì¢ŒëŒ€">ì¢ŒëŒ€</option>
                                    <option value="ë‚šì‹œí„°">ë‚šì‹œí„°</option>
                                    <option value="íœì…˜">íœì…˜</option>
                                    <option value="ë¯¼ë°•">ë¯¼ë°•</option>
                                    <option value="ì‹ë‹¹">ì‹ë‹¹</option>
                                    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="business_level">ì—…ì²´ ë ˆë²¨</label>
                                <input type="number" id="business_level" min="1" max="10" value="1" placeholder="1-10">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="staff_name_1">ì§ì› ì´ë¦„ 1</label>
                                <input type="text" id="staff_name_1" placeholder="ì˜ˆ: ê¹€ì§ì›">
                            </div>
                            <div class="form-group">
                                <label for="staff_name_2">ì§ì› ì´ë¦„ 2</label>
                                <input type="text" id="staff_name_2" placeholder="ì˜ˆ: ì´ì§ì›">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="staff_name_3">ì§ì› ì´ë¦„ 3</label>
                            <input type="text" id="staff_name_3" placeholder="ì˜ˆ: ë°•ì§ì›">
                        </div>

                        <button type="submit" class="btn-success">ë“±ë¡í•˜ê¸°</button>
                        <button type="button" onclick="resetForm()">ì´ˆê¸°í™”</button>
                    </form>
                    <div id="createMessage"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
        <div style="max-width: 800px; margin: 50px auto; background: white; border-radius: 10px; padding: 30px;">
            <h2>âœï¸ ì œíœ´ì‚¬ ì •ë³´ ìˆ˜ì •</h2>
            <form id="editForm" onsubmit="updatePartner(event)">
                <input type="hidden" id="edit_id">

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_partner_id">ì—…ì²´ID *</label>
                        <input type="text" id="edit_partner_id" required>
                    </div>
                    <div class="form-group">
                        <label for="edit_partner_name">ì—…ì²´ëª… *</label>
                        <input type="text" id="edit_partner_name" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="edit_address">ì£¼ì†Œ</label>
                    <input type="text" id="edit_address">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_phone">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" id="edit_phone">
                    </div>
                    <div class="form-group">
                        <label for="edit_contact_name">ë‹´ë‹¹ì ì´ë¦„</label>
                        <input type="text" id="edit_contact_name">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_matched_station_id">ë§¤ì¹­ ê´€ì¸¡ì†Œ ID</label>
                        <input type="text" id="edit_matched_station_id">
                    </div>
                    <div class="form-group">
                        <label for="edit_matched_area">ë§¤ì¹­ í•´ì—­</label>
                        <select id="edit_matched_area">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì„œí•´ë¶ë¶€">ì„œí•´ë¶ë¶€</option>
                            <option value="ì„œí•´ì¤‘ë¶€">ì„œí•´ì¤‘ë¶€</option>
                            <option value="ì„œí•´ë‚¨ë¶€">ì„œí•´ë‚¨ë¶€</option>
                            <option value="ë‚¨í•´ì„œë¶€">ë‚¨í•´ì„œë¶€</option>
                            <option value="ë‚¨í•´ì¤‘ë¶€">ë‚¨í•´ì¤‘ë¶€</option>
                            <option value="ë‚¨í•´ë™ë¶€">ë‚¨í•´ë™ë¶€</option>
                            <option value="ë™í•´ë‚¨ë¶€">ë™í•´ë‚¨ë¶€</option>
                            <option value="ë™í•´ì¤‘ë¶€">ë™í•´ì¤‘ë¶€</option>
                            <option value="ë™í•´ë¶ë¶€">ë™í•´ë¶ë¶€</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_business_type">ì—…ì²´ êµ¬ë¶„</label>
                        <select id="edit_business_type">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ë‚šì‹œê°€ê²Œ">ë‚šì‹œê°€ê²Œ</option>
                            <option value="ì„ ë°•">ì„ ë°•</option>
                            <option value="ì¢ŒëŒ€">ì¢ŒëŒ€</option>
                            <option value="ë‚šì‹œí„°">ë‚šì‹œí„°</option>
                            <option value="íœì…˜">íœì…˜</option>
                            <option value="ë¯¼ë°•">ë¯¼ë°•</option>
                            <option value="ì‹ë‹¹">ì‹ë‹¹</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit_business_level">ì—…ì²´ ë ˆë²¨</label>
                        <input type="number" id="edit_business_level" min="1" max="10">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_staff_name_1">ì§ì› ì´ë¦„ 1</label>
                        <input type="text" id="edit_staff_name_1">
                    </div>
                    <div class="form-group">
                        <label for="edit_staff_name_2">ì§ì› ì´ë¦„ 2</label>
                        <input type="text" id="edit_staff_name_2">
                    </div>
                </div>

                <div class="form-group">
                    <label for="edit_staff_name_3">ì§ì› ì´ë¦„ 3</label>
                    <input type="text" id="edit_staff_name_3">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit_is_active" checked>
                        í™œì„± ìƒíƒœ
                    </label>
                </div>

                <button type="submit" class="btn-success">ì €ì¥</button>
                <button type="button" onclick="closeEditModal()">ì·¨ì†Œ</button>
            </form>
            <div id="editMessage"></div>
        </div>
    </div>

    <!-- Supabase ì„¤ì • (ì¸ë¼ì¸) -->
    <script>
    const SUPABASE_CONFIG = {
        url: 'https://iwpgvdtfpwazzfeniusk.supabase.co',
        anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml3cGd2ZHRmcHdhenpmZW5pdXNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwNzEzOTQsImV4cCI6MjA2NjY0NzM5NH0.d0pjIvnOdPGbc_-cfqRNu9yOIutyO1eex848k1yNZJE'
    };
    </script>

    <script>
        const FUNCTION_URL = `${SUPABASE_CONFIG.url}/functions/v1/manage-ad-partners`;
        const ANON_KEY = SUPABASE_CONFIG.anonKey;
        let partnersData = [];

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        async function loadPartners() {
            const listDiv = document.getElementById('partnersList');
            listDiv.innerHTML = '<div class="loading">ğŸ”„ ë¡œë”© ì¤‘...</div>';

            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${ANON_KEY}`
                    },
                    body: JSON.stringify({ action: 'list' })
                });

                const result = await response.json();

                if (result.success) {
                    partnersData = result.data || [];
                    displayPartners(partnersData);
                } else {
                    listDiv.innerHTML = '<div class="message error">âŒ ' + (result.error || 'ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨') + '</div>';
                }
            } catch (error) {
                listDiv.innerHTML = '<div class="message error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }

        function displayPartners(partners) {
            const listDiv = document.getElementById('partnersList');

            if (!partners || partners.length === 0) {
                listDiv.innerHTML = '<div class="message">ë“±ë¡ëœ ì œíœ´ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let html = '<table><thead><tr>';
            html += '<th>ì—…ì²´ID</th><th>ì—…ì²´ëª…</th><th>ì „í™”ë²ˆí˜¸</th><th>ë§¤ì¹­í•´ì—­</th><th>ì—…ì²´êµ¬ë¶„</th><th>ë ˆë²¨</th><th>ìƒíƒœ</th><th>ì‘ì—…</th>';
            html += '</tr></thead><tbody>';

            partners.forEach(partner => {
                html += '<tr>';
                html += '<td>' + (partner.partner_id || '-') + '</td>';
                html += '<td>' + (partner.partner_name || '-') + '</td>';
                html += '<td>' + (partner.phone || '-') + '</td>';
                html += '<td>' + (partner.matched_area || '-') + '</td>';
                html += '<td>' + (partner.business_type || '-') + '</td>';
                html += '<td>' + (partner.business_level || '-') + '</td>';
                html += '<td><span class="status-badge ' + (partner.is_active ? 'status-active' : 'status-inactive') + '">' + (partner.is_active ? 'í™œì„±' : 'ë¹„í™œì„±') + '</span></td>';
                html += '<td class="action-buttons">';
                html += '<button onclick="editPartner(\'' + partner.id + '\')">ìˆ˜ì •</button>';
                html += '<button onclick="resetPassword(\'' + partner.partner_id + '\')" style="background: #ffc107; color: #333;">ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”</button>';
                html += '<button class="btn-danger" onclick="deletePartner(\'' + partner.id + '\')">ì‚­ì œ</button>';
                html += '</td>';
                html += '</tr>';
            });

            html += '</tbody></table>';
            listDiv.innerHTML = html;
        }

        async function createPartner(event) {
            event.preventDefault();

            const messageDiv = document.getElementById('createMessage');

            const partnerData = {
                partner_id: document.getElementById('partner_id').value,
                partner_name: document.getElementById('partner_name').value,
                address: document.getElementById('address').value || null,
                phone: document.getElementById('phone').value || null,
                contact_name: document.getElementById('contact_name').value || null,
                matched_station_id: document.getElementById('matched_station_id').value || null,
                matched_area: document.getElementById('matched_area').value || null,
                business_type: document.getElementById('business_type').value || null,
                business_level: parseInt(document.getElementById('business_level').value) || 1,
                staff_name_1: document.getElementById('staff_name_1').value || null,
                staff_name_2: document.getElementById('staff_name_2').value || null,
                staff_name_3: document.getElementById('staff_name_3').value || null,
                is_active: true
            };

            messageDiv.innerHTML = '<div class="loading">â³ ë“±ë¡ ì¤‘...</div>';

            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${ANON_KEY}`
                    },
                    body: JSON.stringify({ action: 'create', data: partnerData })
                });

                const result = await response.json();

                if (result.success) {
                    messageDiv.innerHTML = '<div class="message success">âœ… ì œíœ´ì‚¬ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                    resetForm();
                    loadPartners();
                } else {
                    messageDiv.innerHTML = '<div class="message error">âŒ ' + (result.error || 'ë“±ë¡ ì‹¤íŒ¨') + '</div>';
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="message error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }

        function resetForm() {
            document.getElementById('createForm').reset();
            document.getElementById('createMessage').innerHTML = '';
        }

        function editPartner(id) {
            const partner = partnersData.find(p => p.id === id);
            if (!partner) return;

            document.getElementById('edit_id').value = partner.id;
            document.getElementById('edit_partner_id').value = partner.partner_id || '';
            document.getElementById('edit_partner_name').value = partner.partner_name || '';
            document.getElementById('edit_address').value = partner.address || '';
            document.getElementById('edit_phone').value = partner.phone || '';
            document.getElementById('edit_contact_name').value = partner.contact_name || '';
            document.getElementById('edit_matched_station_id').value = partner.matched_station_id || '';
            document.getElementById('edit_matched_area').value = partner.matched_area || '';
            document.getElementById('edit_business_type').value = partner.business_type || '';
            document.getElementById('edit_business_level').value = partner.business_level || 1;
            document.getElementById('edit_staff_name_1').value = partner.staff_name_1 || '';
            document.getElementById('edit_staff_name_2').value = partner.staff_name_2 || '';
            document.getElementById('edit_staff_name_3').value = partner.staff_name_3 || '';
            document.getElementById('edit_is_active').checked = partner.is_active !== false;

            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('editMessage').innerHTML = '';
        }

        async function updatePartner(event) {
            event.preventDefault();

            const messageDiv = document.getElementById('editMessage');
            const id = document.getElementById('edit_id').value;

            const updateData = {
                partner_id: document.getElementById('edit_partner_id').value,
                partner_name: document.getElementById('edit_partner_name').value,
                address: document.getElementById('edit_address').value || null,
                phone: document.getElementById('edit_phone').value || null,
                contact_name: document.getElementById('edit_contact_name').value || null,
                matched_station_id: document.getElementById('edit_matched_station_id').value || null,
                matched_area: document.getElementById('edit_matched_area').value || null,
                business_type: document.getElementById('edit_business_type').value || null,
                business_level: parseInt(document.getElementById('edit_business_level').value) || 1,
                staff_name_1: document.getElementById('edit_staff_name_1').value || null,
                staff_name_2: document.getElementById('edit_staff_name_2').value || null,
                staff_name_3: document.getElementById('edit_staff_name_3').value || null,
                is_active: document.getElementById('edit_is_active').checked
            };

            messageDiv.innerHTML = '<div class="loading">â³ ì—…ë°ì´íŠ¸ ì¤‘...</div>';

            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${ANON_KEY}`
                    },
                    body: JSON.stringify({ action: 'update', id: id, data: updateData })
                });

                const result = await response.json();

                if (result.success) {
                    messageDiv.innerHTML = '<div class="message success">âœ… ì œíœ´ì‚¬ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                    setTimeout(() => {
                        closeEditModal();
                        loadPartners();
                    }, 1500);
                } else {
                    messageDiv.innerHTML = '<div class="message error">âŒ ' + (result.error || 'ì—…ë°ì´íŠ¸ ì‹¤íŒ¨') + '</div>';
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="message error">âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }

        async function deletePartner(id) {
            if (!confirm('ì´ ì œíœ´ì‚¬ë¥¼ ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const response = await fetch(FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${ANON_KEY}`
                    },
                    body: JSON.stringify({ action: 'delete', id: id, hardDelete: false })
                });

                const result = await response.json();

                if (result.success) {
                    alert('ì œíœ´ì‚¬ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadPartners();
                } else {
                    alert('ì‚­ì œ ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message);
            }
        }

        async function resetPassword(partnerId) {
            const newPassword = prompt(`${partnerId}ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.\n\nìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìµœì†Œ 4ì):`);

            if (!newPassword) return;

            if (newPassword.length < 4) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            if (!confirm(`${partnerId}ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ "${newPassword}"ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            try {
                const response = await fetch('https://iwpgvdtfpwazzfeniusk.supabase.co/functions/v1/partner-auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${ANON_KEY}`
                    },
                    body: JSON.stringify({
                        action: 'reset_password',
                        partner_id: partnerId,
                        new_password: newPassword
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`âœ… ${partnerId}ì˜ ë¹„ë°€ë²ˆí˜¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nìƒˆ ë¹„ë°€ë²ˆí˜¸: ${newPassword}\n\nì œíœ´ì‚¬ì—ê²Œ ì „ë‹¬í•´ì£¼ì„¸ìš”.`);
                } else {
                    alert('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message);
            }
        }
    </script>
</body>
</html>
